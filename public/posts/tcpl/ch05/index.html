<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>C语言程序设计第二版课后习题--第五章 | Jagger's Blog</title>
<meta name=keywords content="TCPL"><meta name=description content="部分答案参考了官方题解和网上的答案，仅供参考，可能也有部分bug未发现或解决。
exercise5-1 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 int getint(int *pn) { int c, sign; while (isspace(c = getch())) /* skip white space */ ; if (!isdigit(c) && c != EOF && c != '+' && c != '-') { ungetch(c); /* it is not a number */ return 0; } sign = (c == '-') ?"><meta name=author content="Jagger"><link rel=canonical href=https://fireflyyh.top/posts/tcpl/ch05/><link crossorigin=anonymous href=/assets/css/stylesheet.1212f0454c490726d67933de27a90315a6177ba895fb506fe0f2bd6e93b66acd.css integrity="sha256-EhLwRUxJBybWeTPeJ6kDFaYXe6iV+1Bv4PK9bpO2as0=" rel="preload stylesheet" as=style><link rel=icon href=https://fireflyyh.top/img/yuan.jpg><link rel=icon type=image/png sizes=16x16 href=https://fireflyyh.top/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://fireflyyh.top/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://fireflyyh.top/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://fireflyyh.top/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://fireflyyh.top/posts/tcpl/ch05/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?87f1888ba5320e03987ecde7525fde2d",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script type=text/javascript async src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["[[","]]"]],processEscapes:!0,processEnvironments:!0,skipTags:["script","noscript","style","textarea","pre"],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}}),MathJax.Hub.Queue(function(){var e,t=MathJax.Hub.getAllJax();for(e=0;e<t.length;e+=1)t[e].SourceElement().parentNode.className+=" has-jax"})</script><style>code.has-jax{font:inherit;font-size:100%;background:inherit;border:inherit;color:#515151}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-Y30PKHXBN4"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Y30PKHXBN4")</script><meta property="og:title" content="C语言程序设计第二版课后习题--第五章"><meta property="og:description" content="部分答案参考了官方题解和网上的答案，仅供参考，可能也有部分bug未发现或解决。
exercise5-1 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 int getint(int *pn) { int c, sign; while (isspace(c = getch())) /* skip white space */ ; if (!isdigit(c) && c != EOF && c != '+' && c != '-') { ungetch(c); /* it is not a number */ return 0; } sign = (c == '-') ?"><meta property="og:type" content="article"><meta property="og:url" content="https://fireflyyh.top/posts/tcpl/ch05/"><meta property="og:image" content="https://fireflyyh.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-12T00:00:00+00:00"><meta property="article:modified_time" content="2024-10-12T00:00:00+00:00"><meta property="og:site_name" content="Jagger's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://fireflyyh.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="C语言程序设计第二版课后习题--第五章"><meta name=twitter:description content="部分答案参考了官方题解和网上的答案，仅供参考，可能也有部分bug未发现或解决。
exercise5-1 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 int getint(int *pn) { int c, sign; while (isspace(c = getch())) /* skip white space */ ; if (!isdigit(c) && c != EOF && c != '+' && c != '-') { ungetch(c); /* it is not a number */ return 0; } sign = (c == '-') ?"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://fireflyyh.top/posts/"},{"@type":"ListItem","position":2,"name":"C语言程序设计第二版课后习题--第五章","item":"https://fireflyyh.top/posts/tcpl/ch05/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"C语言程序设计第二版课后习题--第五章","name":"C语言程序设计第二版课后习题--第五章","description":"部分答案参考了官方题解和网上的答案，仅供参考，可能也有部分bug未发现或解决。\nexercise5-1 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 int getint(int *pn) { int c, sign; while (isspace(c = getch())) /* skip white space */ ; if (!isdigit(c) \u0026amp;\u0026amp; c != EOF \u0026amp;\u0026amp; c != \u0026#39;+\u0026#39; \u0026amp;\u0026amp; c != \u0026#39;-\u0026#39;) { ungetch(c); /* it is not a number */ return 0; } sign = (c == \u0026#39;-\u0026#39;) ?","keywords":["TCPL"],"articleBody":" 部分答案参考了官方题解和网上的答案，仅供参考，可能也有部分bug未发现或解决。\nexercise5-1 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 int getint(int *pn) { int c, sign; while (isspace(c = getch())) /* skip white space */ ; if (!isdigit(c) \u0026\u0026 c != EOF \u0026\u0026 c != '+' \u0026\u0026 c != '-') { ungetch(c); /* it is not a number */ return 0; } sign = (c == '-') ? -1 : 1; if (c == '+' || c == '-') c = getch(); for (*pn = 0; isdigit(c); c = getch()) *pn = 10 * *pn + (c - '0'); *pn *= sign; if (c != EOF) ungetch(c); return c; } 在上面的例子中，如果符号+或-的后面紧跟的不是数字，getint 函数将把符号视为数字 0 的有效表达方式。修改该函数，将这种形式的+或-符号重新写回到输入流中。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 #include #include #define SIZE 100 #define BUFSIZE 100 char buf[BUFSIZE]; /* buffer for ungetch */ int bufp = 0; /* next free position in buf */ int notdigit = 0; /* flag for not a digit */ /* getint: get next integer from input into *pn */ int getint(int *pn) { notdigit = 0; int c, sign, foundSign; while (isspace(c = getch())) /* skip white space */ ; if (!isdigit(c) \u0026\u0026 c != EOF \u0026\u0026 c != '+' \u0026\u0026 c != '-') { notdigit = 1; // 若不是数字，将字符放回输入流，但是下次依然会读取到这个字符，所以需要注释掉ungtch(c) // ungetch(c); /* it is not a number */ return 0; } sign = (c == '-') ? -1 : 1; if (foundSign = (c == '+' || c == '-')) c = getch(); if (c != EOF \u0026\u0026 !isdigit(c)) { // ungetch(c); if (foundSign) ungetch((sign = -1) ? '-' : '+'); // 将符号放回 return 0; } for (*pn = 0; isdigit(c); c = getch()) *pn = 10 * *pn + (c - '0'); *pn *= sign; if (c != EOF) ungetch(c); return c; } int main() { int n, array[SIZE], getint(int *); for (n = 0; n \u003c SIZE \u0026\u0026 getint(\u0026array[n]) != EOF; n++) { if (notdigit) { printf(\"Not a number\\n\"); continue; } printf(\"%d\\n\", array[n]); } } 1 2 3 4 5 6 7 8 9 -1 2 -1 2 s2 Not a number 2 -s2 0 -2 exercise5-2 模仿函数 getint 的实现方法，编写一个读取浮点数的函数 getfloat。getfloat 函数的返回值应该是什么类型？\n代码：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 int getfloat(float *pn) { notdigit = 0; int c, sign, foundSign; float power; while (isspace(c = getch())) /* skip white space */ ; if (!isdigit(c) \u0026\u0026 c != EOF \u0026\u0026 c != '+' \u0026\u0026 c != '-' \u0026\u0026 c != '.') { notdigit = 1; return 0; } sign = (c == '-') ? -1 : 1; if (foundSign = (c == '+' || c == '-')) c = getch(); if (c != EOF \u0026\u0026 !isdigit(c) \u0026\u0026 c != '.') { if (foundSign) ungetch((sign == -1) ? '-' : '+'); // 将符号放回 return 0; } for (*pn = 0; isdigit(c); c = getch()) *pn = 10 * *pn + (c - '0'); if (c == '.') c = getch(); for (power = 1.0; isdigit(c); c = getch()) { *pn = 10 * *pn + (c - '0'); power *= 10; } *pn = sign * (*pn / power); if (c != EOF) ungetch(c); return c; } 运行：\n1 2 1.23 1.230000 exercise5-3 用指针方式实现第 2 章中的函数 strcat。函数 strcat(s, t)将 t 指向的字符串复制到 s 指向的字符串的尾部。\n代码：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 #define MAXLINE 1024 /* strcat: 将 t 指向的字符串复制到 s 指向的字符串的尾部 */ void mstrcat(char *s, const char *t) { // 找到 s 的末尾 while (*s) { s++; } // 将 t 的内容复制到 s 的末尾 while (*t) { *s = *t; s++; t++; } // 添加字符串结束符 *s = '\\0'; } int main() { char s[MAXLINE]; char t[MAXLINE]; printf(\"Please input S and T:\\n\"); scanf(\"%s\", s); scanf(\"%s\", t); mstrcat(s, t); printf(\"ans is: %s\\n\", s); return 0; } 运行：\n1 2 3 Please input S and T: abc def ans is: abcdef exercise5-4 编写函数 strend(s, t)。如果字符串 t 出现在字符串 s 的尾部，该函数返回 1；否则返回 0。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 int strend(const char *s, const char *t) { int i = strlen(s) - 1; int j = strlen(t) - 1; if (j \u003e i) return 0; while (j \u003e= 0) if (s[i--] != t[j--]) return 0; return 1; } int main() { char s[MAXLINE]; char t[MAXLINE]; printf(\"Please input S and T:\\n\"); scanf(\"%s\", s); scanf(\"%s\", t); if (strend(s, t)) printf(\"T appears at the end of S.\\n\"); else printf(\"T does not appear at the end of S.\\n\"); } 运行：\n1 2 3 4 Please input S and T: good o String T does not appear at the end of string S. exercise5-5 实现库函数 strncpy、strncat 和 strncmp，它们最多对参数字符串中的前 n 个字符进行操作。例如，函数 strncpy(s, t, n)将 t 中最多前 n 个字符复制到 s中。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 /* mstrncpy: 将 t 中最多前 n 个字符复制到 s 中 */ char *mstrncpy(char *s, const char *t, int n) { char *ans = s; while (n-- \u0026\u0026 (*s++ = *t++)) ; while ((n--) \u003e 0) *s++ = '\\0'; return ans; } /* mstrncat: 将 t 中最多前 n 个字符连接到 s 的末尾 */ char *mstrncat(char *s, const char *t, int n) { char *ans = s; s += strlen(s); while (n-- \u0026\u0026 (*s++ = *t++)) ; *s = '\\0'; return ans; } /* mstrncmp: 比较 s 和 t 中最多前 n 个字符 */ int mstrncmp(const char *s, const char *t, int n) { while (n-- \u0026\u0026 *s \u0026\u0026 (*s++ == *t++)) ; return n == -1 ? 0 : (*s - *t) != 0; } int main() { char s1[MAXLINE] = \"gooooood\"; char s2[MAXLINE] = \"idea\"; char s3[MAXLINE] = \"good\"; int n1 = 4; int result = mstrncmp(s1, s3, n1); printf(\"mstrncmp(%s, %s, %d):\\n %d\\n\", s1, s3, n1, result); int n2 = 5; mstrncpy(s1, s3, 5); printf(\"mstrncpy(%s, %s, %d):\\n %s\\n\", s1, s3, n2, s1); int n3 = 3; mstrncat(s2, s3, 3); printf(\"mstrncat(%s, %s, %d):\\n %s\\n\", s2, s3, n3, s2); return 0; } 运行：\n1 2 3 4 5 6 mstrncmp(gooooood, good, 4): 1 mstrncpy(good, good, 5): good mstrncat(ideagoo, good, 3): ideagoo exercise5-7 重写函数 readlines，将输入的文本行存储到由 main 函数提供的一个数组中，而不是存储到调用 alloc 分配的存储空间中。该函数的运行速度比改写前快多少？\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 #include #include #include #define MAXLINES 5000 /* max #lines to be sorted */ #define MAXLEN 1000 /* max length of any input line */ char *lineptr[MAXLINES]; /* pointers to text lines */ int Getline(char line[]) { int c, i; for (i = 0; i \u003c MAXLEN - 1 \u0026\u0026 (c = getchar()) != EOF \u0026\u0026 c != '\\n'; i++) line[i] = c; if (c == '\\n') { line[i] = c; i++; } line[i] = '\\0'; return i; } /* swap: interchange v[i] and v[j] */ void swap(char *v[], int i, int j) { char *temp; temp = v[i]; v[i] = v[j]; v[j] = temp; } /* qsort: sort v[left]...v[right] into increasing order */ void qsort(char *v[], int left, int right) { int i, last; void swap(char *v[], int i, int j); if (left \u003e= right) /* do nothing if array contains */ return; /* fewer than two elements */ swap(v, left, (left + right) / 2); last = left; for (i = left + 1; i \u003c= right; i++) if (strcmp(v[i], v[left]) \u003c 0) swap(v, ++last, i); swap(v, left, last); qsort(v, left, last - 1); qsort(v, last + 1, right); } /* readlines: read input lines */ int readlines(char *lineptr[], int maxlines) { int len, nlines; char *p, line[MAXLEN]; nlines = 0; while ((len = Getline(line)) \u003e 0) if (nlines \u003e= maxlines || (p = malloc(len)) == NULL) return -1; else { line[len - 1] = '\\0'; /* delete newline */ strcpy(p, line); lineptr[nlines++] = p; } return nlines; } /* writelines: write output lines */ void writelines(char *lineptr[], int nlines) { int i; for (i = 0; i \u003c nlines; i++) printf(\"%s\\n\", lineptr[i]); } /* sort input lines */ int main() { int nlines; /* number of input lines read */ printf(\"Please input lines:\\n\"); if ((nlines = readlines(lineptr, MAXLINES)) \u003e= 0) { qsort(lineptr, 0, nlines - 1); printf(\"Sorted lines(sorted by first word):\\n\"); writelines(lineptr, nlines); return 0; } else { printf(\"error: input too big to sort\\n\"); return 1; } } 增加函数：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 int readlines2(char linesarray[][MAXLEN], int maxlines) { int len, nlines; nlines = 0; while ((len = Getline(linesarray[nlines])) \u003e 0) if (nlines \u003e= maxlines) return -1; else linesarray[nlines++][len - 1] = '\\0'; return nlines; } int main(int argc, char *argv[]) { printf(\"Please input lines:\"); if (argc \u003e 1 \u0026\u0026 *argv[1] == '2') { printf(\"(by readlines2):\\n\"); int nlines = readlines2(linesarray, MAXLINES); } else { printf(\"(by readlines):\\n\"); int nlines = readlines(lineptr, MAXLINES); } return 0; } exercise5-8 函数 day_of_year 和 month_day 中没有进行错误检查，请解决该问题。\n对输入的月份、天数进行检查\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 #include static char daytab[2][13] = { {0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31}, {0, 31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31}, }; /* day_of_year: set day of year from month \u0026 day */ int day_of_year(int year, int month, int day) { int i, leap; if (month \u003c 1 || month \u003e 12 || day \u003c 1) return -1; leap = year % 4 == 0 \u0026\u0026 year % 100 != 0 || year % 400 == 0; if (day \u003e daytab[leap][month]) return -1; for (i = 1; i \u003c month; i++) day += daytab[leap][i]; return day; } /* month_day: set month, day from day of year */ int month_day(int year, int yearday, int *pmonth, int *pday) { int i, leap; if (yearday \u003c 1) return -1; leap = year % 4 == 0 \u0026\u0026 year % 100 != 0 || year % 400 == 0; if ((leap \u0026\u0026 yearday \u003e 366) || (!leap \u0026\u0026 yearday \u003e 365)) return -1; for (i = 1; yearday \u003e daytab[leap][i]; i++) yearday -= daytab[leap][i]; *pmonth = i; *pday = yearday; return 0; } int main(void) { int year, month, day, yearday; printf(\"Test day_of_year()\\nPlease input year, month and day: \"); scanf(\"%d %d %d\", \u0026year, \u0026month, \u0026day); yearday = day_of_year(year, month, day); if (yearday == -1) printf(\"Wrong date!\\n\"); else printf(\"%d-%d-%d: the %d day in %d\\n\", year, month, day, yearday, year); printf(\"\\nTest month_day()\\nPlease input year and yearday: \"); scanf(\"%d %d\", \u0026year, \u0026yearday); int ans = month_day(year, yearday, \u0026month, \u0026day); if (ans == -1) printf(\"Wrong date!\\n\"); else printf(\"the %d day in %d: %d-%d-%d\\n\", yearday, year, year, month, day); return 0; } 运行：\n1 2 3 4 5 6 7 Test day_of_year() Please input year, month and day: 2002 10 14 2002-10-14: the 287 day in 2002 Test month_day() Please input year and yearday: 2002 287 the 287 day in 2002: 2002-10-14 exercise5-9 用指针方式代替数组下标方式改写函数 day_of_year 和 month_day。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 int day_of_year_ptr(int year, int month, int day) { int i, leap; if (month \u003c 1 || month \u003e 12 || day \u003c 1) return -1; leap = year % 4 == 0 \u0026\u0026 year % 100 != 0 || year % 400 == 0; char *p = \u0026daytab[leap][1]; if (day \u003e *(p + month - 1)) return -1; for (i = 1; i \u003c month; i++) { day += *p; ++p; } return day; } /* month_day: set month, day from day of year */ int month_day_ptr(int year, int yearday, int *pmonth, int *pday) { int i, leap; if (yearday \u003c 1) return -1; leap = year % 4 == 0 \u0026\u0026 year % 100 != 0 || year % 400 == 0; if ((leap \u0026\u0026 yearday \u003e 366) || (!leap \u0026\u0026 yearday \u003e 365)) return -1; char *p = \u0026daytab[leap][1]; for (i = 1; yearday \u003e *p; i++) { yearday -= *p; ++p; } *pmonth = i; *pday = yearday; return 0; } 运行：\n1 2 3 4 5 6 7 Test day_of_year_ptr() Please input year, month and day: 2002 10 14 2002-10-14: the 287 day in 2002 Test month_day_ptr() Please input year and yearday: 2002 287 the 287 day in 2002: 2002-10-14 exercise5-10 编写程序 expr，以计算从命令行输入的逆波兰表达式的值，其中每个运算符或操作数用一个单独的参数表示。例如，命令 expr 2 3 4 + * 将计算表达式 2 × (3 + 4)的值。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 #include #include #include #include #define NUMBER '0' #define MAXVAL 100 /* maximum depth of val stack */ int sp = 0; /* next free stack position */ double val[MAXVAL]; /* value stack */ int isnumber(char *s) { if (strlen(s) == 1 \u0026\u0026 (s[0] == '/' || s[0] == '*' || s[0] == '+' || s[0] == '-')) return s[0]; int i = 0; if (s[i] == '-' || s[i] == '+') i++; for (; isdigit(s[i]); i++) ; if (s[i] == '.') i++; for (; isdigit(s[i]); i++) ; return s[i] == '\\0' ? NUMBER : -1; } /* push: push f onto value stack */ void push(double f) { if (sp \u003c MAXVAL) val[sp++] = f; else printf(\"error: stack full, can't push %g\\n\", f); } /* pop: pop and return top value from stack */ double pop(void) { if (sp \u003e 0) return val[--sp]; else { printf(\"error: stack empty\\n\"); return 0.0; } } int main(int argc, char **argv) { int i; double value; for (i = 1; i \u003c argc; ++i) { switch (isnumber(argv[i])) { case NUMBER: push(atof(argv[i])); break; case '+': push(pop() + pop()); break; case '-': value = pop(); push(pop() - value); break; case '*': push(pop() * pop()); break; case '/': value = pop(); push(pop() / value); break; default: printf(\"wrong argument: %s\\n\", argv[i]); break; } } printf(\"%g\\n\", pop()); return 0; } 运行（命令行中，’*‘需要反斜杠来转义）：\n1 2 ➜ ch05 git:(main) ✗ ./Exercise5-10 2 3 4 + \\* 14 exercise5-13 编写程序 tail，将其输入中的最后 n 行打印出来。默认情况下，n 的值为10，但可通过一个可选参数改变 n 的值，因此，命令tail -n将打印其输入的最后 n 行。无论输入或 n 的值是否合理，该程序都应该能正常运行。编写的程序要充分地利用存储空间；输入行的存储方式应该同 5.6 节中排序程序的存储方式一样，而不采用固定长度的二维数组。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 #include #include #include #include #define MAXLINES 5000 /* max #lines to be sorted */ #define MAXLEN 1000 /* max length of any input line */ char *lineptr[MAXLINES]; /* pointers to text lines */ char linesarray[MAXLINES][MAXLEN]; /*array that store lines*/ int Getline(char line[]) { int c, i; for (i = 0; i \u003c MAXLEN - 1 \u0026\u0026 (c = getchar()) != EOF \u0026\u0026 c != '\\n'; i++) line[i] = c; if (c == '\\n') { line[i] = c; i++; } line[i] = '\\0'; return i; } /* readlines: read input lines */ int readlines(char *lineptr[], int maxlines) { int len, nlines; char *p, line[MAXLEN]; nlines = 0; while ((len = Getline(line)) \u003e 0) if (nlines \u003e= maxlines || (p = malloc(len)) == NULL) return -1; else { line[len - 1] = '\\0'; /* delete newline */ strcpy(p, line); lineptr[nlines++] = p; } return nlines; } /* writelines: write output lines */ void writelines(char *lineptr[], int nlines, int n) { int i; for (i = nlines - n \u003e 0 ? nlines - n : 0; i \u003c nlines; i++) printf(\"%s\\n\", lineptr[i]); } int main(int argc, char *argv[]) { printf(\"Please input lines:\\n\"); int nlines = readlines(lineptr, MAXLINES); if (argc \u003e 1 \u0026\u0026 argv[1][0] == '-') { int n = atoi(argv[1] + 1); printf(\"The last %d lines are:\\n\", n); writelines(lineptr, nlines, n); } else { printf(\"The last 10 lines are:\\n\"); writelines(lineptr, nlines, 10); } return 0; } 运行：\n1 2 3 4 5 6 7 8 ➜ ch05 git:(main) ✗ ./Exercise5-13 -2 Please input lines: sdui qi a The last 2 lines are: qi a exercise5-14 修改排序程序，使它能处理-r 标记。该标记表明，以逆序（递减）方式排序。要保证-r 和-n 能够组合在一起使用。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 int reverse; int mstrcmp(char *s1, char *s2) { char *news1 = reverse ? s2 : s1; char *news2 = reverse ? s1 : s2; return strcmp(news1, news2); } /* numcmp: compare s1 and s2 numerically */ int mnumcmp(char *s1, char *s2) { char *news1 = reverse ? s2 : s1; char *news2 = reverse ? s1 : s2; double v1, v2; v1 = atof(news1); v2 = atof(news2); if (v1 \u003c v2) return -1; else if (v1 \u003e v2) return 1; else return 0; } /* qsort: sort v[left]...v[right] into increasing order */ void mqsort(void *v[], int left, int right, int (*comp)(void *, void *)) { int i, last; if (left \u003e= right) /* do nothing if array contains */ return; /* fewer than two elements */ swap(v, left, (left + right) / 2); last = left; for (i = left + 1; i \u003c= right; i++) if ((*comp)(v[i], v[left]) \u003c 0) swap(v, ++last, i); swap(v, left, last); mqsort(v, left, last - 1, comp); mqsort(v, last + 1, right, comp); } int main(int argc, char *argv[]) { int nlines; /* number of input lines read */ int numeric = 0; /* 1 if numeric sort */ reverse = 0; /* 1 if reverse sort */ if (argc \u003e 1 \u0026\u0026 strcmp(argv[1], \"-n\") == 0) numeric = 1; if (argc \u003e 2 \u0026\u0026 strcmp(argv[2], \"-r\") == 0) reverse = 1; printf(\"Please input data:\\n\"); if ((nlines = readlines(lineptr, MAXLINES)) \u003e= 0) { mqsort((void **)lineptr, 0, nlines - 1, (int (*)(void *, void *))(numeric ? mnumcmp : mstrcmp)); printf(\"After sorted:\\n\"); writelines(lineptr, nlines); return 0; } else { printf(\"input too big to sort\\n\"); return 1; } } 运行：\n1 2 3 4 5 6 7 8 9 ➜ ch05 git:(main) ✗ ./Exercise5-14 -n -r Please input data: 76 44 98 After sorted: 98 76 44 exercise5-15 增加选项-f，使得排序过程不考虑字母大小写之间的区别。例如，比较 a 和 A 时认为它们相等。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 int mstrcmp(char *s1, char *s2) { char *news1 = reverse ? s2 : s1; char *news2 = reverse ? s1 : s2; return fold == 1 ? strcasecmp(news1, news2) : strcmp(news1, news2); } int main(int argc, char *argv[]) { int nlines; /* number of input lines read */ int numeric = 0; /* 1 if numeric sort */ reverse = 0; /* 1 if reverse sort */ for (int i = 1; i \u003c argc; i++) switch (argv[i][1]) { case 'n': numeric = 1; break; case 'r': reverse = 1; break; case 'f': fold = 1; break; } printf(\"Please input data:\\n\"); if ((nlines = readlines(lineptr, MAXLINES)) \u003e= 0) { mqsort((void **)lineptr, 0, nlines - 1, (int (*)(void *, void *))(numeric ? mnumcmp : mstrcmp)); printf(\"After sorted:\\n\"); writelines(lineptr, nlines); return 0; } else { printf(\"input too big to sort\\n\"); return 1; } } 1 2 3 4 5 6 7 ➜ ch05 git:(main) ✗ ./Exercise5-14 -f Please input data: aB Ab After sorted: aB Ab exercise5-16 增加选项-d（代表目录顺序）。该选项表明，只对字母、数字和空格进行比较。要保证该选项可以和-f 组合在一起使用。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 int charcmp(char c1, char c2) { if (dir) { if (!isalnum(c1) \u0026\u0026 c1 != ' ') return 0; if (!isalnum(c2) \u0026\u0026 c2 != ' ') return 0; } if (fold) { c1 = tolower(c1); c2 = tolower(c2); } return c1 - c2; } int mstrcmp(char *s1, char *s2) { char *news1 = reverse ? s2 : s1; char *news2 = reverse ? s1 : s2; while (*news1 \u0026\u0026 *news2) { int cmp = charcmp(*news1, *news2); if (cmp != 0) return cmp; news1++; news2++; } return *news1 ? 1 : (*news2 ? -1 : 0); } /* numcmp: compare s1 and s2 numerically */ int mnumcmp(char *s1, char *s2) { char *news1 = reverse ? s2 : s1; char *news2 = reverse ? s1 : s2; double v1, v2; v1 = atof(news1); v2 = atof(news2); if (v1 \u003c v2) return -1; else if (v1 \u003e v2) return 1; else return 0; } /* qsort: sort v[left]...v[right] into increasing order */ void mqsort(void *v[], int left, int right, int (*comp)(void *, void *)) { int i, last; if (left \u003e= right) /* do nothing if array contains */ return; /* fewer than two elements */ swap(v, left, (left + right) / 2); last = left; for (i = left + 1; i \u003c= right; i++) if ((*comp)(v[i], v[left]) \u003c 0) swap(v, ++last, i); swap(v, left, last); mqsort(v, left, last - 1, comp); mqsort(v, last + 1, right, comp); } int main(int argc, char *argv[]) { int nlines; /* number of input lines read */ int numeric = 0; /* 1 if numeric sort */ reverse = 0; /* 1 if reverse sort */ for (int i = 1; i \u003c argc; i++) switch (argv[i][1]) { case 'n': numeric = 1; break; case 'r': reverse = 1; break; case 'f': fold = 1; break; case 'd': dir = 1; break; } printf(\"Please input data:\\n\"); if ((nlines = readlines(lineptr, MAXLINES)) \u003e= 0) { mqsort((void **)lineptr, 0, nlines - 1, (int (*)(void *, void *))(numeric ? mnumcmp : mstrcmp)); printf(\"After sorted:\\n\"); writelines(lineptr, nlines); return 0; } else { printf(\"input too big to sort\\n\"); return 1; } } 运行：\n1 2 3 4 5 6 7 8 9 10 11 12 13 ➜ ch05 git:(main) ✗ ./Exercise5-16 -d -f Please input data: A+b a-B After sorted: A+b a-B Please input data: a-B A+b After sorted: a-B A+b exercise5-18 修改 dcl 程序，使它能够处理输入中的错误。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 #include #include #include #include #define MAXTOKEN 100 #define BUFSIZE 100 enum { NAME, PARENS, BRACKETS }; int tokentype; /* type of last token */ char token[MAXTOKEN]; /* last token string */ char name[MAXTOKEN]; /* identifier name */ char datatype[MAXTOKEN]; /* data type = char, int, etc. */ char out[1000]; void dcl(void); void dirdcl(void); /* clear remaining characters in input line to recover from errors */ void clear_input() { int c; while ((c = getch()) != '\\n' \u0026\u0026 c != EOF) ; } /* handle and print error messages */ void errmsg(const char *msg) { printf(\"Error: %s\\n\", msg); clear_input(); // Skip to the end of the current line after an error } /* gettoken: return next token */ int gettoken(void) { int c; char *p = token; while ((c = getch()) == ' ' || c == '\\t') // Skip whitespace ; if (c == '(') { if ((c = getch()) == ')') { strcpy(token, \"()\"); return tokentype = PARENS; } else { ungetch(c); return tokentype = '('; } } else if (c == '[') { for (*p++ = c; (*p++ = getch()) != ']';) { if (p - token \u003e= MAXTOKEN - 1) // Prevent buffer overflow { errmsg(\"brackets too long or unclosed\"); return tokentype = -1; } } *p = '\\0'; return tokentype = BRACKETS; } else if (isalpha(c)) { for (*p++ = c; isalnum(c = getch());) { if (p - token \u003e= MAXTOKEN - 1) // Prevent buffer overflow { errmsg(\"name too long\"); return tokentype = -1; } *p++ = c; } *p = '\\0'; ungetch(c); return tokentype = NAME; } else { return tokentype = c; } } /* dcl: parse a declarator */ void dcl(void) { int ns; for (ns = 0; gettoken() == '*';) /* count *'s */ ns++; dirdcl(); while (ns-- \u003e 0) strcat(out, \" pointer to\"); } /* dirdcl: parse a direct declarator */ void dirdcl(void) { int type; if (tokentype == '(') { dcl(); if (tokentype != ')') { errmsg(\"missing )\"); return; } } else if (tokentype == NAME) { strcpy(name, token); } else { errmsg(\"expected name or (dcl)\"); return; } while ((type = gettoken()) == PARENS || type == BRACKETS) { if (type == PARENS) { strcat(out, \" function returning\"); } else { strcat(out, \" array\"); strcat(out, token); strcat(out, \" of\"); } } } int main() /* convert declaration to words */ { while (gettoken() != EOF) { /* 1st token on line */ strcpy(datatype, token); /* is the datatype */ out[0] = '\\0'; dcl(); /* parse rest of line */ if (tokentype != '\\n') printf(\"syntax error\\n\"); printf(\"%s: %s %s\\n\", name, out, datatype); } } 运行：\n1 2 3 4 char *func() func: function returning pointer to char char (*func())() func: function returning pointer to function returning char exercise5-19 修改 undcl 程序，使它在把文字描述转换为声明的过程中不会生成多余的圆括号。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 /* undcl: convert word description to declaration */ int undcl(void) { int type; char temp[MAXTOKEN]; int parentheses_needed = 0; // track when parentheses are necessary while (gettoken() != EOF) { strcpy(out, token); // Initialize out with the first token while ((type = gettoken()) != '\\n') { if (type == PARENS || type == BRACKETS) { strcat(out, token); // Append function or array notation } else if (type == '*') { // Only add parentheses if needed for precedence (i.e., if out is a function or array) if (parentheses_needed) { sprintf(temp, \"(*%s)\", out); parentheses_needed = 0; // reset parentheses flag } else { sprintf(temp, \"*%s\", out); // regular pointer, no parentheses needed } strcpy(out, temp); } else if (type == NAME) { sprintf(temp, \"%s %s\", token, out); // Add name to out strcpy(out, temp); } else { printf(\"invalid input at %s\\n\", token); } } printf(\"%s\\n\", out); } return 0; } 运行：\n1 2 x () * [] * () char char (*(*x())[])() exercise5-20 扩展 dcl 程序的功能，使它能够处理包含其它成分的声明，例如带有函数参数类型的声明、带有类似于 const 限定符的声明等。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 #include #include #include #include #define MAXTOKEN 100 #define BUFSIZE 100 enum { NAME, PARENS, BRACKETS, QUALIFIER, TYPE }; int tokentype; /* type of last token */ char token[MAXTOKEN]; /* last token string */ char name[MAXTOKEN]; /* identifier name */ char datatype[MAXTOKEN]; /* data type = char, int, etc. */ char out[1000]; char buf[BUFSIZE]; /* buffer for ungetch */ int bufp = 0; /* next free position in buf */ void dcl(void); void dirdcl(void); /* get a (possibly pushed-back) character */ int getch(void) { return (bufp \u003e 0) ? buf[--bufp] : getchar(); } /* push character back on input */ void ungetch(int c) { if (bufp \u003e= BUFSIZE) printf(\"ungetch: too many characters\\n\"); else buf[bufp++] = c; } /* clear remaining characters in input line to recover from errors */ void clear_input() { int c; while ((c = getch()) != '\\n' \u0026\u0026 c != EOF) ; } /* handle and print error messages */ void errmsg(const char *msg) { printf(\"Error: %s\\n\", msg); clear_input(); // Skip to the end of the current line after an error } /* gettoken: return next token */ int gettoken(void) { int c; char *p = token; while ((c = getch()) == ' ' || c == '\\t') // Skip whitespace ; if (c == '(') { if ((c = getch()) == ')') { strcpy(token, \"()\"); return tokentype = PARENS; } else { ungetch(c); return tokentype = '('; } } else if (c == '[') { for (*p++ = c; (*p++ = getch()) != ']';) { if (p - token \u003e= MAXTOKEN - 1) // Prevent buffer overflow { errmsg(\"brackets too long or unclosed\"); return tokentype = -1; } } *p = '\\0'; return tokentype = BRACKETS; } else if (isalpha(c)) { for (*p++ = c; isalnum(c = getch());) { if (p - token \u003e= MAXTOKEN - 1) // Prevent buffer overflow { errmsg(\"name too long\"); return tokentype = -1; } *p++ = c; } *p = '\\0'; ungetch(c); // Handle qualifiers and types like const, volatile if (strcmp(token, \"const\") == 0 || strcmp(token, \"volatile\") == 0) { return tokentype = QUALIFIER; } return tokentype = NAME; } else { return tokentype = c; } } /* dcl: parse a declarator */ void dcl(void) { int ns; for (ns = 0; gettoken() == '*';) /* count *'s */ ns++; dirdcl(); while (ns-- \u003e 0) strcat(out, \" pointer to\"); } /* dirdcl: parse a direct declarator */ void dirdcl(void) { int type; if (tokentype == '(') { dcl(); if (tokentype != ')') { errmsg(\"missing )\"); return; } } else if (tokentype == NAME) { strcpy(name, token); } else { errmsg(\"expected name or (dcl)\"); return; } while ((type = gettoken()) == PARENS || type == BRACKETS || type == QUALIFIER) { if (type == PARENS) { strcat(out, \" function returning\"); } else if (type == BRACKETS) { strcat(out, \" array\"); strcat(out, token); strcat(out, \" of\"); } else if (type == QUALIFIER) { strcat(out, \" \"); strcat(out, token); } } } /* parse a function parameter list */ void parse_param_list(void) { while (gettoken() != ')') { if (tokentype == NAME) { strcat(out, \" parameter \"); strcat(out, token); } else if (tokentype == ',') { strcat(out, \", \"); } else if (tokentype == QUALIFIER || tokentype == TYPE) { strcat(out, \" \"); strcat(out, token); } else if (tokentype == '(') { parse_param_list(); // Recursively handle nested parentheses } else { errmsg(\"unexpected token in parameter list\"); break; } } } int main() /* convert declaration to words */ { while (gettoken() != EOF) { /* 1st token on line */ strcpy(datatype, token); /* is the datatype */ out[0] = '\\0'; dcl(); /* parse rest of line */ if (tokentype != '\\n') printf(\"syntax error\\n\"); printf(\"%s: %s %s\\n\", name, out, datatype); } } ","wordCount":"5733","inLanguage":"en","image":"https://fireflyyh.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-10-12T00:00:00Z","dateModified":"2024-10-12T00:00:00Z","author":{"@type":"Person","name":"Jagger"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://fireflyyh.top/posts/tcpl/ch05/"},"publisher":{"@type":"Organization","name":"Jagger's Blog","logo":{"@type":"ImageObject","url":"https://fireflyyh.top/img/yuan.jpg"}}}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-Y30PKHXBN4"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Y30PKHXBN4")</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://fireflyyh.top/ accesskey=h title="Jagger's Blog (Alt + H)"><img src=https://fireflyyh.top/img/laugh.jpg alt aria-label=logo height=35>Jagger's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://fireflyyh.top/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://fireflyyh.top/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://fireflyyh.top/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://fireflyyh.top/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://fireflyyh.top/about/ title=About><span>About</span></a></li><li><a href=https://github.com/starsYHyh/Jagger/ title=Github><span>Github</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://fireflyyh.top/>Home</a>&nbsp;»&nbsp;<a href=https://fireflyyh.top/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">C语言程序设计第二版课后习题--第五章</h1><div class=post-meta><span title='2024-10-12 00:00:00 +0000 UTC'>October 12, 2024</span>&nbsp;·&nbsp;27 min&nbsp;·&nbsp;5733 words&nbsp;·&nbsp;Jagger&nbsp;|&nbsp;<a href=https://github.com/starsYHyh/Jagger/tree/main/content/posts/TCPL/ch05.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#exercise5-1 aria-label=exercise5-1>exercise5-1</a></li><li><a href=#exercise5-2 aria-label=exercise5-2>exercise5-2</a></li><li><a href=#exercise5-3 aria-label=exercise5-3>exercise5-3</a></li><li><a href=#exercise5-4 aria-label=exercise5-4>exercise5-4</a></li><li><a href=#exercise5-5 aria-label=exercise5-5>exercise5-5</a></li><li><a href=#exercise5-7 aria-label=exercise5-7>exercise5-7</a></li><li><a href=#exercise5-8 aria-label=exercise5-8>exercise5-8</a></li><li><a href=#exercise5-9 aria-label=exercise5-9>exercise5-9</a></li><li><a href=#exercise5-10 aria-label=exercise5-10>exercise5-10</a></li><li><a href=#exercise5-13 aria-label=exercise5-13>exercise5-13</a></li><li><a href=#exercise5-14 aria-label=exercise5-14>exercise5-14</a></li><li><a href=#exercise5-15 aria-label=exercise5-15>exercise5-15</a></li><li><a href=#exercise5-16 aria-label=exercise5-16>exercise5-16</a></li><li><a href=#exercise5-18 aria-label=exercise5-18>exercise5-18</a></li><li><a href=#exercise5-19 aria-label=exercise5-19>exercise5-19</a></li><li><a href=#exercise5-20 aria-label=exercise5-20>exercise5-20</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{elements&&(activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")}))},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><blockquote><p>部分答案参考了官方题解和网上的答案，仅供参考，可能也有部分bug未发现或解决。</p></blockquote><h2 id=exercise5-1>exercise5-1<a hidden class=anchor aria-hidden=true href=#exercise5-1>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>getint</span><span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=n>pn</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>c</span><span class=p>,</span> <span class=n>sign</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=nf>isspace</span><span class=p>(</span><span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>()))</span> <span class=cm>/* skip white space */</span>
</span></span><span class=line><span class=cl>        <span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nf>isdigit</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=n>c</span> <span class=o>!=</span> <span class=n>EOF</span> <span class=o>&amp;&amp;</span> <span class=n>c</span> <span class=o>!=</span> <span class=sc>&#39;+&#39;</span> <span class=o>&amp;&amp;</span> <span class=n>c</span> <span class=o>!=</span> <span class=sc>&#39;-&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>ungetch</span><span class=p>(</span><span class=n>c</span><span class=p>);</span> <span class=cm>/* it is not a number */</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>sign</span> <span class=o>=</span> <span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;-&#39;</span><span class=p>)</span> <span class=o>?</span> <span class=o>-</span><span class=mi>1</span> <span class=o>:</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;+&#39;</span> <span class=o>||</span> <span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;-&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=o>*</span><span class=n>pn</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nf>isdigit</span><span class=p>(</span><span class=n>c</span><span class=p>);</span> <span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=n>pn</span> <span class=o>=</span> <span class=mi>10</span> <span class=o>*</span> <span class=o>*</span><span class=n>pn</span> <span class=o>+</span> <span class=p>(</span><span class=n>c</span> <span class=o>-</span> <span class=sc>&#39;0&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>pn</span> <span class=o>*=</span> <span class=n>sign</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>!=</span> <span class=n>EOF</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nf>ungetch</span><span class=p>(</span><span class=n>c</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>在上面的例子中，如果符号+或-的后面紧跟的不是数字，getint 函数将把符号视为数字 0 的有效表达方式。修改该函数，将这种形式的+或-符号重新写回到输入流中。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;ctype.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define SIZE 100
</span></span></span><span class=line><span class=cl><span class=cp>#define BUFSIZE 100
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=n>buf</span><span class=p>[</span><span class=n>BUFSIZE</span><span class=p>];</span> <span class=cm>/* buffer for ungetch */</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>bufp</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>      <span class=cm>/* next free position in buf */</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>notdigit</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>  <span class=cm>/* flag for not a digit */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* getint: get next integer from input into *pn */</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>getint</span><span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=n>pn</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>notdigit</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>c</span><span class=p>,</span> <span class=n>sign</span><span class=p>,</span> <span class=n>foundSign</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=nf>isspace</span><span class=p>(</span><span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>()))</span> <span class=cm>/* skip white space */</span>
</span></span><span class=line><span class=cl>        <span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nf>isdigit</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=n>c</span> <span class=o>!=</span> <span class=n>EOF</span> <span class=o>&amp;&amp;</span> <span class=n>c</span> <span class=o>!=</span> <span class=sc>&#39;+&#39;</span> <span class=o>&amp;&amp;</span> <span class=n>c</span> <span class=o>!=</span> <span class=sc>&#39;-&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>notdigit</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 若不是数字，将字符放回输入流，但是下次依然会读取到这个字符，所以需要注释掉ungtch(c)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// ungetch(c); /* it is not a number */
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>sign</span> <span class=o>=</span> <span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;-&#39;</span><span class=p>)</span> <span class=o>?</span> <span class=o>-</span><span class=mi>1</span> <span class=o>:</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>foundSign</span> <span class=o>=</span> <span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;+&#39;</span> <span class=o>||</span> <span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;-&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>!=</span> <span class=n>EOF</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nf>isdigit</span><span class=p>(</span><span class=n>c</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ungetch(c);
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=n>foundSign</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nf>ungetch</span><span class=p>((</span><span class=n>sign</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=o>?</span> <span class=sc>&#39;-&#39;</span> <span class=o>:</span> <span class=sc>&#39;+&#39;</span><span class=p>);</span>   <span class=c1>// 将符号放回
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=o>*</span><span class=n>pn</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nf>isdigit</span><span class=p>(</span><span class=n>c</span><span class=p>);</span> <span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=n>pn</span> <span class=o>=</span> <span class=mi>10</span> <span class=o>*</span> <span class=o>*</span><span class=n>pn</span> <span class=o>+</span> <span class=p>(</span><span class=n>c</span> <span class=o>-</span> <span class=sc>&#39;0&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>pn</span> <span class=o>*=</span> <span class=n>sign</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>!=</span> <span class=n>EOF</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nf>ungetch</span><span class=p>(</span><span class=n>c</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>n</span><span class=p>,</span> <span class=n>array</span><span class=p>[</span><span class=n>SIZE</span><span class=p>],</span> <span class=nf>getint</span><span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>n</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>n</span> <span class=o>&lt;</span> <span class=n>SIZE</span> <span class=o>&amp;&amp;</span> <span class=nf>getint</span><span class=p>(</span><span class=o>&amp;</span><span class=n>array</span><span class=p>[</span><span class=n>n</span><span class=p>])</span> <span class=o>!=</span> <span class=n>EOF</span><span class=p>;</span> <span class=n>n</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>notdigit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Not a number</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>array</span><span class=p>[</span><span class=n>n</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>-1 <span class=m>2</span>
</span></span><span class=line><span class=cl>-1
</span></span><span class=line><span class=cl><span class=m>2</span>
</span></span><span class=line><span class=cl>s2
</span></span><span class=line><span class=cl>Not a number
</span></span><span class=line><span class=cl><span class=m>2</span>
</span></span><span class=line><span class=cl>-s2
</span></span><span class=line><span class=cl><span class=m>0</span>
</span></span><span class=line><span class=cl>-2
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise5-2>exercise5-2<a hidden class=anchor aria-hidden=true href=#exercise5-2>#</a></h2><blockquote><p>模仿函数 getint 的实现方法，编写一个读取浮点数的函数 getfloat。getfloat 函数的返回值应该是什么类型？</p></blockquote><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>getfloat</span><span class=p>(</span><span class=kt>float</span> <span class=o>*</span><span class=n>pn</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>notdigit</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>c</span><span class=p>,</span> <span class=n>sign</span><span class=p>,</span> <span class=n>foundSign</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>float</span> <span class=n>power</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=nf>isspace</span><span class=p>(</span><span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>()))</span> <span class=cm>/* skip white space */</span>
</span></span><span class=line><span class=cl>        <span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nf>isdigit</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=n>c</span> <span class=o>!=</span> <span class=n>EOF</span> <span class=o>&amp;&amp;</span> <span class=n>c</span> <span class=o>!=</span> <span class=sc>&#39;+&#39;</span> <span class=o>&amp;&amp;</span> <span class=n>c</span> <span class=o>!=</span> <span class=sc>&#39;-&#39;</span> <span class=o>&amp;&amp;</span> <span class=n>c</span> <span class=o>!=</span> <span class=sc>&#39;.&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>notdigit</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>sign</span> <span class=o>=</span> <span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;-&#39;</span><span class=p>)</span> <span class=o>?</span> <span class=o>-</span><span class=mi>1</span> <span class=o>:</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>foundSign</span> <span class=o>=</span> <span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;+&#39;</span> <span class=o>||</span> <span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;-&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>!=</span> <span class=n>EOF</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nf>isdigit</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=n>c</span> <span class=o>!=</span> <span class=sc>&#39;.&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>foundSign</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nf>ungetch</span><span class=p>((</span><span class=n>sign</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=o>?</span> <span class=sc>&#39;-&#39;</span> <span class=o>:</span> <span class=sc>&#39;+&#39;</span><span class=p>);</span>   <span class=c1>// 将符号放回
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=o>*</span><span class=n>pn</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nf>isdigit</span><span class=p>(</span><span class=n>c</span><span class=p>);</span> <span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=n>pn</span> <span class=o>=</span> <span class=mi>10</span> <span class=o>*</span> <span class=o>*</span><span class=n>pn</span> <span class=o>+</span> <span class=p>(</span><span class=n>c</span> <span class=o>-</span> <span class=sc>&#39;0&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;.&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>power</span> <span class=o>=</span> <span class=mf>1.0</span><span class=p>;</span> <span class=nf>isdigit</span><span class=p>(</span><span class=n>c</span><span class=p>);</span> <span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=n>pn</span> <span class=o>=</span> <span class=mi>10</span> <span class=o>*</span> <span class=o>*</span><span class=n>pn</span> <span class=o>+</span> <span class=p>(</span><span class=n>c</span> <span class=o>-</span> <span class=sc>&#39;0&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>power</span> <span class=o>*=</span> <span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>pn</span> <span class=o>=</span> <span class=n>sign</span> <span class=o>*</span> <span class=p>(</span><span class=o>*</span><span class=n>pn</span> <span class=o>/</span> <span class=n>power</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>!=</span> <span class=n>EOF</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nf>ungetch</span><span class=p>(</span><span class=n>c</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>1.23
</span></span><span class=line><span class=cl>1.230000
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise5-3>exercise5-3<a hidden class=anchor aria-hidden=true href=#exercise5-3>#</a></h2><blockquote><p>用指针方式实现第 2 章中的函数 strcat。函数 strcat(s, t)将 t 指向的字符串复制到 s 指向的字符串的尾部。</p></blockquote><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#define MAXLINE 1024
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cm>/* strcat: 将 t 指向的字符串复制到 s 指向的字符串的尾部 */</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>mstrcat</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>s</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 找到 s 的末尾
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>while</span> <span class=p>(</span><span class=o>*</span><span class=n>s</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 将 t 的内容复制到 s 的末尾
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>while</span> <span class=p>(</span><span class=o>*</span><span class=n>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=n>s</span> <span class=o>=</span> <span class=o>*</span><span class=n>t</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 添加字符串结束符
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>*</span><span class=n>s</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>s</span><span class=p>[</span><span class=n>MAXLINE</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>t</span><span class=p>[</span><span class=n>MAXLINE</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Please input S and T:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=n>t</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>mstrcat</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>t</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;ans is: %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>Please input S and T:
</span></span><span class=line><span class=cl>abc def
</span></span><span class=line><span class=cl>ans is: abcdef
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise5-4>exercise5-4<a hidden class=anchor aria-hidden=true href=#exercise5-4>#</a></h2><blockquote><p>编写函数 strend(s, t)。如果字符串 t 出现在字符串 s 的尾部，该函数返回 1；否则返回 0。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>strend</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>s</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>t</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>j</span> <span class=o>&gt;</span> <span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=n>j</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=o>--</span><span class=p>]</span> <span class=o>!=</span> <span class=n>t</span><span class=p>[</span><span class=n>j</span><span class=o>--</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>s</span><span class=p>[</span><span class=n>MAXLINE</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>t</span><span class=p>[</span><span class=n>MAXLINE</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Please input S and T:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=n>t</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nf>strend</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>t</span><span class=p>))</span> 
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;T appears at the end of S.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> 
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;T does not appear at the end of S.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>Please input S and T:
</span></span><span class=line><span class=cl>good
</span></span><span class=line><span class=cl>o
</span></span><span class=line><span class=cl>String T does not appear at the end of string S.
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise5-5>exercise5-5<a hidden class=anchor aria-hidden=true href=#exercise5-5>#</a></h2><blockquote><p>实现库函数 strncpy、strncat 和 strncmp，它们最多对参数字符串中的前 n 个字符进行操作。例如，函数 strncpy(s, t, n)将 t 中最多前 n 个字符复制到 s中。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cm>/* mstrncpy: 将 t 中最多前 n 个字符复制到 s 中 */</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=o>*</span><span class=nf>mstrncpy</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>s</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>t</span><span class=p>,</span> <span class=kt>int</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>ans</span> <span class=o>=</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=n>n</span><span class=o>--</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=o>*</span><span class=n>s</span><span class=o>++</span> <span class=o>=</span> <span class=o>*</span><span class=n>t</span><span class=o>++</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>((</span><span class=n>n</span><span class=o>--</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=n>s</span><span class=o>++</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ans</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* mstrncat: 将 t 中最多前 n 个字符连接到 s 的末尾 */</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=o>*</span><span class=nf>mstrncat</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>s</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>t</span><span class=p>,</span> <span class=kt>int</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>ans</span> <span class=o>=</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>+=</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=n>n</span><span class=o>--</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=o>*</span><span class=n>s</span><span class=o>++</span> <span class=o>=</span> <span class=o>*</span><span class=n>t</span><span class=o>++</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>s</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ans</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* mstrncmp: 比较 s 和 t 中最多前 n 个字符 */</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>mstrncmp</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>s</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>t</span><span class=p>,</span> <span class=kt>int</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=n>n</span><span class=o>--</span> <span class=o>&amp;&amp;</span> <span class=o>*</span><span class=n>s</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=o>*</span><span class=n>s</span><span class=o>++</span> <span class=o>==</span> <span class=o>*</span><span class=n>t</span><span class=o>++</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>n</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span> <span class=o>?</span> <span class=mi>0</span> <span class=o>:</span> <span class=p>(</span><span class=o>*</span><span class=n>s</span> <span class=o>-</span> <span class=o>*</span><span class=n>t</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>s1</span><span class=p>[</span><span class=n>MAXLINE</span><span class=p>]</span> <span class=o>=</span> <span class=s>&#34;gooooood&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>s2</span><span class=p>[</span><span class=n>MAXLINE</span><span class=p>]</span> <span class=o>=</span> <span class=s>&#34;idea&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>s3</span><span class=p>[</span><span class=n>MAXLINE</span><span class=p>]</span> <span class=o>=</span> <span class=s>&#34;good&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>n1</span> <span class=o>=</span> <span class=mi>4</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>result</span> <span class=o>=</span> <span class=nf>mstrncmp</span><span class=p>(</span><span class=n>s1</span><span class=p>,</span> <span class=n>s3</span><span class=p>,</span> <span class=n>n1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;mstrncmp(%s, %s, %d):</span><span class=se>\n</span><span class=s> %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>s1</span><span class=p>,</span> <span class=n>s3</span><span class=p>,</span> <span class=n>n1</span><span class=p>,</span> <span class=n>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>n2</span> <span class=o>=</span> <span class=mi>5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>mstrncpy</span><span class=p>(</span><span class=n>s1</span><span class=p>,</span> <span class=n>s3</span><span class=p>,</span> <span class=mi>5</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;mstrncpy(%s, %s, %d):</span><span class=se>\n</span><span class=s> %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>s1</span><span class=p>,</span> <span class=n>s3</span><span class=p>,</span> <span class=n>n2</span><span class=p>,</span> <span class=n>s1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>n3</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>mstrncat</span><span class=p>(</span><span class=n>s2</span><span class=p>,</span> <span class=n>s3</span><span class=p>,</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;mstrncat(%s, %s, %d):</span><span class=se>\n</span><span class=s> %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>s2</span><span class=p>,</span> <span class=n>s3</span><span class=p>,</span> <span class=n>n3</span><span class=p>,</span> <span class=n>s2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mstrncmp<span class=o>(</span>gooooood, good, 4<span class=o>)</span>:
</span></span><span class=line><span class=cl> <span class=m>1</span>
</span></span><span class=line><span class=cl>mstrncpy<span class=o>(</span>good, good, 5<span class=o>)</span>:
</span></span><span class=line><span class=cl> good
</span></span><span class=line><span class=cl>mstrncat<span class=o>(</span>ideagoo, good, 3<span class=o>)</span>:
</span></span><span class=line><span class=cl> ideagoo
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise5-7>exercise5-7<a hidden class=anchor aria-hidden=true href=#exercise5-7>#</a></h2><blockquote><p>重写函数 readlines，将输入的文本行存储到由 main 函数提供的一个数组中，而不是存储到调用 alloc 分配的存储空间中。该函数的运行速度比改写前快多少？</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;malloc.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define MAXLINES 5000 </span><span class=cm>/* max #lines to be sorted */</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#define MAXLEN 1000   </span><span class=cm>/* max length of any input line */</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=o>*</span><span class=n>lineptr</span><span class=p>[</span><span class=n>MAXLINES</span><span class=p>];</span> <span class=cm>/* pointers to text lines */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>Getline</span><span class=p>(</span><span class=kt>char</span> <span class=n>line</span><span class=p>[])</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>c</span><span class=p>,</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>MAXLEN</span> <span class=o>-</span> <span class=mi>1</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>c</span> <span class=o>=</span> <span class=nf>getchar</span><span class=p>())</span> <span class=o>!=</span> <span class=n>EOF</span> <span class=o>&amp;&amp;</span> <span class=n>c</span> <span class=o>!=</span> <span class=sc>&#39;\n&#39;</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>line</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;\n&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>line</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>line</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* swap: interchange v[i] and v[j] */</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>swap</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>v</span><span class=p>[],</span> <span class=kt>int</span> <span class=n>i</span><span class=p>,</span> <span class=kt>int</span> <span class=n>j</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>temp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>temp</span> <span class=o>=</span> <span class=n>v</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>v</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>v</span><span class=p>[</span><span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>v</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>temp</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* qsort: sort v[left]...v[right] into increasing order */</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>qsort</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>v</span><span class=p>[],</span> <span class=kt>int</span> <span class=n>left</span><span class=p>,</span> <span class=kt>int</span> <span class=n>right</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span><span class=p>,</span> <span class=n>last</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>swap</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>v</span><span class=p>[],</span> <span class=kt>int</span> <span class=n>i</span><span class=p>,</span> <span class=kt>int</span> <span class=n>j</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>left</span> <span class=o>&gt;=</span> <span class=n>right</span><span class=p>)</span> <span class=cm>/* do nothing if array contains */</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span><span class=p>;</span>        <span class=cm>/* fewer than two elements */</span>
</span></span><span class=line><span class=cl>    <span class=nf>swap</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>left</span><span class=p>,</span> <span class=p>(</span><span class=n>left</span> <span class=o>+</span> <span class=n>right</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>last</span> <span class=o>=</span> <span class=n>left</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=n>left</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>right</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nf>strcmp</span><span class=p>(</span><span class=n>v</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>v</span><span class=p>[</span><span class=n>left</span><span class=p>])</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nf>swap</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=o>++</span><span class=n>last</span><span class=p>,</span> <span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>swap</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>left</span><span class=p>,</span> <span class=n>last</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>qsort</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>left</span><span class=p>,</span> <span class=n>last</span> <span class=o>-</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>qsort</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>last</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>right</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* readlines: read input lines */</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>readlines</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>lineptr</span><span class=p>[],</span> <span class=kt>int</span> <span class=n>maxlines</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>len</span><span class=p>,</span> <span class=n>nlines</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>p</span><span class=p>,</span> <span class=n>line</span><span class=p>[</span><span class=n>MAXLEN</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>nlines</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>((</span><span class=n>len</span> <span class=o>=</span> <span class=nf>Getline</span><span class=p>(</span><span class=n>line</span><span class=p>))</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>nlines</span> <span class=o>&gt;=</span> <span class=n>maxlines</span> <span class=o>||</span> <span class=p>(</span><span class=n>p</span> <span class=o>=</span> <span class=nf>malloc</span><span class=p>(</span><span class=n>len</span><span class=p>))</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>line</span><span class=p>[</span><span class=n>len</span> <span class=o>-</span> <span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span> <span class=cm>/* delete newline */</span>
</span></span><span class=line><span class=cl>            <span class=nf>strcpy</span><span class=p>(</span><span class=n>p</span><span class=p>,</span> <span class=n>line</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>lineptr</span><span class=p>[</span><span class=n>nlines</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>nlines</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* writelines: write output lines */</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>writelines</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>lineptr</span><span class=p>[],</span> <span class=kt>int</span> <span class=n>nlines</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>nlines</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>lineptr</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* sort input lines */</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>nlines</span><span class=p>;</span> <span class=cm>/* number of input lines read */</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Please input lines:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>((</span><span class=n>nlines</span> <span class=o>=</span> <span class=nf>readlines</span><span class=p>(</span><span class=n>lineptr</span><span class=p>,</span> <span class=n>MAXLINES</span><span class=p>))</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>qsort</span><span class=p>(</span><span class=n>lineptr</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>nlines</span> <span class=o>-</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Sorted lines(sorted by first word):</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>writelines</span><span class=p>(</span><span class=n>lineptr</span><span class=p>,</span> <span class=n>nlines</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;error: input too big to sort</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>增加函数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>readlines2</span><span class=p>(</span><span class=kt>char</span> <span class=n>linesarray</span><span class=p>[][</span><span class=n>MAXLEN</span><span class=p>],</span> <span class=kt>int</span> <span class=n>maxlines</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>len</span><span class=p>,</span> <span class=n>nlines</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>nlines</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>((</span><span class=n>len</span> <span class=o>=</span> <span class=nf>Getline</span><span class=p>(</span><span class=n>linesarray</span><span class=p>[</span><span class=n>nlines</span><span class=p>]))</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>nlines</span> <span class=o>&gt;=</span> <span class=n>maxlines</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=n>linesarray</span><span class=p>[</span><span class=n>nlines</span><span class=o>++</span><span class=p>][</span><span class=n>len</span> <span class=o>-</span> <span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>nlines</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[])</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Please input lines:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>argc</span> <span class=o>&gt;</span> <span class=mi>1</span> <span class=o>&amp;&amp;</span> <span class=o>*</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=sc>&#39;2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;(by readlines2):</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>nlines</span> <span class=o>=</span> <span class=nf>readlines2</span><span class=p>(</span><span class=n>linesarray</span><span class=p>,</span> <span class=n>MAXLINES</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;(by readlines):</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>nlines</span> <span class=o>=</span> <span class=nf>readlines</span><span class=p>(</span><span class=n>lineptr</span><span class=p>,</span> <span class=n>MAXLINES</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise5-8>exercise5-8<a hidden class=anchor aria-hidden=true href=#exercise5-8>#</a></h2><blockquote><p>函数 day_of_year 和 month_day 中没有进行错误检查，请解决该问题。</p></blockquote><p>对输入的月份、天数进行检查</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>static</span> <span class=kt>char</span> <span class=n>daytab</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>13</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=mi>0</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>28</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>31</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=mi>0</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>29</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>31</span><span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=cm>/* day_of_year: set day of year from month &amp; day */</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>day_of_year</span><span class=p>(</span><span class=kt>int</span> <span class=n>year</span><span class=p>,</span> <span class=kt>int</span> <span class=n>month</span><span class=p>,</span> <span class=kt>int</span> <span class=n>day</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span><span class=p>,</span> <span class=n>leap</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>month</span> <span class=o>&lt;</span> <span class=mi>1</span> <span class=o>||</span> <span class=n>month</span> <span class=o>&gt;</span> <span class=mi>12</span> <span class=o>||</span> <span class=n>day</span> <span class=o>&lt;</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>leap</span> <span class=o>=</span> <span class=n>year</span> <span class=o>%</span> <span class=mi>4</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>year</span> <span class=o>%</span> <span class=mi>100</span> <span class=o>!=</span> <span class=mi>0</span> <span class=o>||</span> <span class=n>year</span> <span class=o>%</span> <span class=mi>400</span> <span class=o>==</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>day</span> <span class=o>&gt;</span> <span class=n>daytab</span><span class=p>[</span><span class=n>leap</span><span class=p>][</span><span class=n>month</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>month</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>day</span> <span class=o>+=</span> <span class=n>daytab</span><span class=p>[</span><span class=n>leap</span><span class=p>][</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>day</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cm>/* month_day: set month, day from day of year */</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>month_day</span><span class=p>(</span><span class=kt>int</span> <span class=n>year</span><span class=p>,</span> <span class=kt>int</span> <span class=n>yearday</span><span class=p>,</span> <span class=kt>int</span> <span class=o>*</span><span class=n>pmonth</span><span class=p>,</span> <span class=kt>int</span> <span class=o>*</span><span class=n>pday</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span><span class=p>,</span> <span class=n>leap</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>yearday</span> <span class=o>&lt;</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>leap</span> <span class=o>=</span> <span class=n>year</span> <span class=o>%</span> <span class=mi>4</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>year</span> <span class=o>%</span> <span class=mi>100</span> <span class=o>!=</span> <span class=mi>0</span> <span class=o>||</span> <span class=n>year</span> <span class=o>%</span> <span class=mi>400</span> <span class=o>==</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>((</span><span class=n>leap</span> <span class=o>&amp;&amp;</span> <span class=n>yearday</span> <span class=o>&gt;</span> <span class=mi>366</span><span class=p>)</span> <span class=o>||</span> <span class=p>(</span><span class=o>!</span><span class=n>leap</span> <span class=o>&amp;&amp;</span> <span class=n>yearday</span> <span class=o>&gt;</span> <span class=mi>365</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>yearday</span> <span class=o>&gt;</span> <span class=n>daytab</span><span class=p>[</span><span class=n>leap</span><span class=p>][</span><span class=n>i</span><span class=p>];</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>yearday</span> <span class=o>-=</span> <span class=n>daytab</span><span class=p>[</span><span class=n>leap</span><span class=p>][</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>pmonth</span> <span class=o>=</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>pday</span> <span class=o>=</span> <span class=n>yearday</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>year</span><span class=p>,</span> <span class=n>month</span><span class=p>,</span> <span class=n>day</span><span class=p>,</span> <span class=n>yearday</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Test day_of_year()</span><span class=se>\n</span><span class=s>Please input year, month and day: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%d %d %d&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>year</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>month</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>day</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>yearday</span> <span class=o>=</span> <span class=nf>day_of_year</span><span class=p>(</span><span class=n>year</span><span class=p>,</span> <span class=n>month</span><span class=p>,</span> <span class=n>day</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>yearday</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Wrong date!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> 
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%d-%d-%d: the %d day in %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>year</span><span class=p>,</span> <span class=n>month</span><span class=p>,</span> <span class=n>day</span><span class=p>,</span> <span class=n>yearday</span><span class=p>,</span> <span class=n>year</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\n</span><span class=s>Test month_day()</span><span class=se>\n</span><span class=s>Please input year and yearday: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%d %d&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>year</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>yearday</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>ans</span> <span class=o>=</span> <span class=nf>month_day</span><span class=p>(</span><span class=n>year</span><span class=p>,</span> <span class=n>yearday</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>month</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>day</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>ans</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Wrong date!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> 
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;the %d day in %d: %d-%d-%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>yearday</span><span class=p>,</span> <span class=n>year</span><span class=p>,</span> <span class=n>year</span><span class=p>,</span> <span class=n>month</span><span class=p>,</span> <span class=n>day</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>Test day_of_year<span class=o>()</span>
</span></span><span class=line><span class=cl>Please input year, month and day: <span class=m>2002</span> <span class=m>10</span> <span class=m>14</span>
</span></span><span class=line><span class=cl>2002-10-14: the <span class=m>287</span> day in <span class=m>2002</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Test month_day<span class=o>()</span>
</span></span><span class=line><span class=cl>Please input year and yearday: <span class=m>2002</span> <span class=m>287</span>
</span></span><span class=line><span class=cl>the <span class=m>287</span> day in 2002: 2002-10-14
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise5-9>exercise5-9<a hidden class=anchor aria-hidden=true href=#exercise5-9>#</a></h2><blockquote><p>用指针方式代替数组下标方式改写函数 day_of_year 和 month_day。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>day_of_year_ptr</span><span class=p>(</span><span class=kt>int</span> <span class=n>year</span><span class=p>,</span> <span class=kt>int</span> <span class=n>month</span><span class=p>,</span> <span class=kt>int</span> <span class=n>day</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span><span class=p>,</span> <span class=n>leap</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>month</span> <span class=o>&lt;</span> <span class=mi>1</span> <span class=o>||</span> <span class=n>month</span> <span class=o>&gt;</span> <span class=mi>12</span> <span class=o>||</span> <span class=n>day</span> <span class=o>&lt;</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>leap</span> <span class=o>=</span> <span class=n>year</span> <span class=o>%</span> <span class=mi>4</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>year</span> <span class=o>%</span> <span class=mi>100</span> <span class=o>!=</span> <span class=mi>0</span> <span class=o>||</span> <span class=n>year</span> <span class=o>%</span> <span class=mi>400</span> <span class=o>==</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>p</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>daytab</span><span class=p>[</span><span class=n>leap</span><span class=p>][</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>day</span> <span class=o>&gt;</span> <span class=o>*</span><span class=p>(</span><span class=n>p</span> <span class=o>+</span> <span class=n>month</span> <span class=o>-</span> <span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>month</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>day</span> <span class=o>+=</span> <span class=o>*</span><span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=o>++</span><span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>day</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cm>/* month_day: set month, day from day of year */</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>month_day_ptr</span><span class=p>(</span><span class=kt>int</span> <span class=n>year</span><span class=p>,</span> <span class=kt>int</span> <span class=n>yearday</span><span class=p>,</span> <span class=kt>int</span> <span class=o>*</span><span class=n>pmonth</span><span class=p>,</span> <span class=kt>int</span> <span class=o>*</span><span class=n>pday</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span><span class=p>,</span> <span class=n>leap</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>yearday</span> <span class=o>&lt;</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>leap</span> <span class=o>=</span> <span class=n>year</span> <span class=o>%</span> <span class=mi>4</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>year</span> <span class=o>%</span> <span class=mi>100</span> <span class=o>!=</span> <span class=mi>0</span> <span class=o>||</span> <span class=n>year</span> <span class=o>%</span> <span class=mi>400</span> <span class=o>==</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>((</span><span class=n>leap</span> <span class=o>&amp;&amp;</span> <span class=n>yearday</span> <span class=o>&gt;</span> <span class=mi>366</span><span class=p>)</span> <span class=o>||</span> <span class=p>(</span><span class=o>!</span><span class=n>leap</span> <span class=o>&amp;&amp;</span> <span class=n>yearday</span> <span class=o>&gt;</span> <span class=mi>365</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>p</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>daytab</span><span class=p>[</span><span class=n>leap</span><span class=p>][</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>yearday</span> <span class=o>&gt;</span> <span class=o>*</span><span class=n>p</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>yearday</span> <span class=o>-=</span> <span class=o>*</span><span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=o>++</span><span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>pmonth</span> <span class=o>=</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>pday</span> <span class=o>=</span> <span class=n>yearday</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>Test day_of_year_ptr<span class=o>()</span>
</span></span><span class=line><span class=cl>Please input year, month and day: <span class=m>2002</span> <span class=m>10</span> <span class=m>14</span>
</span></span><span class=line><span class=cl>2002-10-14: the <span class=m>287</span> day in <span class=m>2002</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Test month_day_ptr<span class=o>()</span>
</span></span><span class=line><span class=cl>Please input year and yearday: <span class=m>2002</span> <span class=m>287</span>
</span></span><span class=line><span class=cl>the <span class=m>287</span> day in 2002: 2002-10-14
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise5-10>exercise5-10<a hidden class=anchor aria-hidden=true href=#exercise5-10>#</a></h2><blockquote><p>编写程序 expr，以计算从命令行输入的逆波兰表达式的值，其中每个运算符或操作数用一个单独的参数表示。例如，命令
expr 2 3 4 + *
将计算表达式 2 × (3 + 4)的值。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;ctype.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define NUMBER &#39;0&#39;
</span></span></span><span class=line><span class=cl><span class=cp>#define MAXVAL 100  </span><span class=cm>/* maximum depth of val stack */</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=n>sp</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>         <span class=cm>/* next free stack position */</span>
</span></span><span class=line><span class=cl><span class=kt>double</span> <span class=n>val</span><span class=p>[</span><span class=n>MAXVAL</span><span class=p>];</span> <span class=cm>/* value stack */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>isnumber</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nf>strlen</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=sc>&#39;/&#39;</span> <span class=o>||</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=sc>&#39;*&#39;</span> <span class=o>||</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=sc>&#39;+&#39;</span> <span class=o>||</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=sc>&#39;-&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>s</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=sc>&#39;-&#39;</span> <span class=o>||</span> <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=sc>&#39;+&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(;</span> <span class=nf>isdigit</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=sc>&#39;.&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(;</span> <span class=nf>isdigit</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=sc>&#39;\0&#39;</span> <span class=o>?</span> <span class=nl>NUMBER</span> <span class=p>:</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* push: push f onto value stack */</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>push</span><span class=p>(</span><span class=kt>double</span> <span class=n>f</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>sp</span> <span class=o>&lt;</span> <span class=n>MAXVAL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>val</span><span class=p>[</span><span class=n>sp</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=n>f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;error: stack full, can&#39;t push %g</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>f</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* pop: pop and return top value from stack */</span>
</span></span><span class=line><span class=cl><span class=kt>double</span> <span class=nf>pop</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>sp</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>val</span><span class=p>[</span><span class=o>--</span><span class=n>sp</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;error: stack empty</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mf>0.0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>double</span> <span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>argc</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=p>(</span><span class=nf>isnumber</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=n>i</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=nl>NUMBER</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nf>push</span><span class=p>(</span><span class=nf>atof</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=n>i</span><span class=p>]));</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=sc>&#39;+&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=nf>push</span><span class=p>(</span><span class=nf>pop</span><span class=p>()</span> <span class=o>+</span> <span class=nf>pop</span><span class=p>());</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=sc>&#39;-&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=n>value</span> <span class=o>=</span> <span class=nf>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nf>push</span><span class=p>(</span><span class=nf>pop</span><span class=p>()</span> <span class=o>-</span> <span class=n>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=sc>&#39;*&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=nf>push</span><span class=p>(</span><span class=nf>pop</span><span class=p>()</span> <span class=o>*</span> <span class=nf>pop</span><span class=p>());</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=sc>&#39;/&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=n>value</span> <span class=o>=</span> <span class=nf>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nf>push</span><span class=p>(</span><span class=nf>pop</span><span class=p>()</span> <span class=o>/</span> <span class=n>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;wrong argument: %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>argv</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%g</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=nf>pop</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>运行（命令行中，&rsquo;*&lsquo;需要反斜杠来转义）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>➜  ch05 git:<span class=o>(</span>main<span class=o>)</span> ✗ ./Exercise5-10 <span class=m>2</span> <span class=m>3</span> <span class=m>4</span> + <span class=se>\*</span>
</span></span><span class=line><span class=cl><span class=m>14</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise5-13>exercise5-13<a hidden class=anchor aria-hidden=true href=#exercise5-13>#</a></h2><blockquote><p>编写程序 tail，将其输入中的最后 n 行打印出来。默认情况下，n 的值为10，但可通过一个可选参数改变 n 的值，因此，命令<code>tail -n</code>将打印其输入的最后 n 行。无论输入或 n 的值是否合理，该程序都应该能正常运行。编写的程序要充分地利用存储空间；输入行的存储方式应该同 5.6 节中排序程序的存储方式一样，而不采用固定长度的二维数组。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;malloc.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define MAXLINES 5000 </span><span class=cm>/* max #lines to be sorted */</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#define MAXLEN 1000   </span><span class=cm>/* max length of any input line */</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=o>*</span><span class=n>lineptr</span><span class=p>[</span><span class=n>MAXLINES</span><span class=p>];</span>           <span class=cm>/* pointers to text lines */</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=n>linesarray</span><span class=p>[</span><span class=n>MAXLINES</span><span class=p>][</span><span class=n>MAXLEN</span><span class=p>];</span> <span class=cm>/*array that store lines*/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>Getline</span><span class=p>(</span><span class=kt>char</span> <span class=n>line</span><span class=p>[])</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>c</span><span class=p>,</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>MAXLEN</span> <span class=o>-</span> <span class=mi>1</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>c</span> <span class=o>=</span> <span class=nf>getchar</span><span class=p>())</span> <span class=o>!=</span> <span class=n>EOF</span> <span class=o>&amp;&amp;</span> <span class=n>c</span> <span class=o>!=</span> <span class=sc>&#39;\n&#39;</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>line</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;\n&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>line</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>line</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* readlines: read input lines */</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>readlines</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>lineptr</span><span class=p>[],</span> <span class=kt>int</span> <span class=n>maxlines</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>len</span><span class=p>,</span> <span class=n>nlines</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>p</span><span class=p>,</span> <span class=n>line</span><span class=p>[</span><span class=n>MAXLEN</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>nlines</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>((</span><span class=n>len</span> <span class=o>=</span> <span class=nf>Getline</span><span class=p>(</span><span class=n>line</span><span class=p>))</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>nlines</span> <span class=o>&gt;=</span> <span class=n>maxlines</span> <span class=o>||</span> <span class=p>(</span><span class=n>p</span> <span class=o>=</span> <span class=nf>malloc</span><span class=p>(</span><span class=n>len</span><span class=p>))</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>line</span><span class=p>[</span><span class=n>len</span> <span class=o>-</span> <span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span> <span class=cm>/* delete newline */</span>
</span></span><span class=line><span class=cl>            <span class=nf>strcpy</span><span class=p>(</span><span class=n>p</span><span class=p>,</span> <span class=n>line</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>lineptr</span><span class=p>[</span><span class=n>nlines</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>nlines</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* writelines: write output lines */</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>writelines</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>lineptr</span><span class=p>[],</span> <span class=kt>int</span> <span class=n>nlines</span><span class=p>,</span> <span class=kt>int</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=n>nlines</span> <span class=o>-</span> <span class=n>n</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>?</span> <span class=n>nlines</span> <span class=o>-</span> <span class=nl>n</span> <span class=p>:</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>nlines</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>lineptr</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[])</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Please input lines:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>nlines</span> <span class=o>=</span> <span class=nf>readlines</span><span class=p>(</span><span class=n>lineptr</span><span class=p>,</span> <span class=n>MAXLINES</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>argc</span> <span class=o>&gt;</span> <span class=mi>1</span> <span class=o>&amp;&amp;</span> <span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=sc>&#39;-&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>n</span> <span class=o>=</span> <span class=nf>atoi</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;The last %d lines are:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>n</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>writelines</span><span class=p>(</span><span class=n>lineptr</span><span class=p>,</span> <span class=n>nlines</span><span class=p>,</span> <span class=n>n</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;The last 10 lines are:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>writelines</span><span class=p>(</span><span class=n>lineptr</span><span class=p>,</span> <span class=n>nlines</span><span class=p>,</span> <span class=mi>10</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>➜  ch05 git:<span class=o>(</span>main<span class=o>)</span> ✗ ./Exercise5-13 -2
</span></span><span class=line><span class=cl>Please input lines:
</span></span><span class=line><span class=cl>sdui
</span></span><span class=line><span class=cl>qi
</span></span><span class=line><span class=cl>a
</span></span><span class=line><span class=cl>The last <span class=m>2</span> lines are:
</span></span><span class=line><span class=cl>qi
</span></span><span class=line><span class=cl>a
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise5-14>exercise5-14<a hidden class=anchor aria-hidden=true href=#exercise5-14>#</a></h2><blockquote><p>修改排序程序，使它能处理-r 标记。该标记表明，以逆序（递减）方式排序。要保证-r 和-n 能够组合在一起使用。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=n>reverse</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>mstrcmp</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>s1</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>s2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>news1</span> <span class=o>=</span> <span class=n>reverse</span> <span class=o>?</span> <span class=nl>s2</span> <span class=p>:</span> <span class=n>s1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>news2</span> <span class=o>=</span> <span class=n>reverse</span> <span class=o>?</span> <span class=nl>s1</span> <span class=p>:</span> <span class=n>s2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nf>strcmp</span><span class=p>(</span><span class=n>news1</span><span class=p>,</span> <span class=n>news2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* numcmp: compare s1 and s2 numerically */</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>mnumcmp</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>s1</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>s2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>news1</span> <span class=o>=</span> <span class=n>reverse</span> <span class=o>?</span> <span class=nl>s2</span> <span class=p>:</span> <span class=n>s1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>news2</span> <span class=o>=</span> <span class=n>reverse</span> <span class=o>?</span> <span class=nl>s1</span> <span class=p>:</span> <span class=n>s2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>double</span> <span class=n>v1</span><span class=p>,</span> <span class=n>v2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v1</span> <span class=o>=</span> <span class=nf>atof</span><span class=p>(</span><span class=n>news1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>v2</span> <span class=o>=</span> <span class=nf>atof</span><span class=p>(</span><span class=n>news2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>v1</span> <span class=o>&lt;</span> <span class=n>v2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>v1</span> <span class=o>&gt;</span> <span class=n>v2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* qsort: sort v[left]...v[right] into increasing order */</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>mqsort</span><span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=n>v</span><span class=p>[],</span> <span class=kt>int</span> <span class=n>left</span><span class=p>,</span> <span class=kt>int</span> <span class=n>right</span><span class=p>,</span> <span class=kt>int</span> <span class=p>(</span><span class=o>*</span><span class=n>comp</span><span class=p>)(</span><span class=kt>void</span> <span class=o>*</span><span class=p>,</span> <span class=kt>void</span> <span class=o>*</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span><span class=p>,</span> <span class=n>last</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>left</span> <span class=o>&gt;=</span> <span class=n>right</span><span class=p>)</span> <span class=cm>/* do nothing if array contains */</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span><span class=p>;</span>        <span class=cm>/* fewer than two elements */</span>
</span></span><span class=line><span class=cl>    <span class=nf>swap</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>left</span><span class=p>,</span> <span class=p>(</span><span class=n>left</span> <span class=o>+</span> <span class=n>right</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>last</span> <span class=o>=</span> <span class=n>left</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=n>left</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>right</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>((</span><span class=o>*</span><span class=n>comp</span><span class=p>)(</span><span class=n>v</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>v</span><span class=p>[</span><span class=n>left</span><span class=p>])</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nf>swap</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=o>++</span><span class=n>last</span><span class=p>,</span> <span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>swap</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>left</span><span class=p>,</span> <span class=n>last</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>mqsort</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>left</span><span class=p>,</span> <span class=n>last</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=n>comp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>mqsort</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>last</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>right</span><span class=p>,</span> <span class=n>comp</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[])</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>nlines</span><span class=p>;</span>      <span class=cm>/* number of input lines read */</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>numeric</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=cm>/* 1 if numeric sort */</span>
</span></span><span class=line><span class=cl>    <span class=n>reverse</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>     <span class=cm>/* 1 if reverse sort */</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>argc</span> <span class=o>&gt;</span> <span class=mi>1</span> <span class=o>&amp;&amp;</span> <span class=nf>strcmp</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=s>&#34;-n&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>numeric</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>argc</span> <span class=o>&gt;</span> <span class=mi>2</span> <span class=o>&amp;&amp;</span> <span class=nf>strcmp</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=s>&#34;-r&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>reverse</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Please input data:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>((</span><span class=n>nlines</span> <span class=o>=</span> <span class=nf>readlines</span><span class=p>(</span><span class=n>lineptr</span><span class=p>,</span> <span class=n>MAXLINES</span><span class=p>))</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>mqsort</span><span class=p>((</span><span class=kt>void</span> <span class=o>**</span><span class=p>)</span><span class=n>lineptr</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>nlines</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=p>(</span><span class=kt>int</span> <span class=p>(</span><span class=o>*</span><span class=p>)(</span><span class=kt>void</span> <span class=o>*</span><span class=p>,</span> <span class=kt>void</span> <span class=o>*</span><span class=p>))(</span><span class=n>numeric</span> <span class=o>?</span> <span class=nl>mnumcmp</span> <span class=p>:</span> <span class=n>mstrcmp</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;After sorted:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>writelines</span><span class=p>(</span><span class=n>lineptr</span><span class=p>,</span> <span class=n>nlines</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;input too big to sort</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>➜  ch05 git:<span class=o>(</span>main<span class=o>)</span> ✗ ./Exercise5-14 -n -r
</span></span><span class=line><span class=cl>Please input data:
</span></span><span class=line><span class=cl><span class=m>76</span> 
</span></span><span class=line><span class=cl><span class=m>44</span>   
</span></span><span class=line><span class=cl><span class=m>98</span>
</span></span><span class=line><span class=cl>After sorted:
</span></span><span class=line><span class=cl><span class=m>98</span>
</span></span><span class=line><span class=cl><span class=m>76</span>
</span></span><span class=line><span class=cl><span class=m>44</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise5-15>exercise5-15<a hidden class=anchor aria-hidden=true href=#exercise5-15>#</a></h2><blockquote><p>增加选项-f，使得排序过程不考虑字母大小写之间的区别。例如，比较 a 和 A 时认为它们相等。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>mstrcmp</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>s1</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>s2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>news1</span> <span class=o>=</span> <span class=n>reverse</span> <span class=o>?</span> <span class=nl>s2</span> <span class=p>:</span> <span class=n>s1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>news2</span> <span class=o>=</span> <span class=n>reverse</span> <span class=o>?</span> <span class=nl>s1</span> <span class=p>:</span> <span class=n>s2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>fold</span> <span class=o>==</span> <span class=mi>1</span> <span class=o>?</span> <span class=nf>strcasecmp</span><span class=p>(</span><span class=n>news1</span><span class=p>,</span> <span class=n>news2</span><span class=p>)</span> <span class=o>:</span> <span class=nf>strcmp</span><span class=p>(</span><span class=n>news1</span><span class=p>,</span> <span class=n>news2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[])</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>nlines</span><span class=p>;</span>      <span class=cm>/* number of input lines read */</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>numeric</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=cm>/* 1 if numeric sort */</span>
</span></span><span class=line><span class=cl>    <span class=n>reverse</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>     <span class=cm>/* 1 if reverse sort */</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>argc</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=sc>&#39;n&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=n>numeric</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=sc>&#39;r&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=n>reverse</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=sc>&#39;f&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=n>fold</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Please input data:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>((</span><span class=n>nlines</span> <span class=o>=</span> <span class=nf>readlines</span><span class=p>(</span><span class=n>lineptr</span><span class=p>,</span> <span class=n>MAXLINES</span><span class=p>))</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>mqsort</span><span class=p>((</span><span class=kt>void</span> <span class=o>**</span><span class=p>)</span><span class=n>lineptr</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>nlines</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>               <span class=p>(</span><span class=kt>int</span> <span class=p>(</span><span class=o>*</span><span class=p>)(</span><span class=kt>void</span> <span class=o>*</span><span class=p>,</span> <span class=kt>void</span> <span class=o>*</span><span class=p>))(</span><span class=n>numeric</span> <span class=o>?</span> <span class=nl>mnumcmp</span> <span class=p>:</span> <span class=n>mstrcmp</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;After sorted:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>writelines</span><span class=p>(</span><span class=n>lineptr</span><span class=p>,</span> <span class=n>nlines</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;input too big to sort</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>➜  ch05 git:<span class=o>(</span>main<span class=o>)</span> ✗ ./Exercise5-14 -f
</span></span><span class=line><span class=cl>Please input data:
</span></span><span class=line><span class=cl>aB
</span></span><span class=line><span class=cl>Ab
</span></span><span class=line><span class=cl>After sorted:
</span></span><span class=line><span class=cl>aB
</span></span><span class=line><span class=cl>Ab
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise5-16>exercise5-16<a hidden class=anchor aria-hidden=true href=#exercise5-16>#</a></h2><blockquote><p>增加选项-d（代表目录顺序）。该选项表明，只对字母、数字和空格进行比较。要保证该选项可以和-f 组合在一起使用。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>charcmp</span><span class=p>(</span><span class=kt>char</span> <span class=n>c1</span><span class=p>,</span> <span class=kt>char</span> <span class=n>c2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>dir</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nf>isalnum</span><span class=p>(</span><span class=n>c1</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=n>c1</span> <span class=o>!=</span> <span class=sc>&#39; &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nf>isalnum</span><span class=p>(</span><span class=n>c2</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=n>c2</span> <span class=o>!=</span> <span class=sc>&#39; &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>fold</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>c1</span> <span class=o>=</span> <span class=nf>tolower</span><span class=p>(</span><span class=n>c1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>c2</span> <span class=o>=</span> <span class=nf>tolower</span><span class=p>(</span><span class=n>c2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>c1</span> <span class=o>-</span> <span class=n>c2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>mstrcmp</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>s1</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>s2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>news1</span> <span class=o>=</span> <span class=n>reverse</span> <span class=o>?</span> <span class=nl>s2</span> <span class=p>:</span> <span class=n>s1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>news2</span> <span class=o>=</span> <span class=n>reverse</span> <span class=o>?</span> <span class=nl>s1</span> <span class=p>:</span> <span class=n>s2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=o>*</span><span class=n>news1</span> <span class=o>&amp;&amp;</span> <span class=o>*</span><span class=n>news2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>cmp</span> <span class=o>=</span> <span class=nf>charcmp</span><span class=p>(</span><span class=o>*</span><span class=n>news1</span><span class=p>,</span> <span class=o>*</span><span class=n>news2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>cmp</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>cmp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>news1</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>news2</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>*</span><span class=n>news1</span> <span class=o>?</span> <span class=mi>1</span> <span class=o>:</span> <span class=p>(</span><span class=o>*</span><span class=n>news2</span> <span class=o>?</span> <span class=o>-</span><span class=mi>1</span> <span class=o>:</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* numcmp: compare s1 and s2 numerically */</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>mnumcmp</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>s1</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>s2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>news1</span> <span class=o>=</span> <span class=n>reverse</span> <span class=o>?</span> <span class=nl>s2</span> <span class=p>:</span> <span class=n>s1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>news2</span> <span class=o>=</span> <span class=n>reverse</span> <span class=o>?</span> <span class=nl>s1</span> <span class=p>:</span> <span class=n>s2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>double</span> <span class=n>v1</span><span class=p>,</span> <span class=n>v2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v1</span> <span class=o>=</span> <span class=nf>atof</span><span class=p>(</span><span class=n>news1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>v2</span> <span class=o>=</span> <span class=nf>atof</span><span class=p>(</span><span class=n>news2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>v1</span> <span class=o>&lt;</span> <span class=n>v2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>v1</span> <span class=o>&gt;</span> <span class=n>v2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* qsort: sort v[left]...v[right] into increasing order */</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>mqsort</span><span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=n>v</span><span class=p>[],</span> <span class=kt>int</span> <span class=n>left</span><span class=p>,</span> <span class=kt>int</span> <span class=n>right</span><span class=p>,</span> <span class=kt>int</span> <span class=p>(</span><span class=o>*</span><span class=n>comp</span><span class=p>)(</span><span class=kt>void</span> <span class=o>*</span><span class=p>,</span> <span class=kt>void</span> <span class=o>*</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span><span class=p>,</span> <span class=n>last</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>left</span> <span class=o>&gt;=</span> <span class=n>right</span><span class=p>)</span> <span class=cm>/* do nothing if array contains */</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span><span class=p>;</span>        <span class=cm>/* fewer than two elements */</span>
</span></span><span class=line><span class=cl>    <span class=nf>swap</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>left</span><span class=p>,</span> <span class=p>(</span><span class=n>left</span> <span class=o>+</span> <span class=n>right</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>last</span> <span class=o>=</span> <span class=n>left</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=n>left</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>right</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>((</span><span class=o>*</span><span class=n>comp</span><span class=p>)(</span><span class=n>v</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>v</span><span class=p>[</span><span class=n>left</span><span class=p>])</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nf>swap</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=o>++</span><span class=n>last</span><span class=p>,</span> <span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>swap</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>left</span><span class=p>,</span> <span class=n>last</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>mqsort</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>left</span><span class=p>,</span> <span class=n>last</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=n>comp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>mqsort</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>last</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>right</span><span class=p>,</span> <span class=n>comp</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[])</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>nlines</span><span class=p>;</span>      <span class=cm>/* number of input lines read */</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>numeric</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=cm>/* 1 if numeric sort */</span>
</span></span><span class=line><span class=cl>    <span class=n>reverse</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>     <span class=cm>/* 1 if reverse sort */</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>argc</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=sc>&#39;n&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=n>numeric</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=sc>&#39;r&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=n>reverse</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=sc>&#39;f&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=n>fold</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=sc>&#39;d&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=n>dir</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Please input data:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>((</span><span class=n>nlines</span> <span class=o>=</span> <span class=nf>readlines</span><span class=p>(</span><span class=n>lineptr</span><span class=p>,</span> <span class=n>MAXLINES</span><span class=p>))</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>mqsort</span><span class=p>((</span><span class=kt>void</span> <span class=o>**</span><span class=p>)</span><span class=n>lineptr</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>nlines</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>               <span class=p>(</span><span class=kt>int</span> <span class=p>(</span><span class=o>*</span><span class=p>)(</span><span class=kt>void</span> <span class=o>*</span><span class=p>,</span> <span class=kt>void</span> <span class=o>*</span><span class=p>))(</span><span class=n>numeric</span> <span class=o>?</span> <span class=nl>mnumcmp</span> <span class=p>:</span> <span class=n>mstrcmp</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;After sorted:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>writelines</span><span class=p>(</span><span class=n>lineptr</span><span class=p>,</span> <span class=n>nlines</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;input too big to sort</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>➜  ch05 git:<span class=o>(</span>main<span class=o>)</span> ✗ ./Exercise5-16 -d -f
</span></span><span class=line><span class=cl>Please input data:
</span></span><span class=line><span class=cl>A+b
</span></span><span class=line><span class=cl>a-B
</span></span><span class=line><span class=cl>After sorted:
</span></span><span class=line><span class=cl>A+b
</span></span><span class=line><span class=cl>a-B
</span></span><span class=line><span class=cl>Please input data:
</span></span><span class=line><span class=cl>a-B
</span></span><span class=line><span class=cl>A+b
</span></span><span class=line><span class=cl>After sorted:
</span></span><span class=line><span class=cl>a-B
</span></span><span class=line><span class=cl>A+b
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise5-18>exercise5-18<a hidden class=anchor aria-hidden=true href=#exercise5-18>#</a></h2><blockquote><p>修改 dcl 程序，使它能够处理输入中的错误。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;ctype.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define MAXTOKEN 100
</span></span></span><span class=line><span class=cl><span class=cp>#define BUFSIZE 100
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>enum</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>NAME</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>PARENS</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>BRACKETS</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>tokentype</span><span class=p>;</span>           <span class=cm>/* type of last token */</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=n>token</span><span class=p>[</span><span class=n>MAXTOKEN</span><span class=p>];</span>    <span class=cm>/* last token string */</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=n>name</span><span class=p>[</span><span class=n>MAXTOKEN</span><span class=p>];</span>     <span class=cm>/* identifier name */</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=n>datatype</span><span class=p>[</span><span class=n>MAXTOKEN</span><span class=p>];</span> <span class=cm>/* data type = char, int, etc. */</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=n>out</span><span class=p>[</span><span class=mi>1000</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>dcl</span><span class=p>(</span><span class=kt>void</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>dirdcl</span><span class=p>(</span><span class=kt>void</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* clear remaining characters in input line to recover from errors */</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>clear_input</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>((</span><span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>())</span> <span class=o>!=</span> <span class=sc>&#39;\n&#39;</span> <span class=o>&amp;&amp;</span> <span class=n>c</span> <span class=o>!=</span> <span class=n>EOF</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* handle and print error messages */</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>errmsg</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Error: %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>msg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>clear_input</span><span class=p>();</span> <span class=c1>// Skip to the end of the current line after an error
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* gettoken: return next token */</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>gettoken</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>p</span> <span class=o>=</span> <span class=n>token</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>((</span><span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>())</span> <span class=o>==</span> <span class=sc>&#39; &#39;</span> <span class=o>||</span> <span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;\t&#39;</span><span class=p>)</span> <span class=c1>// Skip whitespace
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;(&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>((</span><span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>())</span> <span class=o>==</span> <span class=sc>&#39;)&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>strcpy</span><span class=p>(</span><span class=n>token</span><span class=p>,</span> <span class=s>&#34;()&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>tokentype</span> <span class=o>=</span> <span class=n>PARENS</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>ungetch</span><span class=p>(</span><span class=n>c</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>tokentype</span> <span class=o>=</span> <span class=sc>&#39;(&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;[&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=o>*</span><span class=n>p</span><span class=o>++</span> <span class=o>=</span> <span class=n>c</span><span class=p>;</span> <span class=p>(</span><span class=o>*</span><span class=n>p</span><span class=o>++</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>())</span> <span class=o>!=</span> <span class=sc>&#39;]&#39;</span><span class=p>;)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>p</span> <span class=o>-</span> <span class=n>token</span> <span class=o>&gt;=</span> <span class=n>MAXTOKEN</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=c1>// Prevent buffer overflow
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>errmsg</span><span class=p>(</span><span class=s>&#34;brackets too long or unclosed&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>tokentype</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=n>p</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>tokentype</span> <span class=o>=</span> <span class=n>BRACKETS</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nf>isalpha</span><span class=p>(</span><span class=n>c</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=o>*</span><span class=n>p</span><span class=o>++</span> <span class=o>=</span> <span class=n>c</span><span class=p>;</span> <span class=nf>isalnum</span><span class=p>(</span><span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>());)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>p</span> <span class=o>-</span> <span class=n>token</span> <span class=o>&gt;=</span> <span class=n>MAXTOKEN</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=c1>// Prevent buffer overflow
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>errmsg</span><span class=p>(</span><span class=s>&#34;name too long&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>tokentype</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=o>*</span><span class=n>p</span><span class=o>++</span> <span class=o>=</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=n>p</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nf>ungetch</span><span class=p>(</span><span class=n>c</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>tokentype</span> <span class=o>=</span> <span class=n>NAME</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>tokentype</span> <span class=o>=</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* dcl: parse a declarator */</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>dcl</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>ns</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>ns</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nf>gettoken</span><span class=p>()</span> <span class=o>==</span> <span class=sc>&#39;*&#39;</span><span class=p>;)</span> <span class=cm>/* count *&#39;s */</span>
</span></span><span class=line><span class=cl>        <span class=n>ns</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>dirdcl</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=n>ns</span><span class=o>--</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nf>strcat</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=s>&#34; pointer to&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* dirdcl: parse a direct declarator */</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>dirdcl</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>tokentype</span> <span class=o>==</span> <span class=sc>&#39;(&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>dcl</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>tokentype</span> <span class=o>!=</span> <span class=sc>&#39;)&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>errmsg</span><span class=p>(</span><span class=s>&#34;missing )&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>tokentype</span> <span class=o>==</span> <span class=n>NAME</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>strcpy</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>token</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>errmsg</span><span class=p>(</span><span class=s>&#34;expected name or (dcl)&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>((</span><span class=n>type</span> <span class=o>=</span> <span class=nf>gettoken</span><span class=p>())</span> <span class=o>==</span> <span class=n>PARENS</span> <span class=o>||</span> <span class=n>type</span> <span class=o>==</span> <span class=n>BRACKETS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>type</span> <span class=o>==</span> <span class=n>PARENS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>strcat</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=s>&#34; function returning&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>strcat</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=s>&#34; array&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>strcat</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=n>token</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>strcat</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=s>&#34; of&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=cm>/* convert declaration to words */</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=nf>gettoken</span><span class=p>()</span> <span class=o>!=</span> <span class=n>EOF</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>                            <span class=cm>/* 1st token on line */</span>
</span></span><span class=line><span class=cl>        <span class=nf>strcpy</span><span class=p>(</span><span class=n>datatype</span><span class=p>,</span> <span class=n>token</span><span class=p>);</span> <span class=cm>/* is the datatype */</span>
</span></span><span class=line><span class=cl>        <span class=n>out</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nf>dcl</span><span class=p>();</span> <span class=cm>/* parse rest of line */</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>tokentype</span> <span class=o>!=</span> <span class=sc>&#39;\n&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;syntax error</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%s: %s %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>out</span><span class=p>,</span> <span class=n>datatype</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>char *func<span class=o>()</span>
</span></span><span class=line><span class=cl>func:  <span class=k>function</span> returning pointer to char
</span></span><span class=line><span class=cl>char <span class=o>(</span>*func<span class=o>())()</span>
</span></span><span class=line><span class=cl>func:  <span class=k>function</span> returning pointer to <span class=k>function</span> returning char
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise5-19>exercise5-19<a hidden class=anchor aria-hidden=true href=#exercise5-19>#</a></h2><blockquote><p>修改 undcl 程序，使它在把文字描述转换为声明的过程中不会生成多余的圆括号。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cm>/* undcl: convert word description to declaration */</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>undcl</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>temp</span><span class=p>[</span><span class=n>MAXTOKEN</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>parentheses_needed</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=c1>// track when parentheses are necessary
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=nf>gettoken</span><span class=p>()</span> <span class=o>!=</span> <span class=n>EOF</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>strcpy</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=n>token</span><span class=p>);</span> <span class=c1>// Initialize out with the first token
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>while</span> <span class=p>((</span><span class=n>type</span> <span class=o>=</span> <span class=nf>gettoken</span><span class=p>())</span> <span class=o>!=</span> <span class=sc>&#39;\n&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>type</span> <span class=o>==</span> <span class=n>PARENS</span> <span class=o>||</span> <span class=n>type</span> <span class=o>==</span> <span class=n>BRACKETS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>strcat</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=n>token</span><span class=p>);</span> <span class=c1>// Append function or array notation
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>type</span> <span class=o>==</span> <span class=sc>&#39;*&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// Only add parentheses if needed for precedence (i.e., if out is a function or array)
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=k>if</span> <span class=p>(</span><span class=n>parentheses_needed</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nf>sprintf</span><span class=p>(</span><span class=n>temp</span><span class=p>,</span> <span class=s>&#34;(*%s)&#34;</span><span class=p>,</span> <span class=n>out</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>parentheses_needed</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=c1>// reset parentheses flag
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nf>sprintf</span><span class=p>(</span><span class=n>temp</span><span class=p>,</span> <span class=s>&#34;*%s&#34;</span><span class=p>,</span> <span class=n>out</span><span class=p>);</span> <span class=c1>// regular pointer, no parentheses needed
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=nf>strcpy</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=n>temp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>type</span> <span class=o>==</span> <span class=n>NAME</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>sprintf</span><span class=p>(</span><span class=n>temp</span><span class=p>,</span> <span class=s>&#34;%s %s&#34;</span><span class=p>,</span> <span class=n>token</span><span class=p>,</span> <span class=n>out</span><span class=p>);</span> <span class=c1>// Add name to out
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=nf>strcpy</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=n>temp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;invalid input at %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>token</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>out</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>x <span class=o>()</span> * <span class=o>[]</span> * <span class=o>()</span> char
</span></span><span class=line><span class=cl>char <span class=o>(</span>*<span class=o>(</span>*x<span class=o>())[])()</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise5-20>exercise5-20<a hidden class=anchor aria-hidden=true href=#exercise5-20>#</a></h2><blockquote><p>扩展 dcl 程序的功能，使它能够处理包含其它成分的声明，例如带有函数参数类型的声明、带有类似于 const 限定符的声明等。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;ctype.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define MAXTOKEN 100
</span></span></span><span class=line><span class=cl><span class=cp>#define BUFSIZE 100
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>enum</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>NAME</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>PARENS</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>BRACKETS</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>QUALIFIER</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>TYPE</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>tokentype</span><span class=p>;</span>           <span class=cm>/* type of last token */</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=n>token</span><span class=p>[</span><span class=n>MAXTOKEN</span><span class=p>];</span>    <span class=cm>/* last token string */</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=n>name</span><span class=p>[</span><span class=n>MAXTOKEN</span><span class=p>];</span>     <span class=cm>/* identifier name */</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=n>datatype</span><span class=p>[</span><span class=n>MAXTOKEN</span><span class=p>];</span> <span class=cm>/* data type = char, int, etc. */</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=n>out</span><span class=p>[</span><span class=mi>1000</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=n>buf</span><span class=p>[</span><span class=n>BUFSIZE</span><span class=p>];</span> <span class=cm>/* buffer for ungetch */</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>bufp</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>      <span class=cm>/* next free position in buf */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>dcl</span><span class=p>(</span><span class=kt>void</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>dirdcl</span><span class=p>(</span><span class=kt>void</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* get a (possibly pushed-back) character */</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>getch</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=n>bufp</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=o>?</span> <span class=n>buf</span><span class=p>[</span><span class=o>--</span><span class=n>bufp</span><span class=p>]</span> <span class=o>:</span> <span class=nf>getchar</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* push character back on input */</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ungetch</span><span class=p>(</span><span class=kt>int</span> <span class=n>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>bufp</span> <span class=o>&gt;=</span> <span class=n>BUFSIZE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;ungetch: too many characters</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=n>buf</span><span class=p>[</span><span class=n>bufp</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* clear remaining characters in input line to recover from errors */</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>clear_input</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>((</span><span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>())</span> <span class=o>!=</span> <span class=sc>&#39;\n&#39;</span> <span class=o>&amp;&amp;</span> <span class=n>c</span> <span class=o>!=</span> <span class=n>EOF</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* handle and print error messages */</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>errmsg</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Error: %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>msg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>clear_input</span><span class=p>();</span> <span class=c1>// Skip to the end of the current line after an error
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* gettoken: return next token */</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>gettoken</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>p</span> <span class=o>=</span> <span class=n>token</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>((</span><span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>())</span> <span class=o>==</span> <span class=sc>&#39; &#39;</span> <span class=o>||</span> <span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;\t&#39;</span><span class=p>)</span> <span class=c1>// Skip whitespace
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;(&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>((</span><span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>())</span> <span class=o>==</span> <span class=sc>&#39;)&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>strcpy</span><span class=p>(</span><span class=n>token</span><span class=p>,</span> <span class=s>&#34;()&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>tokentype</span> <span class=o>=</span> <span class=n>PARENS</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>ungetch</span><span class=p>(</span><span class=n>c</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>tokentype</span> <span class=o>=</span> <span class=sc>&#39;(&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;[&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=o>*</span><span class=n>p</span><span class=o>++</span> <span class=o>=</span> <span class=n>c</span><span class=p>;</span> <span class=p>(</span><span class=o>*</span><span class=n>p</span><span class=o>++</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>())</span> <span class=o>!=</span> <span class=sc>&#39;]&#39;</span><span class=p>;)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>p</span> <span class=o>-</span> <span class=n>token</span> <span class=o>&gt;=</span> <span class=n>MAXTOKEN</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=c1>// Prevent buffer overflow
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>errmsg</span><span class=p>(</span><span class=s>&#34;brackets too long or unclosed&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>tokentype</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=n>p</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>tokentype</span> <span class=o>=</span> <span class=n>BRACKETS</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nf>isalpha</span><span class=p>(</span><span class=n>c</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=o>*</span><span class=n>p</span><span class=o>++</span> <span class=o>=</span> <span class=n>c</span><span class=p>;</span> <span class=nf>isalnum</span><span class=p>(</span><span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>());)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>p</span> <span class=o>-</span> <span class=n>token</span> <span class=o>&gt;=</span> <span class=n>MAXTOKEN</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=c1>// Prevent buffer overflow
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>errmsg</span><span class=p>(</span><span class=s>&#34;name too long&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>tokentype</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=o>*</span><span class=n>p</span><span class=o>++</span> <span class=o>=</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=n>p</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nf>ungetch</span><span class=p>(</span><span class=n>c</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Handle qualifiers and types like const, volatile
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=nf>strcmp</span><span class=p>(</span><span class=n>token</span><span class=p>,</span> <span class=s>&#34;const&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>||</span> <span class=nf>strcmp</span><span class=p>(</span><span class=n>token</span><span class=p>,</span> <span class=s>&#34;volatile&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>tokentype</span> <span class=o>=</span> <span class=n>QUALIFIER</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>tokentype</span> <span class=o>=</span> <span class=n>NAME</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>tokentype</span> <span class=o>=</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* dcl: parse a declarator */</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>dcl</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>ns</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>ns</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nf>gettoken</span><span class=p>()</span> <span class=o>==</span> <span class=sc>&#39;*&#39;</span><span class=p>;)</span> <span class=cm>/* count *&#39;s */</span>
</span></span><span class=line><span class=cl>        <span class=n>ns</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>dirdcl</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=n>ns</span><span class=o>--</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nf>strcat</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=s>&#34; pointer to&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* dirdcl: parse a direct declarator */</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>dirdcl</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>tokentype</span> <span class=o>==</span> <span class=sc>&#39;(&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>dcl</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>tokentype</span> <span class=o>!=</span> <span class=sc>&#39;)&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>errmsg</span><span class=p>(</span><span class=s>&#34;missing )&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>tokentype</span> <span class=o>==</span> <span class=n>NAME</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>strcpy</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>token</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>errmsg</span><span class=p>(</span><span class=s>&#34;expected name or (dcl)&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>((</span><span class=n>type</span> <span class=o>=</span> <span class=nf>gettoken</span><span class=p>())</span> <span class=o>==</span> <span class=n>PARENS</span> <span class=o>||</span> <span class=n>type</span> <span class=o>==</span> <span class=n>BRACKETS</span> <span class=o>||</span> <span class=n>type</span> <span class=o>==</span> <span class=n>QUALIFIER</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>type</span> <span class=o>==</span> <span class=n>PARENS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>strcat</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=s>&#34; function returning&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>type</span> <span class=o>==</span> <span class=n>BRACKETS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>strcat</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=s>&#34; array&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>strcat</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=n>token</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>strcat</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=s>&#34; of&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>type</span> <span class=o>==</span> <span class=n>QUALIFIER</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>strcat</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=s>&#34; &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>strcat</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=n>token</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* parse a function parameter list */</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>parse_param_list</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=nf>gettoken</span><span class=p>()</span> <span class=o>!=</span> <span class=sc>&#39;)&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>tokentype</span> <span class=o>==</span> <span class=n>NAME</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>strcat</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=s>&#34; parameter &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>strcat</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=n>token</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>tokentype</span> <span class=o>==</span> <span class=sc>&#39;,&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>strcat</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=s>&#34;, &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>tokentype</span> <span class=o>==</span> <span class=n>QUALIFIER</span> <span class=o>||</span> <span class=n>tokentype</span> <span class=o>==</span> <span class=n>TYPE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>strcat</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=s>&#34; &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>strcat</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=n>token</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>tokentype</span> <span class=o>==</span> <span class=sc>&#39;(&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>parse_param_list</span><span class=p>();</span> <span class=c1>// Recursively handle nested parentheses
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>errmsg</span><span class=p>(</span><span class=s>&#34;unexpected token in parameter list&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=cm>/* convert declaration to words */</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=nf>gettoken</span><span class=p>()</span> <span class=o>!=</span> <span class=n>EOF</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>                            <span class=cm>/* 1st token on line */</span>
</span></span><span class=line><span class=cl>        <span class=nf>strcpy</span><span class=p>(</span><span class=n>datatype</span><span class=p>,</span> <span class=n>token</span><span class=p>);</span> <span class=cm>/* is the datatype */</span>
</span></span><span class=line><span class=cl>        <span class=n>out</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nf>dcl</span><span class=p>();</span> <span class=cm>/* parse rest of line */</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>tokentype</span> <span class=o>!=</span> <span class=sc>&#39;\n&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;syntax error</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%s: %s %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>out</span><span class=p>,</span> <span class=n>datatype</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://fireflyyh.top/tags/tcpl/>TCPL</a></li></ul><nav class=paginav><a class=prev href=https://fireflyyh.top/posts/tcpl/ch06/><span class=title>« Prev</span><br><span>C语言程序设计第二版课后习题--第六章</span>
</a><a class=next href=https://fireflyyh.top/posts/tcpl/ch04/><span class=title>Next »</span><br><span>C语言程序设计第二版课后习题--第四章</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://fireflyyh.top/>Jagger's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function i(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),i();return}const n=document.createRange();n.selectNodeContents(e);const s=window.getSelection();s.removeAllRanges(),s.addRange(n);try{document.execCommand("copy"),i()}catch{}s.removeRange(n)});let l=e.className.replaceAll("language-",""),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),c=document.createElement("div"),o=document.createElement("div");o.innerText=l,n.setAttribute("class","mac-tool"),a.setAttribute("class","mac bb1"),r.setAttribute("class","mac bb2"),c.setAttribute("class","mac bb3"),o.setAttribute("class","language-type"),n.appendChild(a),n.appendChild(r),n.appendChild(c),n.appendChild(o),s.classList.contains("highlight")?(s.appendChild(n),s.appendChild(t)):s.parentNode.firstChild==s||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?(s.appendChild(n),e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t)):(s.appendChild(n),e.parentNode.appendChild(t)))})</script></body></html>