<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>C语言程序设计第二版课后习题--第七章 | Jagger's Blog</title>
<meta name=keywords content="TCPL"><meta name=description content='部分答案参考了官方题解和网上的答案，仅供参考，可能也有部分bug未发现或解决。
exercise7-1 编写一个程序，根据它自身被调用时存放在argv[0]中的名字，实现将大写字母转换为小写字母或将小写字母转换为大写字母的功能。
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 #include <stdio.h> #include <stdlib.h> #include <ctype.h> #include <string.h> int main(int argc, char **argv) { int (*handler[2])(int) = {tolower, toupper}; int type = strcmp(argv[0], "./lower") == 0 ? 0 : strcmp(argv[0], "./upper") == 0 ? 1 : -1; if (type == -1) { fprintf(stderr, "Usage: %s [lower|upper]\n", argv[0]); } else { int c; while ((c = getchar()) !'><meta name=author content="Jagger"><link rel=canonical href=https://fireflyyh.top/posts/tcpl/ch07/><link crossorigin=anonymous href=/assets/css/stylesheet.1212f0454c490726d67933de27a90315a6177ba895fb506fe0f2bd6e93b66acd.css integrity="sha256-EhLwRUxJBybWeTPeJ6kDFaYXe6iV+1Bv4PK9bpO2as0=" rel="preload stylesheet" as=style><link rel=icon href=https://fireflyyh.top/img/yuan.jpg><link rel=icon type=image/png sizes=16x16 href=https://fireflyyh.top/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://fireflyyh.top/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://fireflyyh.top/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://fireflyyh.top/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://fireflyyh.top/posts/tcpl/ch07/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?87f1888ba5320e03987ecde7525fde2d",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script type=text/javascript async src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["[[","]]"]],processEscapes:!0,processEnvironments:!0,skipTags:["script","noscript","style","textarea","pre"],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}}),MathJax.Hub.Queue(function(){var e,t=MathJax.Hub.getAllJax();for(e=0;e<t.length;e+=1)t[e].SourceElement().parentNode.className+=" has-jax"})</script><style>code.has-jax{font:inherit;font-size:100%;background:inherit;border:inherit;color:#515151}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-Y30PKHXBN4"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Y30PKHXBN4")</script><meta property="og:title" content="C语言程序设计第二版课后习题--第七章"><meta property="og:description" content='部分答案参考了官方题解和网上的答案，仅供参考，可能也有部分bug未发现或解决。
exercise7-1 编写一个程序，根据它自身被调用时存放在argv[0]中的名字，实现将大写字母转换为小写字母或将小写字母转换为大写字母的功能。
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 #include <stdio.h> #include <stdlib.h> #include <ctype.h> #include <string.h> int main(int argc, char **argv) { int (*handler[2])(int) = {tolower, toupper}; int type = strcmp(argv[0], "./lower") == 0 ? 0 : strcmp(argv[0], "./upper") == 0 ? 1 : -1; if (type == -1) { fprintf(stderr, "Usage: %s [lower|upper]\n", argv[0]); } else { int c; while ((c = getchar()) !'><meta property="og:type" content="article"><meta property="og:url" content="https://fireflyyh.top/posts/tcpl/ch07/"><meta property="og:image" content="https://fireflyyh.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-19T00:00:00+00:00"><meta property="article:modified_time" content="2024-10-19T00:00:00+00:00"><meta property="og:site_name" content="Jagger's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://fireflyyh.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="C语言程序设计第二版课后习题--第七章"><meta name=twitter:description content='部分答案参考了官方题解和网上的答案，仅供参考，可能也有部分bug未发现或解决。
exercise7-1 编写一个程序，根据它自身被调用时存放在argv[0]中的名字，实现将大写字母转换为小写字母或将小写字母转换为大写字母的功能。
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 #include <stdio.h> #include <stdlib.h> #include <ctype.h> #include <string.h> int main(int argc, char **argv) { int (*handler[2])(int) = {tolower, toupper}; int type = strcmp(argv[0], "./lower") == 0 ? 0 : strcmp(argv[0], "./upper") == 0 ? 1 : -1; if (type == -1) { fprintf(stderr, "Usage: %s [lower|upper]\n", argv[0]); } else { int c; while ((c = getchar()) !'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://fireflyyh.top/posts/"},{"@type":"ListItem","position":2,"name":"C语言程序设计第二版课后习题--第七章","item":"https://fireflyyh.top/posts/tcpl/ch07/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"C语言程序设计第二版课后习题--第七章","name":"C语言程序设计第二版课后习题--第七章","description":"部分答案参考了官方题解和网上的答案，仅供参考，可能也有部分bug未发现或解决。\nexercise7-1 编写一个程序，根据它自身被调用时存放在argv[0]中的名字，实现将大写字母转换为小写字母或将小写字母转换为大写字母的功能。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;ctype.h\u0026gt; #include \u0026lt;string.h\u0026gt; int main(int argc, char **argv) { int (*handler[2])(int) = {tolower, toupper}; int type = strcmp(argv[0], \u0026#34;./lower\u0026#34;) == 0 ? 0 : strcmp(argv[0], \u0026#34;./upper\u0026#34;) == 0 ? 1 : -1; if (type == -1) { fprintf(stderr, \u0026#34;Usage: %s [lower|upper]\\n\u0026#34;, argv[0]); } else { int c; while ((c = getchar()) !","keywords":["TCPL"],"articleBody":" 部分答案参考了官方题解和网上的答案，仅供参考，可能也有部分bug未发现或解决。\nexercise7-1 编写一个程序，根据它自身被调用时存放在argv[0]中的名字，实现将大写字母转换为小写字母或将小写字母转换为大写字母的功能。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 #include #include #include #include int main(int argc, char **argv) { int (*handler[2])(int) = {tolower, toupper}; int type = strcmp(argv[0], \"./lower\") == 0 ? 0 : strcmp(argv[0], \"./upper\") == 0 ? 1 : -1; if (type == -1) { fprintf(stderr, \"Usage: %s [lower|upper]\\n\", argv[0]); } else { int c; while ((c = getchar()) != EOF) putchar(handler[type](c)); } } 运行：\n1 2 3 4 5 6 7 8 9 ➜ ch07 git:(main) ✗ gcc -o lower Exercise7-1.c ➜ ch07 git:(main) ✗ ./lower This this IYUSDbusaIs iyusdbusais ➜ ch07 git:(main) ✗ gcc -o other Exercise7-1.c ➜ ch07 git:(main) ✗ ./other Usage: ./other [lower|upper] exercise7-3 改写 minprintf 函数，使它能完成 printf 函数的更多功能。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 void minprintf(char *fmt, ...) { va_list ap; /* points to each unnamed arg in turn */ char *p, *sval; int ival; double dval; va_start(ap, fmt); /* make ap point to 1st unnamed arg */ for (p = fmt; *p; p++) { if (*p != '%') { putchar(*p); continue; } switch (*++p) { case 'd': ival = va_arg(ap, int); printf(\"%d\", ival); break; case 'f': dval = va_arg(ap, double); printf(\"%f\", dval); break; case 's': for (sval = va_arg(ap, char *); *sval; sval++) putchar(*sval); break; case 'c': // 字符 ival = va_arg(ap, int); printf(\"%c\", ival); break; case 'x': // 十六进制 ival = va_arg(ap, int); printf(\"%x\", ival); break; case 'o': // 八进制 ival = va_arg(ap, int); printf(\"%o\", ival); break; case '%': // 百分号 putchar('%'); break; case 'g': // 浮点数 dval = va_arg(ap, double); printf(\"%g\", dval); break; default: putchar(*p); break; } } va_end(ap); /* clean up when done */ } int main() { minprintf(\"int: %d, float: %g, string: %s\\n\", 10, 3.14, \"hello\"); minprintf(\"char: %c, hex: %x, oct: %o, double: %g, percent: %%\\n\", 'a', 255, 255, 3.1415926); return 0; } 运行：\n1 2 int: 10, float: 3.14, string: hello char: a, hex: ff, oct: 377, double: 3.14159, percent: % exercise7-4 类似于上一节中的函数 minprintf，编写 scanf 函数的一个简化版本。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 #include #include #include void minscanf(char *fmt, ...) { va_list ap; char *p, *sval; int *ival; float *dval; unsigned *uval; int c; va_start(ap, fmt); for (p = fmt; *p; p++) { while (*p != '%') p++; switch (*++p) { case 'd': ival = va_arg(ap, int *); scanf(\"%d\", ival); break; case 'f': dval = va_arg(ap, float *); scanf(\"%f\", dval); break; case 's': sval = va_arg(ap, char *); scanf(\"%s\", sval); break; case 'c': ival = va_arg(ap, int *); *ival = getchar(); break; default: break; } } va_end(ap); } int main() { int i; float f; char s[100]; char c; printf(\"Enter an integer: \"); minscanf(\"%d\", \u0026i); printf(\"i = %d\\n\", i); printf(\"Enter a float: \"); minscanf(\"%f\", \u0026f); printf(\"f = %f\\n\", f); printf(\"Enter a string: \"); minscanf(\"%s\", s); printf(\"s = %s\\n\", s); getchar(); // clear the input buffer printf(\"Enter a character: \"); minscanf(\"%c\", \u0026c); printf(\"c = %c\\n\", c); } 运行：\n1 2 3 4 5 6 7 8 Enter an integer: 1 i = 1 Enter a float: 3.14 f = 3.140000 Enter a string: ioio s = ioio Enter a character: a c = a exercise7-5 改写第 4 章中的后缀计算器程序，用 scanf 函数和（或）sscanf 函数实现输入以及数的转换。\n其他不用改变，只需要改变主函数即可，将\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 int main() { int type; double op2; char s[MAXOP]; printf(\"Please input expression:\\n\"); while ((type = getop(s)) != EOF) { switch (type) { case NUMBER: push(atof(s)); break; ... } } } 修改为：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 int main() { int type; double op2; char s[MAXOP]; printf(\"Please input expression:\\n\"); while ((type = getop(s)) != EOF) { switch (type) { case NUMBER: int val; scanf(\"%f\", \u0026val); push(val); break; ... } } } exercise7-6 编写一个程序，比较两个文件并打印它们第一个不相同的行。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 void filecmp(FILE *fp1, FILE *fp2) { char *line1 = malloc(MAXLINE), *line2 = malloc(MAXLINE); int lineno = 1; while (fgets(line1, 100, fp1) != NULL \u0026\u0026 fgets(line2, 100, fp2) != NULL) { if (strcmp(line1, line2) != 0) { printf(\"difference in line %d\\n\", lineno); printf(\"line1: %s\\n\", line1); printf(\"line2: %s\\n\", line2); return; } lineno++; } if (feof(fp1) \u0026\u0026 feof(fp2)) printf(\"files are identical\\n\"); else if (feof(fp1)) printf(\"file2 has extra lines\\n\"); else printf(\"file1 has extra lines\\n\"); } int main(int argc, char *argv[]) { FILE *fp1, *fp2; char *prog = argv[0]; /* program name for errors */ if (argc == 1 || argc == 2) /* no args; copy standard input */ fprintf(stderr, \"Usage: %s file1 file2\\n\", prog); else { if ((fp1 = fopen(*++argv, \"r\")) == NULL) { fprintf(stderr, \"%s: can't open %s\\n\", prog, *argv); exit(1); } if ((fp2 = fopen(*++argv, \"r\")) == NULL) { fprintf(stderr, \"%s: can't open %s\\n\", prog, *argv); exit(1); } filecmp(fp1, fp2); } fclose(fp1); fclose(fp2); exit(0); } 1 2 3 4 5 ➜ ch07 git:(main) ✗ ./Exercise7-6 Exercise7-6.c Exercise7-5.c difference in line 5 line1: #define MAXLINE 1000 line2: void filecopy(FILE *ifp, FILE *ofp) exercise7-7 修改第 5 章的模式查找程序，使它从一个命名文件的集合中读取输入（有文件名参数时），如果没有文件名参数，则从标准输入中读取输入。当发现一个匹配行时，是否应该将相应的文件名打印出来？\nexercise7-8 编写一个程序，以打印一个文件集合，每个文件从新的一页开始打印，并且打印每个文件相应的标题和页数。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 #include #include #define MAXLINE 1024 #define LINES_PER_PAGE 3 void print_file(char *file_name) { FILE *f; int page_number = 1; int line_count; int c; int new_page = 1; assert(file_name != NULL); char *line = malloc(MAXLINE); if ((f = fopen(file_name, \"r\")) != NULL) { while (fgets(line, MAXLINE, f) != NULL) { if (new_page) { printf(\"[%s] page %d starts\\n\", file_name, page_number); new_page = 0; line_count = 1; } if (!feof(f) \u0026\u0026 ++line_count \u003e LINES_PER_PAGE) { /* print out the footer */ printf(\"[%s] page %d ends\\n\", file_name, page_number); /* skip another line so we can see it on screen */ putchar('\\n'); new_page = 1; page_number++; } else { fputs(line, stdout); } } /* skip another line so we can see it on screen */ putchar('\\n'); fclose(f); } } int main(int argc, char *argv[]) { int i; if (argc \u003c 2) { fputs(\"no files specified\\n\", stderr); return EXIT_FAILURE; } for (i = 1; i \u003c argc; i++) print_file(argv[i]); return EXIT_SUCCESS; } 运行\n1 2 3 4 5 6 7 8 9 ➜ ch07 git:(main) ✗ ./Exercise7-8 test.txt [test.txt] page 1 starts It’s quite a good summary, but it would have even better when taking into account the importance of the number of requested rows, expected by the Cassandra client. 1) “To perform the country index lookup, every node is queried, looks up the 'UK' partition and then looks up each user_accounts partition found. ” [test.txt] page 1 ends [test.txt] page 2 starts 2) “This leads to the conclusion that the best use case for Cassandra's secondary indexes is when p is approximately n i.e. the number of partitions is about equal to the number of nodes.” What a narrow best use case ! Hopefully, there are other use cases where seconday index are fine (that is, for low-cardinality sets), or even finer (according to the number of resulting rows requested vs the cardinality of indexed values). exercise7-9 类似于 isupper 这样的函数可以通过某种方式实现以达到节省空间或时间的目的。考虑节省空间或时间的实现方式。\n1 2 3 4 # define isupper(c) __isctype((c), _ISupper) # define __isctype(c, type) \\ ((*__ctype_b_loc ())[(int) (c)] \u0026 (unsigned short int) type) 使用了宏定义\n","wordCount":"1380","inLanguage":"en","image":"https://fireflyyh.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-10-19T00:00:00Z","dateModified":"2024-10-19T00:00:00Z","author":{"@type":"Person","name":"Jagger"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://fireflyyh.top/posts/tcpl/ch07/"},"publisher":{"@type":"Organization","name":"Jagger's Blog","logo":{"@type":"ImageObject","url":"https://fireflyyh.top/img/yuan.jpg"}}}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-Y30PKHXBN4"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Y30PKHXBN4")</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://fireflyyh.top/ accesskey=h title="Jagger's Blog (Alt + H)"><img src=https://fireflyyh.top/img/laugh.jpg alt aria-label=logo height=35>Jagger's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://fireflyyh.top/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://fireflyyh.top/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://fireflyyh.top/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://fireflyyh.top/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://fireflyyh.top/about/ title=About><span>About</span></a></li><li><a href=https://github.com/starsYHyh/Jagger/ title=Github><span>Github</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://fireflyyh.top/>Home</a>&nbsp;»&nbsp;<a href=https://fireflyyh.top/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">C语言程序设计第二版课后习题--第七章
<span class=entry-hint title=Draft><svg height="35" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h1><div class=post-meta><span title='2024-10-19 00:00:00 +0000 UTC'>October 19, 2024</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;1380 words&nbsp;·&nbsp;Jagger&nbsp;|&nbsp;<a href=https://github.com/starsYHyh/Jagger/tree/main/content/posts/TCPL/ch07.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#exercise7-1 aria-label=exercise7-1>exercise7-1</a></li><li><a href=#exercise7-3 aria-label=exercise7-3>exercise7-3</a></li><li><a href=#exercise7-4 aria-label=exercise7-4>exercise7-4</a></li><li><a href=#exercise7-5 aria-label=exercise7-5>exercise7-5</a></li><li><a href=#exercise7-6 aria-label=exercise7-6>exercise7-6</a></li><li><a href=#exercise7-7 aria-label=exercise7-7>exercise7-7</a></li><li><a href=#exercise7-8 aria-label=exercise7-8>exercise7-8</a></li><li><a href=#exercise7-9 aria-label=exercise7-9>exercise7-9</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{elements&&(activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")}))},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><blockquote><p>部分答案参考了官方题解和网上的答案，仅供参考，可能也有部分bug未发现或解决。</p></blockquote><h2 id=exercise7-1>exercise7-1<a hidden class=anchor aria-hidden=true href=#exercise7-1>#</a></h2><blockquote><p>编写一个程序，根据它自身被调用时存放在<code>argv[0]</code>中的名字，实现将大写字母转换为小写字母或将小写字母转换为大写字母的功能。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;ctype.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=p>(</span><span class=o>*</span><span class=n>handler</span><span class=p>[</span><span class=mi>2</span><span class=p>])(</span><span class=kt>int</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=n>tolower</span><span class=p>,</span> <span class=n>toupper</span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>type</span> <span class=o>=</span> <span class=nf>strcmp</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=s>&#34;./lower&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>?</span> <span class=mi>0</span> <span class=o>:</span> <span class=nf>strcmp</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=s>&#34;./upper&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>?</span> <span class=mi>1</span> <span class=o>:</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>type</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span> <span class=s>&#34;Usage: %s [lower|upper]</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>argv</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=p>((</span><span class=n>c</span> <span class=o>=</span> <span class=nf>getchar</span><span class=p>())</span> <span class=o>!=</span> <span class=n>EOF</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nf>putchar</span><span class=p>(</span><span class=n>handler</span><span class=p>[</span><span class=n>type</span><span class=p>](</span><span class=n>c</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>➜  ch07 git:<span class=o>(</span>main<span class=o>)</span> ✗ gcc -o lower Exercise7-1.c 
</span></span><span class=line><span class=cl>➜  ch07 git:<span class=o>(</span>main<span class=o>)</span> ✗ ./lower               
</span></span><span class=line><span class=cl>This
</span></span><span class=line><span class=cl>this
</span></span><span class=line><span class=cl>IYUSDbusaIs
</span></span><span class=line><span class=cl>iyusdbusais
</span></span><span class=line><span class=cl>➜  ch07 git:<span class=o>(</span>main<span class=o>)</span> ✗ gcc -o other Exercise7-1.c
</span></span><span class=line><span class=cl>➜  ch07 git:<span class=o>(</span>main<span class=o>)</span> ✗ ./other 
</span></span><span class=line><span class=cl>Usage: ./other <span class=o>[</span>lower<span class=p>|</span>upper<span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise7-3>exercise7-3<a hidden class=anchor aria-hidden=true href=#exercise7-3>#</a></h2><blockquote><p>改写 minprintf 函数，使它能完成 printf 函数的更多功能。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=nf>minprintf</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>fmt</span><span class=p>,</span> <span class=p>...)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>va_list</span> <span class=n>ap</span><span class=p>;</span> <span class=cm>/* points to each unnamed arg in turn */</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>p</span><span class=p>,</span> <span class=o>*</span><span class=n>sval</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>ival</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>double</span> <span class=n>dval</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>va_start</span><span class=p>(</span><span class=n>ap</span><span class=p>,</span> <span class=n>fmt</span><span class=p>);</span> <span class=cm>/* make ap point to 1st unnamed arg */</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>p</span> <span class=o>=</span> <span class=n>fmt</span><span class=p>;</span> <span class=o>*</span><span class=n>p</span><span class=p>;</span> <span class=n>p</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>*</span><span class=n>p</span> <span class=o>!=</span> <span class=sc>&#39;%&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>putchar</span><span class=p>(</span><span class=o>*</span><span class=n>p</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=p>(</span><span class=o>*++</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=sc>&#39;d&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=n>ival</span> <span class=o>=</span> <span class=nf>va_arg</span><span class=p>(</span><span class=n>ap</span><span class=p>,</span> <span class=kt>int</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=n>ival</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=sc>&#39;f&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=n>dval</span> <span class=o>=</span> <span class=nf>va_arg</span><span class=p>(</span><span class=n>ap</span><span class=p>,</span> <span class=kt>double</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%f&#34;</span><span class=p>,</span> <span class=n>dval</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=sc>&#39;s&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=p>(</span><span class=n>sval</span> <span class=o>=</span> <span class=nf>va_arg</span><span class=p>(</span><span class=n>ap</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=p>);</span> <span class=o>*</span><span class=n>sval</span><span class=p>;</span> <span class=n>sval</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nf>putchar</span><span class=p>(</span><span class=o>*</span><span class=n>sval</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=sc>&#39;c&#39;</span><span class=o>:</span>   <span class=c1>// 字符
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>ival</span> <span class=o>=</span> <span class=nf>va_arg</span><span class=p>(</span><span class=n>ap</span><span class=p>,</span> <span class=kt>int</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%c&#34;</span><span class=p>,</span> <span class=n>ival</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=sc>&#39;x&#39;</span><span class=o>:</span>   <span class=c1>// 十六进制
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>ival</span> <span class=o>=</span> <span class=nf>va_arg</span><span class=p>(</span><span class=n>ap</span><span class=p>,</span> <span class=kt>int</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%x&#34;</span><span class=p>,</span> <span class=n>ival</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=sc>&#39;o&#39;</span><span class=o>:</span>   <span class=c1>// 八进制
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>ival</span> <span class=o>=</span> <span class=nf>va_arg</span><span class=p>(</span><span class=n>ap</span><span class=p>,</span> <span class=kt>int</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%o&#34;</span><span class=p>,</span> <span class=n>ival</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=sc>&#39;%&#39;</span><span class=o>:</span>   <span class=c1>// 百分号
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nf>putchar</span><span class=p>(</span><span class=sc>&#39;%&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=sc>&#39;g&#39;</span><span class=o>:</span>   <span class=c1>// 浮点数
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>dval</span> <span class=o>=</span> <span class=nf>va_arg</span><span class=p>(</span><span class=n>ap</span><span class=p>,</span> <span class=kt>double</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%g&#34;</span><span class=p>,</span> <span class=n>dval</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=nf>putchar</span><span class=p>(</span><span class=o>*</span><span class=n>p</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nf>va_end</span><span class=p>(</span><span class=n>ap</span><span class=p>);</span> <span class=cm>/* clean up when done */</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>minprintf</span><span class=p>(</span><span class=s>&#34;int: %d, float: %g, string: %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>,</span> <span class=s>&#34;hello&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>minprintf</span><span class=p>(</span><span class=s>&#34;char: %c, hex: %x, oct: %o, double: %g, percent: %%</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=sc>&#39;a&#39;</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=mf>3.1415926</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>int: 10, float: 3.14, string: hello
</span></span><span class=line><span class=cl>char: a, hex: ff, oct: 377, double: 3.14159, percent: %
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise7-4>exercise7-4<a hidden class=anchor aria-hidden=true href=#exercise7-4>#</a></h2><blockquote><p>类似于上一节中的函数 minprintf，编写 scanf 函数的一个简化版本。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdarg.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;ctype.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>minscanf</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>fmt</span><span class=p>,</span> <span class=p>...)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>va_list</span> <span class=n>ap</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>p</span><span class=p>,</span> <span class=o>*</span><span class=n>sval</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=o>*</span><span class=n>ival</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>float</span> <span class=o>*</span><span class=n>dval</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>unsigned</span> <span class=o>*</span><span class=n>uval</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>va_start</span><span class=p>(</span><span class=n>ap</span><span class=p>,</span> <span class=n>fmt</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>p</span> <span class=o>=</span> <span class=n>fmt</span><span class=p>;</span> <span class=o>*</span><span class=n>p</span><span class=p>;</span> <span class=n>p</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=p>(</span><span class=o>*</span><span class=n>p</span> <span class=o>!=</span> <span class=sc>&#39;%&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>p</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=p>(</span><span class=o>*++</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=sc>&#39;d&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=n>ival</span> <span class=o>=</span> <span class=nf>va_arg</span><span class=p>(</span><span class=n>ap</span><span class=p>,</span> <span class=kt>int</span> <span class=o>*</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=n>ival</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=sc>&#39;f&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=n>dval</span> <span class=o>=</span> <span class=nf>va_arg</span><span class=p>(</span><span class=n>ap</span><span class=p>,</span> <span class=kt>float</span> <span class=o>*</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%f&#34;</span><span class=p>,</span> <span class=n>dval</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=sc>&#39;s&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=n>sval</span> <span class=o>=</span> <span class=nf>va_arg</span><span class=p>(</span><span class=n>ap</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=n>sval</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=sc>&#39;c&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=n>ival</span> <span class=o>=</span> <span class=nf>va_arg</span><span class=p>(</span><span class=n>ap</span><span class=p>,</span> <span class=kt>int</span> <span class=o>*</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=o>*</span><span class=n>ival</span> <span class=o>=</span> <span class=nf>getchar</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nf>va_end</span><span class=p>(</span><span class=n>ap</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>float</span> <span class=n>f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>s</span><span class=p>[</span><span class=mi>100</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Enter an integer: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>minscanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;i = %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Enter a float: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>minscanf</span><span class=p>(</span><span class=s>&#34;%f&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;f = %f</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Enter a string: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>minscanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;s = %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>getchar</span><span class=p>();</span> <span class=c1>// clear the input buffer
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Enter a character: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>minscanf</span><span class=p>(</span><span class=s>&#34;%c&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>c</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;c = %c</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>c</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>Enter an integer: <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=nv>i</span> <span class=o>=</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>Enter a float: 3.14
</span></span><span class=line><span class=cl><span class=nv>f</span> <span class=o>=</span> 3.140000
</span></span><span class=line><span class=cl>Enter a string: ioio
</span></span><span class=line><span class=cl><span class=nv>s</span> <span class=o>=</span> ioio
</span></span><span class=line><span class=cl>Enter a character: a
</span></span><span class=line><span class=cl><span class=nv>c</span> <span class=o>=</span> a
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise7-5>exercise7-5<a hidden class=anchor aria-hidden=true href=#exercise7-5>#</a></h2><blockquote><p>改写第 4 章中的后缀计算器程序，用 scanf 函数和（或）sscanf 函数实现输入以及数的转换。</p></blockquote><p>其他不用改变，只需要改变主函数即可，将</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>double</span> <span class=n>op2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>s</span><span class=p>[</span><span class=n>MAXOP</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Please input expression:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>((</span><span class=n>type</span> <span class=o>=</span> <span class=nf>getop</span><span class=p>(</span><span class=n>s</span><span class=p>))</span> <span class=o>!=</span> <span class=n>EOF</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=p>(</span><span class=n>type</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=nl>NUMBER</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nf>push</span><span class=p>(</span><span class=nf>atof</span><span class=p>(</span><span class=n>s</span><span class=p>));</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>修改为：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>double</span> <span class=n>op2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>s</span><span class=p>[</span><span class=n>MAXOP</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Please input expression:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>((</span><span class=n>type</span> <span class=o>=</span> <span class=nf>getop</span><span class=p>(</span><span class=n>s</span><span class=p>))</span> <span class=o>!=</span> <span class=n>EOF</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=p>(</span><span class=n>type</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=nl>NUMBER</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=kt>int</span> <span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%f&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>val</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>push</span><span class=p>(</span><span class=n>val</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise7-6>exercise7-6<a hidden class=anchor aria-hidden=true href=#exercise7-6>#</a></h2><blockquote><p>编写一个程序，比较两个文件并打印它们第一个不相同的行。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=nf>filecmp</span><span class=p>(</span><span class=n>FILE</span> <span class=o>*</span><span class=n>fp1</span><span class=p>,</span> <span class=n>FILE</span> <span class=o>*</span><span class=n>fp2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>line1</span> <span class=o>=</span> <span class=nf>malloc</span><span class=p>(</span><span class=n>MAXLINE</span><span class=p>),</span> <span class=o>*</span><span class=n>line2</span> <span class=o>=</span> <span class=nf>malloc</span><span class=p>(</span><span class=n>MAXLINE</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>lineno</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=nf>fgets</span><span class=p>(</span><span class=n>line1</span><span class=p>,</span> <span class=mi>100</span><span class=p>,</span> <span class=n>fp1</span><span class=p>)</span> <span class=o>!=</span> <span class=nb>NULL</span> <span class=o>&amp;&amp;</span> <span class=nf>fgets</span><span class=p>(</span><span class=n>line2</span><span class=p>,</span> <span class=mi>100</span><span class=p>,</span> <span class=n>fp2</span><span class=p>)</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nf>strcmp</span><span class=p>(</span><span class=n>line1</span><span class=p>,</span> <span class=n>line2</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;difference in line %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>lineno</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;line1: %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>line1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;line2: %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>line2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>lineno</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nf>feof</span><span class=p>(</span><span class=n>fp1</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nf>feof</span><span class=p>(</span><span class=n>fp2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;files are identical</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nf>feof</span><span class=p>(</span><span class=n>fp1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;file2 has extra lines</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;file1 has extra lines</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[])</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>FILE</span> <span class=o>*</span><span class=n>fp1</span><span class=p>,</span> <span class=o>*</span><span class=n>fp2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>prog</span> <span class=o>=</span> <span class=n>argv</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>       <span class=cm>/* program name for errors */</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>argc</span> <span class=o>==</span> <span class=mi>1</span> <span class=o>||</span> <span class=n>argc</span> <span class=o>==</span> <span class=mi>2</span><span class=p>)</span> <span class=cm>/* no args; copy standard input */</span>
</span></span><span class=line><span class=cl>        <span class=nf>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span> <span class=s>&#34;Usage: %s file1 file2</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>prog</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>((</span><span class=n>fp1</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>(</span><span class=o>*++</span><span class=n>argv</span><span class=p>,</span> <span class=s>&#34;r&#34;</span><span class=p>))</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span> <span class=s>&#34;%s: can&#39;t open %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>prog</span><span class=p>,</span> <span class=o>*</span><span class=n>argv</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>((</span><span class=n>fp2</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>(</span><span class=o>*++</span><span class=n>argv</span><span class=p>,</span> <span class=s>&#34;r&#34;</span><span class=p>))</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span> <span class=s>&#34;%s: can&#39;t open %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>prog</span><span class=p>,</span> <span class=o>*</span><span class=n>argv</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nf>filecmp</span><span class=p>(</span><span class=n>fp1</span><span class=p>,</span> <span class=n>fp2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nf>fclose</span><span class=p>(</span><span class=n>fp1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>fclose</span><span class=p>(</span><span class=n>fp2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>➜  ch07 git:<span class=o>(</span>main<span class=o>)</span> ✗ ./Exercise7-6 Exercise7-6.c Exercise7-5.c
</span></span><span class=line><span class=cl>difference in line <span class=m>5</span>
</span></span><span class=line><span class=cl>line1: <span class=c1>#define MAXLINE 1000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>line2: void filecopy<span class=o>(</span>FILE *ifp, FILE *ofp<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise7-7>exercise7-7<a hidden class=anchor aria-hidden=true href=#exercise7-7>#</a></h2><blockquote><p>修改第 5 章的模式查找程序，使它从一个命名文件的集合中读取输入（有文件名参数时），如果没有文件名参数，则从标准输入中读取输入。当发现一个匹配行时，是否应该将相应的文件名打印出来？</p></blockquote><h2 id=exercise7-8>exercise7-8<a hidden class=anchor aria-hidden=true href=#exercise7-8>#</a></h2><blockquote><p>编写一个程序，以打印一个文件集合，每个文件从新的一页开始打印，并且打印每个文件相应的标题和页数。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define MAXLINE 1024
</span></span></span><span class=line><span class=cl><span class=cp>#define LINES_PER_PAGE 3
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>print_file</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>file_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>FILE</span> <span class=o>*</span><span class=n>f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>page_number</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>line_count</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>new_page</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>assert</span><span class=p>(</span><span class=n>file_name</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>line</span> <span class=o>=</span> <span class=nf>malloc</span><span class=p>(</span><span class=n>MAXLINE</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>((</span><span class=n>f</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>(</span><span class=n>file_name</span><span class=p>,</span> <span class=s>&#34;r&#34;</span><span class=p>))</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=p>(</span><span class=nf>fgets</span><span class=p>(</span><span class=n>line</span><span class=p>,</span> <span class=n>MAXLINE</span><span class=p>,</span> <span class=n>f</span><span class=p>)</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>new_page</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;[%s] page %d starts</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>file_name</span><span class=p>,</span> <span class=n>page_number</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>new_page</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>line_count</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nf>feof</span><span class=p>(</span><span class=n>f</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=o>++</span><span class=n>line_count</span> <span class=o>&gt;</span> <span class=n>LINES_PER_PAGE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=cm>/* print out the footer */</span>
</span></span><span class=line><span class=cl>                <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;[%s] page %d ends</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>file_name</span><span class=p>,</span> <span class=n>page_number</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=cm>/* skip another line so we can see it on screen */</span>
</span></span><span class=line><span class=cl>                <span class=nf>putchar</span><span class=p>(</span><span class=sc>&#39;\n&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>new_page</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>page_number</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>fputs</span><span class=p>(</span><span class=n>line</span><span class=p>,</span> <span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=cm>/* skip another line so we can see it on screen */</span>
</span></span><span class=line><span class=cl>        <span class=nf>putchar</span><span class=p>(</span><span class=sc>&#39;\n&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>fclose</span><span class=p>(</span><span class=n>f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[])</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>argc</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>fputs</span><span class=p>(</span><span class=s>&#34;no files specified</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>stderr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>EXIT_FAILURE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>argc</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nf>print_file</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>EXIT_SUCCESS</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>运行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>➜  ch07 git:<span class=o>(</span>main<span class=o>)</span> ✗ ./Exercise7-8 test.txt
</span></span><span class=line><span class=cl><span class=o>[</span>test.txt<span class=o>]</span> page <span class=m>1</span> starts
</span></span><span class=line><span class=cl>It’s quite a good summary, but it would have even better when taking into account the importance of the number of requested rows, expected by the Cassandra client.
</span></span><span class=line><span class=cl>1<span class=o>)</span> “To perform the country index lookup, every node is queried, looks up the <span class=s1>&#39;UK&#39;</span> partition and <span class=k>then</span> looks up each user_accounts partition found. ”
</span></span><span class=line><span class=cl><span class=o>[</span>test.txt<span class=o>]</span> page <span class=m>1</span> ends
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>test.txt<span class=o>]</span> page <span class=m>2</span> starts
</span></span><span class=line><span class=cl>2<span class=o>)</span> “This leads to the conclusion that the best use <span class=k>case</span> <span class=k>for</span> Cassandra<span class=err>&#39;</span>s secondary indexes is when p is approximately n i.e. the number of partitions is about equal to the number of nodes.”
</span></span><span class=line><span class=cl>What a narrow best use <span class=k>case</span> ! Hopefully, there are other use cases where seconday index are fine <span class=o>(</span>that is, <span class=k>for</span> low-cardinality sets<span class=o>)</span>, or even finer <span class=o>(</span>according to the number of resulting rows requested vs the cardinality of indexed values<span class=o>)</span>.
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise7-9>exercise7-9<a hidden class=anchor aria-hidden=true href=#exercise7-9>#</a></h2><blockquote><p>类似于 isupper 这样的函数可以通过某种方式实现以达到节省空间或时间的目的。考虑节省空间或时间的实现方式。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp># define isupper(c) __isctype((c), _ISupper)
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp># define __isctype(c, type) \
</span></span></span><span class=line><span class=cl><span class=cp>  ((*__ctype_b_loc ())[(int) (c)] &amp; (unsigned short int) type)
</span></span></span></code></pre></td></tr></table></div></div><p>使用了宏定义</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://fireflyyh.top/tags/tcpl/>TCPL</a></li></ul><nav class=paginav><a class=prev href=https://fireflyyh.top/posts/tcpl/ch08/><span class=title>« Prev</span><br><span>C语言程序设计第二版课后习题--第八章</span>
</a><a class=next href=https://fireflyyh.top/posts/tcpl/ch06/><span class=title>Next »</span><br><span>C语言程序设计第二版课后习题--第六章</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://fireflyyh.top/>Jagger's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function i(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),i();return}const n=document.createRange();n.selectNodeContents(e);const s=window.getSelection();s.removeAllRanges(),s.addRange(n);try{document.execCommand("copy"),i()}catch{}s.removeRange(n)});let l=e.className.replaceAll("language-",""),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),c=document.createElement("div"),o=document.createElement("div");o.innerText=l,n.setAttribute("class","mac-tool"),a.setAttribute("class","mac bb1"),r.setAttribute("class","mac bb2"),c.setAttribute("class","mac bb3"),o.setAttribute("class","language-type"),n.appendChild(a),n.appendChild(r),n.appendChild(c),n.appendChild(o),s.classList.contains("highlight")?(s.appendChild(n),s.appendChild(t)):s.parentNode.firstChild==s||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?(s.appendChild(n),e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t)):(s.appendChild(n),e.parentNode.appendChild(t)))})</script></body></html>