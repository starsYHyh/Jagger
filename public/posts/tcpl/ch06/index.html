<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>C语言程序设计第二版课后习题--第六章 | Jagger's Blog</title>
<meta name=keywords content="TCPL"><meta name=description content="部分答案参考了官方题解和网上的答案，仅供参考，可能也有部分bug未发现或解决。
exercise6-1 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 #define NKEYS (sizeof keytab / sizeof(keytab[0])) int binsearch(char *word, struct key tab[], int n) { int cond; int low, high, mid; low = 0; high = n - 1; while (low <= high) { mid = (low + high) / 2; if ((cond = strcmp(word, tab[mid]."><meta name=author content="Jagger"><link rel=canonical href=https://fireflyyh.top/posts/tcpl/ch06/><link crossorigin=anonymous href=/assets/css/stylesheet.85106b68d21097b36df07bae454e1c50c6b1bdee98f9081be69e9968653bd3a0.css integrity="sha256-hRBraNIQl7Nt8HuuRU4cUMaxve6Y+Qgb5p6ZaGU706A=" rel="preload stylesheet" as=style><link rel=icon href=https://fireflyyh.top/img/yuan.jpg><link rel=icon type=image/png sizes=16x16 href=https://fireflyyh.top/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://fireflyyh.top/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://fireflyyh.top/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://fireflyyh.top/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://fireflyyh.top/posts/tcpl/ch06/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?87f1888ba5320e03987ecde7525fde2d",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script type=text/javascript async src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["[[","]]"]],processEscapes:!0,processEnvironments:!0,skipTags:["script","noscript","style","textarea","pre"],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}}),MathJax.Hub.Queue(function(){var e,t=MathJax.Hub.getAllJax();for(e=0;e<t.length;e+=1)t[e].SourceElement().parentNode.className+=" has-jax"})</script><style>code.has-jax{font:inherit;font-size:100%;background:inherit;border:inherit;color:#515151}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-Y30PKHXBN4"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Y30PKHXBN4")</script><meta property="og:title" content="C语言程序设计第二版课后习题--第六章"><meta property="og:description" content="部分答案参考了官方题解和网上的答案，仅供参考，可能也有部分bug未发现或解决。
exercise6-1 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 #define NKEYS (sizeof keytab / sizeof(keytab[0])) int binsearch(char *word, struct key tab[], int n) { int cond; int low, high, mid; low = 0; high = n - 1; while (low <= high) { mid = (low + high) / 2; if ((cond = strcmp(word, tab[mid]."><meta property="og:type" content="article"><meta property="og:url" content="https://fireflyyh.top/posts/tcpl/ch06/"><meta property="og:image" content="https://fireflyyh.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-18T00:00:00+00:00"><meta property="article:modified_time" content="2024-10-18T00:00:00+00:00"><meta property="og:site_name" content="Jagger's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://fireflyyh.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="C语言程序设计第二版课后习题--第六章"><meta name=twitter:description content="部分答案参考了官方题解和网上的答案，仅供参考，可能也有部分bug未发现或解决。
exercise6-1 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 #define NKEYS (sizeof keytab / sizeof(keytab[0])) int binsearch(char *word, struct key tab[], int n) { int cond; int low, high, mid; low = 0; high = n - 1; while (low <= high) { mid = (low + high) / 2; if ((cond = strcmp(word, tab[mid]."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://fireflyyh.top/posts/"},{"@type":"ListItem","position":2,"name":"C语言程序设计第二版课后习题--第六章","item":"https://fireflyyh.top/posts/tcpl/ch06/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"C语言程序设计第二版课后习题--第六章","name":"C语言程序设计第二版课后习题--第六章","description":"部分答案参考了官方题解和网上的答案，仅供参考，可能也有部分bug未发现或解决。\nexercise6-1 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 #define NKEYS (sizeof keytab / sizeof(keytab[0])) int binsearch(char *word, struct key tab[], int n) { int cond; int low, high, mid; low = 0; high = n - 1; while (low \u0026lt;= high) { mid = (low + high) / 2; if ((cond = strcmp(word, tab[mid].","keywords":["TCPL"],"articleBody":" 部分答案参考了官方题解和网上的答案，仅供参考，可能也有部分bug未发现或解决。\nexercise6-1 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 #define NKEYS (sizeof keytab / sizeof(keytab[0])) int binsearch(char *word, struct key tab[], int n) { int cond; int low, high, mid; low = 0; high = n - 1; while (low \u003c= high) { mid = (low + high) / 2; if ((cond = strcmp(word, tab[mid].word)) \u003c 0) high = mid - 1; else if (cond \u003e 0) low = mid + 1; else return mid; } return -1; } int getword(char *word, int lim) { int c; char *w = word; while (isspace(c = getch())) ; if (c != EOF) *w++ = c; if (!isalpha(c)) { *w = '\\0'; return c; } for (; --lim \u003e 0; w++) if (!isalnum(*w = getch())) { ungetch(*w); break; } *w = '\\0'; return word[0]; } int main() { int n; char word[MAXWORD]; while (getword(word, MAXWORD) != EOF) if (isalpha(word[0])) if ((n = binsearch(word, keytab, NKEYS)) \u003e= 0) keytab[n].count++; for (n = 0; n \u003c NKEYS; n++) if (keytab[n].count \u003e 0) printf(\"%4d %s\\n\", keytab[n].count, keytab[n].word); return 0; } 上述 getword 函数不能正确处理下划线、字符串常量、注释及预处理器控制指令。请编写一个更完善的 getword 函数。\n代码：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 enum { NORMAL, COMMENT, PREPROCESSOR, STRING, UNDERSCORE }; int getword02(char *word, int lim) { int c, d, inComment = 0, inString = 0, isPreprocessor = 0, isUnderscore = 0; // 分别表示是否在注释、字符串、预处理指令、下划线中 char *w = word; while (isspace(c = getch())) ; if (c != EOF) *w++ = c; type = NORMAL; // 默认为普通字符 if (c == '\"') inString = 1; else if (c == '/' \u0026\u0026 (d = getch()) == '*') // 注释 { *w++ = d; inComment = 1; } else if (c == '#') // 预处理指令 { isPreprocessor = 1; } else if (c == '_') // 下划线 { isUnderscore = 1; } else if (!isalpha(c) \u0026\u0026 c != '_') // 不合法字符 { *w = '\\0'; return c; } for (; --lim \u003e 0; w++) { if (inString) // 如果在字符串中，直到遇到双引号才结束 { if ((*w = getch()) == '\"') { w++; type = STRING; break; } } else if (inComment) { if ((*w = getch()) == '*' \u0026\u0026 (d = getch()) == '/') // 注释结束 { w++; *w++ = d; type = COMMENT; break; } } else if (isPreprocessor) // 如果在预处理指令中，直到遇到空格才结束 { if (isspace(*w = getch())) { type = PREPROCESSOR; break; } } else if (isUnderscore) // 如果在下划线中，直到遇到空格才结束 { if (isspace(*w = getch())) { type = UNDERSCORE; break; } } else { if (!isalnum(*w = getch()) \u0026\u0026 *w != '_') // 如果不是字母或下划线，结束 { ungetch(*w); break; } } } *w = '\\0'; return word[0]; } int main() { int n; char word[MAXWORD]; while (getword02(word, MAXWORD) != EOF) // 读取单词 { if (type == COMMENT) printf(\"Comment: %s\\n\", word); else if (type == PREPROCESSOR) printf(\"Preprocessor: %s\\n\", word); else if (type == STRING) printf(\"String: %s\\n\", word); else if (type == UNDERSCORE) printf(\"Underscore: %s\\n\", word); else if (isalpha(word[0]) \u0026\u0026 ((n = binsearch(word, keytab, NKEYS)) \u003e= 0)) { keytab[n].count++; printf(\"Keyword: %s\\n\", word); } } printf(\"\\nkeywords:\\n\"); for (n = 0; n \u003c NKEYS; n++) if (keytab[n].count \u003e 0) printf(\"%4d %s\\n\", keytab[n].count, keytab[n].word); return 0; } 运行：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 /*comment*/ #define \"string\" while for while int _variable Comment: /*comment*/ Preprocessor: #define String: \"string\" Keyword: while Keyword: for Keyword: while Keyword: int Underscore: _variable keywords: 1 for 1 int 2 while exercise6-2 编写一个程序，用以读入一个 C 语言程序，并按字母表顺序分组打印变量名，要求每一组内各变量名的前 6 个字符相同，其余字符不同。字符串和注释中的单词不予考虑。请将 6 作为一个可在命令行中设定的参数。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 #define GRPLEN 6 #define NKEYS (sizeof keytab / sizeof(keytab[0])) enum { NORMAL, COMMENT, PREPROCESSOR, STRING, UNDERSCORE }; struct tnode { /* the tree node: */ char *word; /* points to the text */ int count; /* number of occurrences */ struct tnode *left; /* left child */ struct tnode *right; /* right child */ }; int group_length = GRPLEN; int type; struct tnode *talloc(void) { return (struct tnode *)malloc(sizeof(struct tnode)); } char *Strdup(char *s) /* make a duplicate of s */ { char *p; p = (char *)malloc(strlen(s) + 1); /* +1 for '\\0' */ if (p != NULL) strcpy(p, s); return p; } /* addtree: add a node with w, at or below p */ struct tnode *addtree(struct tnode *p, char *w) { int cond; if (p == NULL) { /* a new word has arrived */ p = talloc(); /* make a new node */ p-\u003eword = Strdup(w); p-\u003ecount = 1; p-\u003eleft = p-\u003eright = NULL; } else if ((cond = strcmp(w, p-\u003eword)) == 0) p-\u003ecount++; /* repeated word */ else if (cond \u003c 0) /* less than into left subtree */ p-\u003eleft = addtree(p-\u003eleft, w); else /* greater than into right subtree */ p-\u003eright = addtree(p-\u003eright, w); return p; } /* treeprint: in-order print of tree p */ void treeprint(struct tnode *p) { if (p != NULL) { treeprint(p-\u003eleft); printf(\"%4d %s\\n\", p-\u003ecount, p-\u003eword); treeprint(p-\u003eright); } } int binsearch(char *word, struct key tab[], int n) { int cond; int low, high, mid; low = 0; high = n - 1; while (low \u003c= high) { mid = (low + high) / 2; if ((cond = strcmp(word, tab[mid].word)) \u003c 0) high = mid - 1; else if (cond \u003e 0) low = mid + 1; else return mid; } return -1; } int getword(char *word, int lim) { int c, d, inComment = 0, inString = 0, isPreprocessor = 0, isUnderscore = 0; // 分别表示是否在注释、字符串、预处理指令、下划线中 char *w = word; while (isspace(c = getch())) ; if (c != EOF) *w++ = c; type = NORMAL; // 默认为普通字符 if (c == '\"') inString = 1; else if (c == '/' \u0026\u0026 (d = getch()) == '*') // 注释 { *w++ = d; inComment = 1; } else if (c == '#') // 预处理指令 { isPreprocessor = 1; } else if (c == '_') // 下划线 { isUnderscore = 1; } else if (!isalpha(c) \u0026\u0026 c != '_') // 不合法字符 { *w = '\\0'; return c; } for (; --lim \u003e 0; w++) { if (inString) // 如果在字符串中，直到遇到双引号才结束 { if ((*w = getch()) == '\"') { w++; type = STRING; break; } } else if (inComment) { if ((*w = getch()) == '*' \u0026\u0026 (d = getch()) == '/') // 注释结束 { w++; *w++ = d; type = COMMENT; break; } } else if (isPreprocessor) // 如果在预处理指令中，直到遇到空格才结束 { if (isspace(*w = getch())) { type = PREPROCESSOR; break; } } else if (isUnderscore) // 如果在下划线中，直到遇到空格才结束 { if (isspace(*w = getch())) { type = UNDERSCORE; break; } } else { if (!isalnum(*w = getch()) \u0026\u0026 *w != '_') // 如果不是字母或下划线，结束 { ungetch(*w); break; } } } *w = '\\0'; return word[0]; } bool is_variable(char *word) { return binsearch(word, keytab, NKEYS) \u003c 0; } void groupprint(struct tnode *p, char *prefix) { if (p != NULL) { groupprint(p-\u003eleft, prefix); if (strncmp(p-\u003eword, prefix, group_length) == 0) { printf(\"%4d %s\\n\", p-\u003ecount, p-\u003eword); } groupprint(p-\u003eright, prefix); } } void print_groups(struct tnode *root) { if (root == NULL) return; char current_prefix[MAXWORD] = \"\"; struct tnode *current = root; while (current != NULL) { strncpy(current_prefix, current-\u003eword, group_length); current_prefix[group_length] = '\\0'; printf(\"Group: %s\\n\", current_prefix); groupprint(root, current_prefix); current = current-\u003eright; } } int main(int argc, char *argv[]) { if (argc \u003e 1) { group_length = atoi(argv[1]); } int n; struct tnode *root = NULL; char word[MAXWORD]; while (getword(word, MAXWORD) != EOF) if (type == NORMAL \u0026\u0026 isalpha(word[0]) \u0026\u0026 is_variable(word)) root = addtree(root, word); print_groups(root); return 0; } 运行：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 ➜ ch06 git:(main) ./Exercise6-2 5 #include int main() { int varOne = 1; int varTwo = 2; int varThree = 3; float varOneMore = 4.0; char varTwoMore = 'a'; // This is a comment /* This is a block comment int varFour = 4; */ return 0; } Group: stdio 1 stdio Group: varOn 1 varOne 1 varOneMore Group: varTw 1 varTwo 1 varTwoMore Group: varTw 1 varTwo 1 varTwoMore exercise6-3 编写一个交叉引用程序，打印文档中所有单词的列表，并且每个单词还有一个列表，记录出现过该单词的行号。对 the、and 等非实义单词不予考虑。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 struct tnode { char *word; int lines[MAXLINES]; int line_count; struct tnode *left; struct tnode *right; }; int line_number = 1; struct tnode *talloc(void) { return (struct tnode *)malloc(sizeof(struct tnode)); } char *strdup(const char *s) { char *p = (char *)malloc(strlen(s) + 1); if (p != NULL) strcpy(p, s); return p; } struct tnode *addtree(struct tnode *p, char *w, int lineno) { int cond; if (p == NULL) { p = talloc(); p-\u003eword = strdup(w); p-\u003elines[0] = lineno; p-\u003eline_count = 1; p-\u003eleft = p-\u003eright = NULL; } else if ((cond = strcmp(w, p-\u003eword)) == 0) { if (p-\u003elines[p-\u003eline_count - 1] != lineno) p-\u003elines[p-\u003eline_count++] = lineno; } else if (cond \u003c 0) p-\u003eleft = addtree(p-\u003eleft, w, lineno); else p-\u003eright = addtree(p-\u003eright, w, lineno); return p; } void treeprint(struct tnode *p) { if (p != NULL) { treeprint(p-\u003eleft); printf(\"%s: \", p-\u003eword); for (int i = 0; i \u003c p-\u003eline_count; i++) printf(\"%d \", p-\u003elines[i]); printf(\"\\n\"); treeprint(p-\u003eright); } } int getword(char *word, int lim) { int c; char *w = word; while (isspace(c = getch())) if (c == '\\n') line_number++; if (c != EOF) *w++ = c; if (!isalpha(c)) { *w = '\\0'; return c; } for (; --lim \u003e 0; w++) if (!isalnum(*w = getch())) { ungetch(*w); break; } *w = '\\0'; return word[0]; } int is_noise_word(char *word) { static char *noise_words[] = { \"the\", \"and\", \"a\", \"an\", \"in\", \"on\", \"of\", \"to\", \"is\", \"are\", \"was\", \"were\", \"it\", \"that\", \"this\", \"with\", \"as\", \"for\", \"by\", \"at\", \"from\", \"but\", \"or\", \"not\", \"be\", \"have\", \"has\", \"had\", \"do\", \"does\", \"did\", \"will\", \"would\", \"can\", \"could\", \"should\", \"shall\", \"may\", \"might\", \"must\", \"if\", \"then\", \"else\", \"when\", \"where\", \"which\", \"who\", \"whom\", \"whose\", \"why\", \"how\", NULL}; for (char **p = noise_words; *p != NULL; p++) if (strcmp(word, *p) == 0) return 1; return 0; } int main(void) { struct tnode *root = NULL; char word[MAXWORD]; while (getword(word, MAXWORD) != EOF) if (isalpha(word[0]) \u0026\u0026 !is_noise_word(word)) root = addtree(root, word, line_number); treeprint(root); return 0; } 运行：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 ➜ ch06 git:(main) ./Exercise6-3 \u003c test.txt AFAIK: 3 Cassandra: 1 4 Hopefully: 5 It: 1 So: 3 This: 4 To: 2 UK: 2 Well: 3 What: 5 about: 4 according: 5 account: 1 accounts: 2 all: 3 always: 3 approximately: 4 been: 3 best: 4 5 better: 1 calls: 3 cardinality: 5 case: 4 5 cases: 5 client: 1 conclusion: 4 country: 2 e: 4 each: 2 enough: 3 equal: 4 even: 1 5 every: 2 3 expected: 1 fine: 5 finer: 5 found: 2 3 good: 1 i: 4 importance: 1 index: 2 5 indexed: 5 indexes: 4 into: 1 leads: 4 looks: 2 lookup: 2 low: 5 n: 4 narrow: 5 node: 2 3 nodes: 3 4 number: 1 4 5 other: 5 p: 4 partition: 2 partitions: 4 perform: 2 queried: 2 3 quite: 1 requested: 1 5 resulting: 5 rows: 1 3 5 s: 1 4 secondary: 4 seconday: 5 sets: 5 stop: 3 summary: 1 taking: 1 there: 5 up: 2 use: 4 5 user: 2 values: 5 vs: 5 exercise6-4 编写一个程序，根据单词的出现频率按降序打印输入的各个不同单词，并在每个单词的前面标上它的出现次数。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 // 将树转换为列表 void treeToList(struct tnode *p, struct wordinfo list[]) { if (p != NULL) { treeToList(p-\u003eleft, list); list[counter].word = strdup(p-\u003eword); list[counter].count = p-\u003ecount; counter++; treeToList(p-\u003eright, list); } } // 打印列表 void listprint(struct wordinfo list[]) { for (int i = 0; i \u003c wordCount; i++) { printf(\"%4d %s\\n\", list[i].count, list[i].word); } } // 交换两个元素 void swap(struct wordinfo list[], int i, int j) { struct wordinfo temp; temp = list[i]; list[i] = list[j]; list[j] = temp; } // 根据单词出现的频率来进行快速排序 void mqsort(struct wordinfo list[], int left, int right) { int i, last; if (left \u003e= right) return; swap(list, left, (left + right) / 2); last = left; for (i = left + 1; i \u003c= right; i++) if (list[i].count \u003e list[left].count) swap(list, ++last, i); swap(list, left, last); mqsort(list, left, last - 1); mqsort(list, last + 1, right); } int main(void) { struct tnode *root; char word[MAXWORD]; root = NULL; while (getword(word, MAXWORD) != EOF) if (isalpha(word[0])) root = addtree(root, word); printf(\"Count of words is %d\\n\", wordCount); struct wordinfo list[wordCount]; treeToList(root, list); mqsort(list, 0, wordCount - 1); listprint(list); return 0; } 运行：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 ➜ ch06 git:(main) ./Exercise6-4 \u003c test.txt Count of words is 95 12 the 6 of 6 is 4 number 3 queried 3 rows 3 are 3 node 3 to 3 when 3 use 2 index 2 found 2 have 2 Cassandra 2 looks 2 cardinality 2 nodes 2 even 2 not 2 for 2 partition 2 best 2 requested 2 every 2 s 2 case 2 that 2 a 2 up 1 leads 1 So 1 This 1 e 1 or 1 enough 1 other 1 and 1 p 1 expected 1 calls 1 finer 1 partitions 1 been 1 perform 1 accounts 1 To 1 importance 1 quite 1 indexed 1 all 1 into 1 resulting 1 it 1 UK 1 better 1 always 1 low 1 secondary 1 narrow 1 seconday 1 but 1 sets 1 country 1 stop 1 equal 1 summary 1 fine 1 taking 1 good 1 cases 1 AFAIK 1 Well 1 Hopefully 1 then 1 lookup 1 there 1 It 1 What 1 each 1 client 1 account 1 conclusion 1 indexes 1 user 1 n 1 values 1 approximately 1 vs 1 according 1 about 1 i 1 where 1 by 1 would exercise6-5 编写函数 undef，它将从由 lookup 和 install 维护的表中删除一个变量及其定义。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 /* undef: remove a name and its definition from the hashtab */ void undef(char *name) { struct nlist *np, *prev = NULL; unsigned hashval = hash(name); for (np = hashtab[hashval]; np != NULL; prev = np, np = np-\u003enext) // 遍历链表 { if (strcmp(name, np-\u003ename) == 0) { if (prev == NULL) hashtab[hashval] = np-\u003enext; else prev-\u003enext = np-\u003enext; free(np-\u003ename); free(np-\u003edefn); free(np); return; } } } int main(void) { struct nlist *np; printf(\"test install \\\"MAXLINE\\\" \\\"BUFSIZE\\\":\\n\"); install(\"MAXLINE\", \"1000\"); install(\"BUFSIZE\", \"100\"); np = lookup(\"MAXLINE\"); if (np == NULL) printf(\"install failed\\n\"); else printf(\"defination of \\\"MAXLINE\\\" is: %s\\n\", np-\u003edefn); printf(\"install success\\n\"); printf(\"\\ntest undef \\\"BUFSIZE\\\":\\n\"); undef(\"BUFSIZE\"); np = lookup(\"BUFSIZE\"); if (np == NULL) printf(\"can not find defination of \\\"BUFSIZE\\\"\\nundef success\\n\"); return 0; } 运行：\n1 2 3 4 5 6 7 8 ➜ ch06 git:(main) ✗ ./Exercise6-5 test install \"MAXLINE\" \"BUFSIZE\": defination of \"MAXLINE\" is: 1000 install success test undef \"BUFSIZE\": can not find defination of \"BUFSIZE\" undef success exercise6-6 以本节介绍的函数为基础，编写一个适合 C 语言程序使用的#define 处理器的简单版本（即无参数的情况）。你会发现 getch 和 ungetch 函数非常有用。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 void skipblanks(void) { int c; while ((c = getch()) == ' ' || c == '\\t') ; ungetch(c); } void getdef(void) { int c, i; char def[BUFSIZE], name[BUFSIZE]; skipblanks(); if (!isalpha(c = getch())) { printf(\"getdef: invalid macro name\\n\"); return; } for (i = 0; isalnum(c) || c == '_'; c = getch()) name[i++] = c; name[i] = '\\0'; skipblanks(); if (c != ' ') { printf(\"getdef: missing space after macro name\\n\"); return; } for (i = 0; (c = getch()) != EOF \u0026\u0026 c != '\\n';) def[i++] = c; def[i] = '\\0'; if (i \u003e 0) install(name, def); } void procdef(void) { int c; while ((c = getch()) != EOF) { if (c == '#') { char keyword[7]; int i; for (i = 0; i \u003c 6 \u0026\u0026 (c = getch()) != EOF; i++) { keyword[i] = c; } keyword[i] = '\\0'; if (strcmp(keyword, \"define\") == 0) { getdef(); } } } } int main(void) { procdef(); printf(\"name defination\\n\"); for (int i = 0; i \u003c HASHSIZE; i++) { struct nlist *np = hashtab[i]; while (np != NULL) { printf(\"%-16s%s\\n\", np-\u003ename, np-\u003edefn); np = np-\u003enext; } } return 0; } 对于test.c：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 #define LISTENQ 1024 #define MAXLINE 4096 #define BUFFSIZE 8192 #define SERV_PORT 9877 #define AI_PASSIVE 1 #define AI_CANONNAME 2 #define NI_MAXHOST 1025 #define NI_MAXSERV 32 #define NI_NOFQDN 1 #define NI_NUMERICHOST 2 #define NI_NAMEREQD 4 #define NI_NUMERICSERV 8 #define NI_DGRAM 16 #define EAI_ADDRFAMILY 1 #define EAI_AGAIN 2 #define EAI_BADFLAGS 3 #define EAI_FAIL 4 #define EAI_FAMILY 5 #define EAI_MEMORY 6 #define EAI_NODATA 7 #define EAI_NONAME 8 #define EAI_SERVICE 9 #define EAI_SOCKTYPE 10 #define EAI_SYSTEM 11 运行：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 ➜ ch06 git:(main) ✗ ./Exercise6-6 \u003c test.c name defination AI_CANONNAME 2 NI_NUMERICHOST 2 EAI_NONAME 8 EAI_ADDRFAMILY 1 NI_NUMERICSERV 8 AI_PASSIVE 1 EAI_SERVICE 9 SERV_PORT 9877 EAI_SOCKTYPE 10 EAI_MEMORY 6 EAI_AGAIN 2 EAI_BADFLAGS 3 NI_MAXHOST 1025 EAI_FAIL 4 NI_NAMEREQD 4 EAI_NODATA 7 MAXLINE 4096 NI_MAXSERV 32 EAI_SYSTEM 11 BUFFSIZE 8192 NI_DGRAM 16 NI_NOFQDN 1 EAI_FAMILY 5 LISTENQ 1024 ","wordCount":"3577","inLanguage":"en","image":"https://fireflyyh.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-10-18T00:00:00Z","dateModified":"2024-10-18T00:00:00Z","author":{"@type":"Person","name":"Jagger"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://fireflyyh.top/posts/tcpl/ch06/"},"publisher":{"@type":"Organization","name":"Jagger's Blog","logo":{"@type":"ImageObject","url":"https://fireflyyh.top/img/yuan.jpg"}}}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-Y30PKHXBN4"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Y30PKHXBN4")</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://fireflyyh.top/ accesskey=h title="Jagger's Blog (Alt + H)"><img src=https://fireflyyh.top/img/laugh.jpg alt aria-label=logo height=35>Jagger's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://fireflyyh.top/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://fireflyyh.top/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://fireflyyh.top/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://fireflyyh.top/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://fireflyyh.top/about/ title=About><span>About</span></a></li><li><a href=https://github.com/starsYHyh/Jagger/ title=Github><span>Github</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://fireflyyh.top/>Home</a>&nbsp;»&nbsp;<a href=https://fireflyyh.top/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">C语言程序设计第二版课后习题--第六章
<span class=entry-hint title=Draft><svg height="35" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h1><div class=post-meta><span title='2024-10-18 00:00:00 +0000 UTC'>October 18, 2024</span>&nbsp;·&nbsp;17 min&nbsp;·&nbsp;3577 words&nbsp;·&nbsp;Jagger&nbsp;|&nbsp;<a href=https://github.com/starsYHyh/Jagger/tree/main/content/posts/TCPL/ch06.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#exercise6-1 aria-label=exercise6-1>exercise6-1</a></li><li><a href=#exercise6-2 aria-label=exercise6-2>exercise6-2</a></li><li><a href=#exercise6-3 aria-label=exercise6-3>exercise6-3</a></li><li><a href=#exercise6-4 aria-label=exercise6-4>exercise6-4</a></li><li><a href=#exercise6-5 aria-label=exercise6-5>exercise6-5</a></li><li><a href=#exercise6-6 aria-label=exercise6-6>exercise6-6</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{elements&&(activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")}))},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><blockquote><p>部分答案参考了官方题解和网上的答案，仅供参考，可能也有部分bug未发现或解决。</p></blockquote><h2 id=exercise6-1>exercise6-1<a hidden class=anchor aria-hidden=true href=#exercise6-1>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#define NKEYS (sizeof keytab / sizeof(keytab[0]))
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>binsearch</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>word</span><span class=p>,</span> <span class=k>struct</span> <span class=n>key</span> <span class=n>tab</span><span class=p>[],</span> <span class=kt>int</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>cond</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>low</span><span class=p>,</span> <span class=n>high</span><span class=p>,</span> <span class=n>mid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>low</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>high</span> <span class=o>=</span> <span class=n>n</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=n>low</span> <span class=o>&lt;=</span> <span class=n>high</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>mid</span> <span class=o>=</span> <span class=p>(</span><span class=n>low</span> <span class=o>+</span> <span class=n>high</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>((</span><span class=n>cond</span> <span class=o>=</span> <span class=nf>strcmp</span><span class=p>(</span><span class=n>word</span><span class=p>,</span> <span class=n>tab</span><span class=p>[</span><span class=n>mid</span><span class=p>].</span><span class=n>word</span><span class=p>))</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>high</span> <span class=o>=</span> <span class=n>mid</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>cond</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>low</span> <span class=o>=</span> <span class=n>mid</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>mid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>getword</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>word</span><span class=p>,</span> <span class=kt>int</span> <span class=n>lim</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>w</span> <span class=o>=</span> <span class=n>word</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=nf>isspace</span><span class=p>(</span><span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>        <span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>!=</span> <span class=n>EOF</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=n>w</span><span class=o>++</span> <span class=o>=</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nf>isalpha</span><span class=p>(</span><span class=n>c</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=n>w</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(;</span> <span class=o>--</span><span class=n>lim</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>;</span> <span class=n>w</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nf>isalnum</span><span class=p>(</span><span class=o>*</span><span class=n>w</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>ungetch</span><span class=p>(</span><span class=o>*</span><span class=n>w</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>w</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>word</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>word</span><span class=p>[</span><span class=n>MAXWORD</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=nf>getword</span><span class=p>(</span><span class=n>word</span><span class=p>,</span> <span class=n>MAXWORD</span><span class=p>)</span> <span class=o>!=</span> <span class=n>EOF</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nf>isalpha</span><span class=p>(</span><span class=n>word</span><span class=p>[</span><span class=mi>0</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>((</span><span class=n>n</span> <span class=o>=</span> <span class=nf>binsearch</span><span class=p>(</span><span class=n>word</span><span class=p>,</span> <span class=n>keytab</span><span class=p>,</span> <span class=n>NKEYS</span><span class=p>))</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>keytab</span><span class=p>[</span><span class=n>n</span><span class=p>].</span><span class=n>count</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>n</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>n</span> <span class=o>&lt;</span> <span class=n>NKEYS</span><span class=p>;</span> <span class=n>n</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>keytab</span><span class=p>[</span><span class=n>n</span><span class=p>].</span><span class=n>count</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%4d %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                   <span class=n>keytab</span><span class=p>[</span><span class=n>n</span><span class=p>].</span><span class=n>count</span><span class=p>,</span> <span class=n>keytab</span><span class=p>[</span><span class=n>n</span><span class=p>].</span><span class=n>word</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>上述 getword 函数不能正确处理下划线、字符串常量、注释及预处理器控制指令。请编写一个更完善的 getword 函数。</p></blockquote><p>代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>enum</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>NORMAL</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>COMMENT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>PREPROCESSOR</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>STRING</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>UNDERSCORE</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>getword02</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>word</span><span class=p>,</span> <span class=kt>int</span> <span class=n>lim</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>c</span><span class=p>,</span> <span class=n>d</span><span class=p>,</span> <span class=n>inComment</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>inString</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>isPreprocessor</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>isUnderscore</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=c1>// 分别表示是否在注释、字符串、预处理指令、下划线中
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>char</span> <span class=o>*</span><span class=n>w</span> <span class=o>=</span> <span class=n>word</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=nf>isspace</span><span class=p>(</span><span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>        <span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>!=</span> <span class=n>EOF</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=n>w</span><span class=o>++</span> <span class=o>=</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>type</span> <span class=o>=</span> <span class=n>NORMAL</span><span class=p>;</span>  <span class=c1>// 默认为普通字符
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;&#34;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>inString</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;/&#39;</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>d</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>())</span> <span class=o>==</span> <span class=sc>&#39;*&#39;</span><span class=p>)</span>  <span class=c1>// 注释
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=n>w</span><span class=o>++</span> <span class=o>=</span> <span class=n>d</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>inComment</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;#&#39;</span><span class=p>)</span>  <span class=c1>// 预处理指令
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>isPreprocessor</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;_&#39;</span><span class=p>)</span>  <span class=c1>// 下划线
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>isUnderscore</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nf>isalpha</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=n>c</span> <span class=o>!=</span> <span class=sc>&#39;_&#39;</span><span class=p>)</span>   <span class=c1>// 不合法字符
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=n>w</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(;</span> <span class=o>--</span><span class=n>lim</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>;</span> <span class=n>w</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>inString</span><span class=p>)</span>   <span class=c1>// 如果在字符串中，直到遇到双引号才结束
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>((</span><span class=o>*</span><span class=n>w</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>())</span> <span class=o>==</span> <span class=sc>&#39;&#34;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>w</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>type</span> <span class=o>=</span> <span class=n>STRING</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>inComment</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>((</span><span class=o>*</span><span class=n>w</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>())</span> <span class=o>==</span> <span class=sc>&#39;*&#39;</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>d</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>())</span> <span class=o>==</span> <span class=sc>&#39;/&#39;</span><span class=p>)</span>  <span class=c1>// 注释结束
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>w</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=o>*</span><span class=n>w</span><span class=o>++</span> <span class=o>=</span> <span class=n>d</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>type</span> <span class=o>=</span> <span class=n>COMMENT</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>isPreprocessor</span><span class=p>)</span>    <span class=c1>// 如果在预处理指令中，直到遇到空格才结束
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nf>isspace</span><span class=p>(</span><span class=o>*</span><span class=n>w</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>type</span> <span class=o>=</span> <span class=n>PREPROCESSOR</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>isUnderscore</span><span class=p>)</span>  <span class=c1>// 如果在下划线中，直到遇到空格才结束
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nf>isspace</span><span class=p>(</span><span class=o>*</span><span class=n>w</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>type</span> <span class=o>=</span> <span class=n>UNDERSCORE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nf>isalnum</span><span class=p>(</span><span class=o>*</span><span class=n>w</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>())</span> <span class=o>&amp;&amp;</span> <span class=o>*</span><span class=n>w</span> <span class=o>!=</span> <span class=sc>&#39;_&#39;</span><span class=p>)</span>    <span class=c1>// 如果不是字母或下划线，结束
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>ungetch</span><span class=p>(</span><span class=o>*</span><span class=n>w</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>w</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>word</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>word</span><span class=p>[</span><span class=n>MAXWORD</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=nf>getword02</span><span class=p>(</span><span class=n>word</span><span class=p>,</span> <span class=n>MAXWORD</span><span class=p>)</span> <span class=o>!=</span> <span class=n>EOF</span><span class=p>)</span> <span class=c1>// 读取单词
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>type</span> <span class=o>==</span> <span class=n>COMMENT</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Comment: %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>word</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>type</span> <span class=o>==</span> <span class=n>PREPROCESSOR</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Preprocessor: %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>word</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>type</span> <span class=o>==</span> <span class=n>STRING</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;String: %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>word</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>type</span> <span class=o>==</span> <span class=n>UNDERSCORE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Underscore: %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>word</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nf>isalpha</span><span class=p>(</span><span class=n>word</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=p>((</span><span class=n>n</span> <span class=o>=</span> <span class=nf>binsearch</span><span class=p>(</span><span class=n>word</span><span class=p>,</span> <span class=n>keytab</span><span class=p>,</span> <span class=n>NKEYS</span><span class=p>))</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>keytab</span><span class=p>[</span><span class=n>n</span><span class=p>].</span><span class=n>count</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Keyword: %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>word</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\n</span><span class=s>keywords:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>n</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>n</span> <span class=o>&lt;</span> <span class=n>NKEYS</span><span class=p>;</span> <span class=n>n</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>keytab</span><span class=p>[</span><span class=n>n</span><span class=p>].</span><span class=n>count</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%4d %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                   <span class=n>keytab</span><span class=p>[</span><span class=n>n</span><span class=p>].</span><span class=n>count</span><span class=p>,</span> <span class=n>keytab</span><span class=p>[</span><span class=n>n</span><span class=p>].</span><span class=n>word</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>/*comment*/ <span class=c1>#define &#34;string&#34; while for while int _variable</span>
</span></span><span class=line><span class=cl>Comment: /*comment*/
</span></span><span class=line><span class=cl>Preprocessor: <span class=c1>#define</span>
</span></span><span class=line><span class=cl>String: <span class=s2>&#34;string&#34;</span>
</span></span><span class=line><span class=cl>Keyword: <span class=k>while</span>
</span></span><span class=line><span class=cl>Keyword: <span class=k>for</span>
</span></span><span class=line><span class=cl>Keyword: <span class=k>while</span>
</span></span><span class=line><span class=cl>Keyword: int
</span></span><span class=line><span class=cl>Underscore: _variable
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>keywords:
</span></span><span class=line><span class=cl>   <span class=m>1</span> <span class=k>for</span>
</span></span><span class=line><span class=cl>   <span class=m>1</span> int
</span></span><span class=line><span class=cl>   <span class=m>2</span> <span class=k>while</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise6-2>exercise6-2<a hidden class=anchor aria-hidden=true href=#exercise6-2>#</a></h2><blockquote><p>编写一个程序，用以读入一个 C 语言程序，并按字母表顺序分组打印变量名，要求每一组内各变量名的前 6 个字符相同，其余字符不同。字符串和注释中的单词不予考虑。请将 6 作为一个可在命令行中设定的参数。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#define GRPLEN 6
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define NKEYS (sizeof keytab / sizeof(keytab[0]))
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>enum</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>NORMAL</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>COMMENT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>PREPROCESSOR</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>STRING</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>UNDERSCORE</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=n>tnode</span>
</span></span><span class=line><span class=cl><span class=p>{</span>                        <span class=cm>/* the tree node: */</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>word</span><span class=p>;</span>          <span class=cm>/* points to the text */</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>count</span><span class=p>;</span>           <span class=cm>/* number of occurrences */</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=n>tnode</span> <span class=o>*</span><span class=n>left</span><span class=p>;</span>  <span class=cm>/* left child */</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=n>tnode</span> <span class=o>*</span><span class=n>right</span><span class=p>;</span> <span class=cm>/* right child */</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>group_length</span> <span class=o>=</span> <span class=n>GRPLEN</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=n>tnode</span> <span class=o>*</span><span class=nf>talloc</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=k>struct</span> <span class=n>tnode</span> <span class=o>*</span><span class=p>)</span><span class=nf>malloc</span><span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=k>struct</span> <span class=n>tnode</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=o>*</span><span class=nf>Strdup</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>s</span><span class=p>)</span> <span class=cm>/* make a duplicate of s */</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=nf>malloc</span><span class=p>(</span><span class=nf>strlen</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span> <span class=cm>/* +1 for &#39;\0&#39; */</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>p</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nf>strcpy</span><span class=p>(</span><span class=n>p</span><span class=p>,</span> <span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* addtree: add a node with w, at or below p */</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=n>tnode</span> <span class=o>*</span><span class=nf>addtree</span><span class=p>(</span><span class=k>struct</span> <span class=n>tnode</span> <span class=o>*</span><span class=n>p</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>w</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>cond</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>p</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>                 <span class=cm>/* a new word has arrived */</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span> <span class=o>=</span> <span class=nf>talloc</span><span class=p>();</span> <span class=cm>/* make a new node */</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span><span class=o>-&gt;</span><span class=n>word</span> <span class=o>=</span> <span class=nf>Strdup</span><span class=p>(</span><span class=n>w</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span><span class=o>-&gt;</span><span class=n>count</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span><span class=o>-&gt;</span><span class=n>left</span> <span class=o>=</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>right</span> <span class=o>=</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>((</span><span class=n>cond</span> <span class=o>=</span> <span class=nf>strcmp</span><span class=p>(</span><span class=n>w</span><span class=p>,</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>word</span><span class=p>))</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span><span class=o>-&gt;</span><span class=n>count</span><span class=o>++</span><span class=p>;</span>    <span class=cm>/* repeated word */</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>cond</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=cm>/* less than into left subtree */</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span><span class=o>-&gt;</span><span class=n>left</span> <span class=o>=</span> <span class=nf>addtree</span><span class=p>(</span><span class=n>p</span><span class=o>-&gt;</span><span class=n>left</span><span class=p>,</span> <span class=n>w</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=cm>/* greater than into right subtree */</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span><span class=o>-&gt;</span><span class=n>right</span> <span class=o>=</span> <span class=nf>addtree</span><span class=p>(</span><span class=n>p</span><span class=o>-&gt;</span><span class=n>right</span><span class=p>,</span> <span class=n>w</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* treeprint: in-order print of tree p */</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>treeprint</span><span class=p>(</span><span class=k>struct</span> <span class=n>tnode</span> <span class=o>*</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>p</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>treeprint</span><span class=p>(</span><span class=n>p</span><span class=o>-&gt;</span><span class=n>left</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%4d %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>count</span><span class=p>,</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>word</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>treeprint</span><span class=p>(</span><span class=n>p</span><span class=o>-&gt;</span><span class=n>right</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>binsearch</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>word</span><span class=p>,</span> <span class=k>struct</span> <span class=n>key</span> <span class=n>tab</span><span class=p>[],</span> <span class=kt>int</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>cond</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>low</span><span class=p>,</span> <span class=n>high</span><span class=p>,</span> <span class=n>mid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>low</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>high</span> <span class=o>=</span> <span class=n>n</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=n>low</span> <span class=o>&lt;=</span> <span class=n>high</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>mid</span> <span class=o>=</span> <span class=p>(</span><span class=n>low</span> <span class=o>+</span> <span class=n>high</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>((</span><span class=n>cond</span> <span class=o>=</span> <span class=nf>strcmp</span><span class=p>(</span><span class=n>word</span><span class=p>,</span> <span class=n>tab</span><span class=p>[</span><span class=n>mid</span><span class=p>].</span><span class=n>word</span><span class=p>))</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>high</span> <span class=o>=</span> <span class=n>mid</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>cond</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>low</span> <span class=o>=</span> <span class=n>mid</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>mid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>getword</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>word</span><span class=p>,</span> <span class=kt>int</span> <span class=n>lim</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>c</span><span class=p>,</span> <span class=n>d</span><span class=p>,</span> <span class=n>inComment</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>inString</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>isPreprocessor</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>isUnderscore</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=c1>// 分别表示是否在注释、字符串、预处理指令、下划线中
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>char</span> <span class=o>*</span><span class=n>w</span> <span class=o>=</span> <span class=n>word</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=nf>isspace</span><span class=p>(</span><span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>        <span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>!=</span> <span class=n>EOF</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=n>w</span><span class=o>++</span> <span class=o>=</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>type</span> <span class=o>=</span> <span class=n>NORMAL</span><span class=p>;</span> <span class=c1>// 默认为普通字符
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;&#34;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>inString</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;/&#39;</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>d</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>())</span> <span class=o>==</span> <span class=sc>&#39;*&#39;</span><span class=p>)</span> <span class=c1>// 注释
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=n>w</span><span class=o>++</span> <span class=o>=</span> <span class=n>d</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>inComment</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;#&#39;</span><span class=p>)</span> <span class=c1>// 预处理指令
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>isPreprocessor</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;_&#39;</span><span class=p>)</span> <span class=c1>// 下划线
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>isUnderscore</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nf>isalpha</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=n>c</span> <span class=o>!=</span> <span class=sc>&#39;_&#39;</span><span class=p>)</span> <span class=c1>// 不合法字符
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=n>w</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(;</span> <span class=o>--</span><span class=n>lim</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>;</span> <span class=n>w</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>inString</span><span class=p>)</span> <span class=c1>// 如果在字符串中，直到遇到双引号才结束
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>((</span><span class=o>*</span><span class=n>w</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>())</span> <span class=o>==</span> <span class=sc>&#39;&#34;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>w</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>type</span> <span class=o>=</span> <span class=n>STRING</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>inComment</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>((</span><span class=o>*</span><span class=n>w</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>())</span> <span class=o>==</span> <span class=sc>&#39;*&#39;</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>d</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>())</span> <span class=o>==</span> <span class=sc>&#39;/&#39;</span><span class=p>)</span> <span class=c1>// 注释结束
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>w</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=o>*</span><span class=n>w</span><span class=o>++</span> <span class=o>=</span> <span class=n>d</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>type</span> <span class=o>=</span> <span class=n>COMMENT</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>isPreprocessor</span><span class=p>)</span> <span class=c1>// 如果在预处理指令中，直到遇到空格才结束
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nf>isspace</span><span class=p>(</span><span class=o>*</span><span class=n>w</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>type</span> <span class=o>=</span> <span class=n>PREPROCESSOR</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>isUnderscore</span><span class=p>)</span> <span class=c1>// 如果在下划线中，直到遇到空格才结束
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nf>isspace</span><span class=p>(</span><span class=o>*</span><span class=n>w</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>type</span> <span class=o>=</span> <span class=n>UNDERSCORE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nf>isalnum</span><span class=p>(</span><span class=o>*</span><span class=n>w</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>())</span> <span class=o>&amp;&amp;</span> <span class=o>*</span><span class=n>w</span> <span class=o>!=</span> <span class=sc>&#39;_&#39;</span><span class=p>)</span> <span class=c1>// 如果不是字母或下划线，结束
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>ungetch</span><span class=p>(</span><span class=o>*</span><span class=n>w</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>w</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>word</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>is_variable</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>word</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nf>binsearch</span><span class=p>(</span><span class=n>word</span><span class=p>,</span> <span class=n>keytab</span><span class=p>,</span> <span class=n>NKEYS</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>groupprint</span><span class=p>(</span><span class=k>struct</span> <span class=n>tnode</span> <span class=o>*</span><span class=n>p</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>prefix</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>p</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>groupprint</span><span class=p>(</span><span class=n>p</span><span class=o>-&gt;</span><span class=n>left</span><span class=p>,</span> <span class=n>prefix</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nf>strncmp</span><span class=p>(</span><span class=n>p</span><span class=o>-&gt;</span><span class=n>word</span><span class=p>,</span> <span class=n>prefix</span><span class=p>,</span> <span class=n>group_length</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%4d %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>count</span><span class=p>,</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>word</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nf>groupprint</span><span class=p>(</span><span class=n>p</span><span class=o>-&gt;</span><span class=n>right</span><span class=p>,</span> <span class=n>prefix</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>print_groups</span><span class=p>(</span><span class=k>struct</span> <span class=n>tnode</span> <span class=o>*</span><span class=n>root</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>root</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>current_prefix</span><span class=p>[</span><span class=n>MAXWORD</span><span class=p>]</span> <span class=o>=</span> <span class=s>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=n>tnode</span> <span class=o>*</span><span class=n>current</span> <span class=o>=</span> <span class=n>root</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=n>current</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>strncpy</span><span class=p>(</span><span class=n>current_prefix</span><span class=p>,</span> <span class=n>current</span><span class=o>-&gt;</span><span class=n>word</span><span class=p>,</span> <span class=n>group_length</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>current_prefix</span><span class=p>[</span><span class=n>group_length</span><span class=p>]</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Group: %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>current_prefix</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>groupprint</span><span class=p>(</span><span class=n>root</span><span class=p>,</span> <span class=n>current_prefix</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>current</span> <span class=o>=</span> <span class=n>current</span><span class=o>-&gt;</span><span class=n>right</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[])</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>argc</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>group_length</span> <span class=o>=</span> <span class=nf>atoi</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=n>tnode</span> <span class=o>*</span><span class=n>root</span> <span class=o>=</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>word</span><span class=p>[</span><span class=n>MAXWORD</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=nf>getword</span><span class=p>(</span><span class=n>word</span><span class=p>,</span> <span class=n>MAXWORD</span><span class=p>)</span> <span class=o>!=</span> <span class=n>EOF</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>type</span> <span class=o>==</span> <span class=n>NORMAL</span> <span class=o>&amp;&amp;</span> <span class=nf>isalpha</span><span class=p>(</span><span class=n>word</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=nf>is_variable</span><span class=p>(</span><span class=n>word</span><span class=p>))</span>        
</span></span><span class=line><span class=cl>            <span class=n>root</span> <span class=o>=</span> <span class=nf>addtree</span><span class=p>(</span><span class=n>root</span><span class=p>,</span> <span class=n>word</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>print_groups</span><span class=p>(</span><span class=n>root</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>➜  ch06 git:<span class=o>(</span>main<span class=o>)</span> ./Exercise6-2 <span class=m>5</span>
</span></span><span class=line><span class=cl><span class=c1>#include &lt;stdio.h&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>int main<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    int <span class=nv>varOne</span> <span class=o>=</span> 1<span class=p>;</span>
</span></span><span class=line><span class=cl>    int <span class=nv>varTwo</span> <span class=o>=</span> 2<span class=p>;</span>
</span></span><span class=line><span class=cl>    int <span class=nv>varThree</span> <span class=o>=</span> 3<span class=p>;</span>
</span></span><span class=line><span class=cl>    float <span class=nv>varOneMore</span> <span class=o>=</span> 4.0<span class=p>;</span>
</span></span><span class=line><span class=cl>    char <span class=nv>varTwoMore</span> <span class=o>=</span> <span class=s1>&#39;a&#39;</span><span class=p>;</span> // This is a comment
</span></span><span class=line><span class=cl>    /* This is a block comment
</span></span><span class=line><span class=cl>       int <span class=nv>varFour</span> <span class=o>=</span> 4<span class=p>;</span> */
</span></span><span class=line><span class=cl>    <span class=k>return</span> 0<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>Group: stdio
</span></span><span class=line><span class=cl>   <span class=m>1</span> stdio
</span></span><span class=line><span class=cl>Group: varOn
</span></span><span class=line><span class=cl>   <span class=m>1</span> varOne
</span></span><span class=line><span class=cl>   <span class=m>1</span> varOneMore
</span></span><span class=line><span class=cl>Group: varTw
</span></span><span class=line><span class=cl>   <span class=m>1</span> varTwo
</span></span><span class=line><span class=cl>   <span class=m>1</span> varTwoMore
</span></span><span class=line><span class=cl>Group: varTw
</span></span><span class=line><span class=cl>   <span class=m>1</span> varTwo
</span></span><span class=line><span class=cl>   <span class=m>1</span> varTwoMore
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise6-3>exercise6-3<a hidden class=anchor aria-hidden=true href=#exercise6-3>#</a></h2><blockquote><p>编写一个交叉引用程序，打印文档中所有单词的列表，并且每个单词还有一个列表，记录出现过该单词的行号。对 the、and 等非实义单词不予考虑。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>struct</span> <span class=n>tnode</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>word</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>lines</span><span class=p>[</span><span class=n>MAXLINES</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>line_count</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=n>tnode</span> <span class=o>*</span><span class=n>left</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=n>tnode</span> <span class=o>*</span><span class=n>right</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>line_number</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=n>tnode</span> <span class=o>*</span><span class=nf>talloc</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=k>struct</span> <span class=n>tnode</span> <span class=o>*</span><span class=p>)</span><span class=nf>malloc</span><span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=k>struct</span> <span class=n>tnode</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=o>*</span><span class=nf>strdup</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>p</span> <span class=o>=</span> <span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=nf>malloc</span><span class=p>(</span><span class=nf>strlen</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>p</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nf>strcpy</span><span class=p>(</span><span class=n>p</span><span class=p>,</span> <span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=n>tnode</span> <span class=o>*</span><span class=nf>addtree</span><span class=p>(</span><span class=k>struct</span> <span class=n>tnode</span> <span class=o>*</span><span class=n>p</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>w</span><span class=p>,</span> <span class=kt>int</span> <span class=n>lineno</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>cond</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>p</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span> <span class=o>=</span> <span class=nf>talloc</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span><span class=o>-&gt;</span><span class=n>word</span> <span class=o>=</span> <span class=nf>strdup</span><span class=p>(</span><span class=n>w</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span><span class=o>-&gt;</span><span class=n>lines</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>lineno</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span><span class=o>-&gt;</span><span class=n>line_count</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span><span class=o>-&gt;</span><span class=n>left</span> <span class=o>=</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>right</span> <span class=o>=</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>((</span><span class=n>cond</span> <span class=o>=</span> <span class=nf>strcmp</span><span class=p>(</span><span class=n>w</span><span class=p>,</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>word</span><span class=p>))</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>p</span><span class=o>-&gt;</span><span class=n>lines</span><span class=p>[</span><span class=n>p</span><span class=o>-&gt;</span><span class=n>line_count</span> <span class=o>-</span> <span class=mi>1</span><span class=p>]</span> <span class=o>!=</span> <span class=n>lineno</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>p</span><span class=o>-&gt;</span><span class=n>lines</span><span class=p>[</span><span class=n>p</span><span class=o>-&gt;</span><span class=n>line_count</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=n>lineno</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>cond</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span><span class=o>-&gt;</span><span class=n>left</span> <span class=o>=</span> <span class=nf>addtree</span><span class=p>(</span><span class=n>p</span><span class=o>-&gt;</span><span class=n>left</span><span class=p>,</span> <span class=n>w</span><span class=p>,</span> <span class=n>lineno</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span><span class=o>-&gt;</span><span class=n>right</span> <span class=o>=</span> <span class=nf>addtree</span><span class=p>(</span><span class=n>p</span><span class=o>-&gt;</span><span class=n>right</span><span class=p>,</span> <span class=n>w</span><span class=p>,</span> <span class=n>lineno</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>treeprint</span><span class=p>(</span><span class=k>struct</span> <span class=n>tnode</span> <span class=o>*</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>p</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>treeprint</span><span class=p>(</span><span class=n>p</span><span class=o>-&gt;</span><span class=n>left</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%s: &#34;</span><span class=p>,</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>word</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>line_count</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%d &#34;</span><span class=p>,</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>lines</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>treeprint</span><span class=p>(</span><span class=n>p</span><span class=o>-&gt;</span><span class=n>right</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>getword</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>word</span><span class=p>,</span> <span class=kt>int</span> <span class=n>lim</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>w</span> <span class=o>=</span> <span class=n>word</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=nf>isspace</span><span class=p>(</span><span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;\n&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>line_number</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>!=</span> <span class=n>EOF</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=n>w</span><span class=o>++</span> <span class=o>=</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nf>isalpha</span><span class=p>(</span><span class=n>c</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=n>w</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(;</span> <span class=o>--</span><span class=n>lim</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>;</span> <span class=n>w</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nf>isalnum</span><span class=p>(</span><span class=o>*</span><span class=n>w</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>ungetch</span><span class=p>(</span><span class=o>*</span><span class=n>w</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>w</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>word</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>is_noise_word</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>word</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=kt>char</span> <span class=o>*</span><span class=n>noise_words</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s>&#34;the&#34;</span><span class=p>,</span> <span class=s>&#34;and&#34;</span><span class=p>,</span> <span class=s>&#34;a&#34;</span><span class=p>,</span> <span class=s>&#34;an&#34;</span><span class=p>,</span> <span class=s>&#34;in&#34;</span><span class=p>,</span> <span class=s>&#34;on&#34;</span><span class=p>,</span> <span class=s>&#34;of&#34;</span><span class=p>,</span> <span class=s>&#34;to&#34;</span><span class=p>,</span> <span class=s>&#34;is&#34;</span><span class=p>,</span> <span class=s>&#34;are&#34;</span><span class=p>,</span> <span class=s>&#34;was&#34;</span><span class=p>,</span> <span class=s>&#34;were&#34;</span><span class=p>,</span> <span class=s>&#34;it&#34;</span><span class=p>,</span> <span class=s>&#34;that&#34;</span><span class=p>,</span> <span class=s>&#34;this&#34;</span><span class=p>,</span> <span class=s>&#34;with&#34;</span><span class=p>,</span> <span class=s>&#34;as&#34;</span><span class=p>,</span> <span class=s>&#34;for&#34;</span><span class=p>,</span> <span class=s>&#34;by&#34;</span><span class=p>,</span> <span class=s>&#34;at&#34;</span><span class=p>,</span> <span class=s>&#34;from&#34;</span><span class=p>,</span> <span class=s>&#34;but&#34;</span><span class=p>,</span> <span class=s>&#34;or&#34;</span><span class=p>,</span> <span class=s>&#34;not&#34;</span><span class=p>,</span> <span class=s>&#34;be&#34;</span><span class=p>,</span> <span class=s>&#34;have&#34;</span><span class=p>,</span> <span class=s>&#34;has&#34;</span><span class=p>,</span> <span class=s>&#34;had&#34;</span><span class=p>,</span> <span class=s>&#34;do&#34;</span><span class=p>,</span> <span class=s>&#34;does&#34;</span><span class=p>,</span> <span class=s>&#34;did&#34;</span><span class=p>,</span> <span class=s>&#34;will&#34;</span><span class=p>,</span> <span class=s>&#34;would&#34;</span><span class=p>,</span> <span class=s>&#34;can&#34;</span><span class=p>,</span> <span class=s>&#34;could&#34;</span><span class=p>,</span> <span class=s>&#34;should&#34;</span><span class=p>,</span> <span class=s>&#34;shall&#34;</span><span class=p>,</span> <span class=s>&#34;may&#34;</span><span class=p>,</span> <span class=s>&#34;might&#34;</span><span class=p>,</span> <span class=s>&#34;must&#34;</span><span class=p>,</span> <span class=s>&#34;if&#34;</span><span class=p>,</span> <span class=s>&#34;then&#34;</span><span class=p>,</span> <span class=s>&#34;else&#34;</span><span class=p>,</span> <span class=s>&#34;when&#34;</span><span class=p>,</span> <span class=s>&#34;where&#34;</span><span class=p>,</span> <span class=s>&#34;which&#34;</span><span class=p>,</span> <span class=s>&#34;who&#34;</span><span class=p>,</span> <span class=s>&#34;whom&#34;</span><span class=p>,</span> <span class=s>&#34;whose&#34;</span><span class=p>,</span> <span class=s>&#34;why&#34;</span><span class=p>,</span> <span class=s>&#34;how&#34;</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>char</span> <span class=o>**</span><span class=n>p</span> <span class=o>=</span> <span class=n>noise_words</span><span class=p>;</span> <span class=o>*</span><span class=n>p</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>;</span> <span class=n>p</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nf>strcmp</span><span class=p>(</span><span class=n>word</span><span class=p>,</span> <span class=o>*</span><span class=n>p</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=n>tnode</span> <span class=o>*</span><span class=n>root</span> <span class=o>=</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>word</span><span class=p>[</span><span class=n>MAXWORD</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=nf>getword</span><span class=p>(</span><span class=n>word</span><span class=p>,</span> <span class=n>MAXWORD</span><span class=p>)</span> <span class=o>!=</span> <span class=n>EOF</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nf>isalpha</span><span class=p>(</span><span class=n>word</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nf>is_noise_word</span><span class=p>(</span><span class=n>word</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=n>root</span> <span class=o>=</span> <span class=nf>addtree</span><span class=p>(</span><span class=n>root</span><span class=p>,</span> <span class=n>word</span><span class=p>,</span> <span class=n>line_number</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>treeprint</span><span class=p>(</span><span class=n>root</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>➜  ch06 git:<span class=o>(</span>main<span class=o>)</span> ./Exercise6-3 &lt; test.txt 
</span></span><span class=line><span class=cl>AFAIK: <span class=m>3</span> 
</span></span><span class=line><span class=cl>Cassandra: <span class=m>1</span> <span class=m>4</span> 
</span></span><span class=line><span class=cl>Hopefully: <span class=m>5</span> 
</span></span><span class=line><span class=cl>It: <span class=m>1</span> 
</span></span><span class=line><span class=cl>So: <span class=m>3</span> 
</span></span><span class=line><span class=cl>This: <span class=m>4</span> 
</span></span><span class=line><span class=cl>To: <span class=m>2</span> 
</span></span><span class=line><span class=cl>UK: <span class=m>2</span> 
</span></span><span class=line><span class=cl>Well: <span class=m>3</span> 
</span></span><span class=line><span class=cl>What: <span class=m>5</span> 
</span></span><span class=line><span class=cl>about: <span class=m>4</span> 
</span></span><span class=line><span class=cl>according: <span class=m>5</span> 
</span></span><span class=line><span class=cl>account: <span class=m>1</span> 
</span></span><span class=line><span class=cl>accounts: <span class=m>2</span> 
</span></span><span class=line><span class=cl>all: <span class=m>3</span> 
</span></span><span class=line><span class=cl>always: <span class=m>3</span> 
</span></span><span class=line><span class=cl>approximately: <span class=m>4</span> 
</span></span><span class=line><span class=cl>been: <span class=m>3</span> 
</span></span><span class=line><span class=cl>best: <span class=m>4</span> <span class=m>5</span> 
</span></span><span class=line><span class=cl>better: <span class=m>1</span> 
</span></span><span class=line><span class=cl>calls: <span class=m>3</span> 
</span></span><span class=line><span class=cl>cardinality: <span class=m>5</span> 
</span></span><span class=line><span class=cl><span class=k>case</span>: <span class=m>4</span> <span class=m>5</span> 
</span></span><span class=line><span class=cl>cases: <span class=m>5</span> 
</span></span><span class=line><span class=cl>client: <span class=m>1</span> 
</span></span><span class=line><span class=cl>conclusion: <span class=m>4</span> 
</span></span><span class=line><span class=cl>country: <span class=m>2</span> 
</span></span><span class=line><span class=cl>e: <span class=m>4</span> 
</span></span><span class=line><span class=cl>each: <span class=m>2</span> 
</span></span><span class=line><span class=cl>enough: <span class=m>3</span> 
</span></span><span class=line><span class=cl>equal: <span class=m>4</span> 
</span></span><span class=line><span class=cl>even: <span class=m>1</span> <span class=m>5</span> 
</span></span><span class=line><span class=cl>every: <span class=m>2</span> <span class=m>3</span> 
</span></span><span class=line><span class=cl>expected: <span class=m>1</span> 
</span></span><span class=line><span class=cl>fine: <span class=m>5</span> 
</span></span><span class=line><span class=cl>finer: <span class=m>5</span> 
</span></span><span class=line><span class=cl>found: <span class=m>2</span> <span class=m>3</span> 
</span></span><span class=line><span class=cl>good: <span class=m>1</span> 
</span></span><span class=line><span class=cl>i: <span class=m>4</span> 
</span></span><span class=line><span class=cl>importance: <span class=m>1</span> 
</span></span><span class=line><span class=cl>index: <span class=m>2</span> <span class=m>5</span> 
</span></span><span class=line><span class=cl>indexed: <span class=m>5</span> 
</span></span><span class=line><span class=cl>indexes: <span class=m>4</span> 
</span></span><span class=line><span class=cl>into: <span class=m>1</span> 
</span></span><span class=line><span class=cl>leads: <span class=m>4</span> 
</span></span><span class=line><span class=cl>looks: <span class=m>2</span> 
</span></span><span class=line><span class=cl>lookup: <span class=m>2</span> 
</span></span><span class=line><span class=cl>low: <span class=m>5</span> 
</span></span><span class=line><span class=cl>n: <span class=m>4</span> 
</span></span><span class=line><span class=cl>narrow: <span class=m>5</span> 
</span></span><span class=line><span class=cl>node: <span class=m>2</span> <span class=m>3</span> 
</span></span><span class=line><span class=cl>nodes: <span class=m>3</span> <span class=m>4</span> 
</span></span><span class=line><span class=cl>number: <span class=m>1</span> <span class=m>4</span> <span class=m>5</span> 
</span></span><span class=line><span class=cl>other: <span class=m>5</span> 
</span></span><span class=line><span class=cl>p: <span class=m>4</span> 
</span></span><span class=line><span class=cl>partition: <span class=m>2</span> 
</span></span><span class=line><span class=cl>partitions: <span class=m>4</span> 
</span></span><span class=line><span class=cl>perform: <span class=m>2</span> 
</span></span><span class=line><span class=cl>queried: <span class=m>2</span> <span class=m>3</span> 
</span></span><span class=line><span class=cl>quite: <span class=m>1</span> 
</span></span><span class=line><span class=cl>requested: <span class=m>1</span> <span class=m>5</span> 
</span></span><span class=line><span class=cl>resulting: <span class=m>5</span> 
</span></span><span class=line><span class=cl>rows: <span class=m>1</span> <span class=m>3</span> <span class=m>5</span> 
</span></span><span class=line><span class=cl>s: <span class=m>1</span> <span class=m>4</span> 
</span></span><span class=line><span class=cl>secondary: <span class=m>4</span> 
</span></span><span class=line><span class=cl>seconday: <span class=m>5</span> 
</span></span><span class=line><span class=cl>sets: <span class=m>5</span> 
</span></span><span class=line><span class=cl>stop: <span class=m>3</span> 
</span></span><span class=line><span class=cl>summary: <span class=m>1</span> 
</span></span><span class=line><span class=cl>taking: <span class=m>1</span> 
</span></span><span class=line><span class=cl>there: <span class=m>5</span> 
</span></span><span class=line><span class=cl>up: <span class=m>2</span> 
</span></span><span class=line><span class=cl>use: <span class=m>4</span> <span class=m>5</span> 
</span></span><span class=line><span class=cl>user: <span class=m>2</span> 
</span></span><span class=line><span class=cl>values: <span class=m>5</span> 
</span></span><span class=line><span class=cl>vs: <span class=m>5</span> 
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise6-4>exercise6-4<a hidden class=anchor aria-hidden=true href=#exercise6-4>#</a></h2><blockquote><p>编写一个程序，根据单词的出现频率按降序打印输入的各个不同单词，并在每个单词的前面标上它的出现次数。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// 将树转换为列表
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>treeToList</span><span class=p>(</span><span class=k>struct</span> <span class=n>tnode</span> <span class=o>*</span><span class=n>p</span><span class=p>,</span> <span class=k>struct</span> <span class=n>wordinfo</span> <span class=n>list</span><span class=p>[])</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>p</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>treeToList</span><span class=p>(</span><span class=n>p</span><span class=o>-&gt;</span><span class=n>left</span><span class=p>,</span> <span class=n>list</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>list</span><span class=p>[</span><span class=n>counter</span><span class=p>].</span><span class=n>word</span> <span class=o>=</span> <span class=nf>strdup</span><span class=p>(</span><span class=n>p</span><span class=o>-&gt;</span><span class=n>word</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>list</span><span class=p>[</span><span class=n>counter</span><span class=p>].</span><span class=n>count</span> <span class=o>=</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>count</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>counter</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nf>treeToList</span><span class=p>(</span><span class=n>p</span><span class=o>-&gt;</span><span class=n>right</span><span class=p>,</span> <span class=n>list</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 打印列表
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>listprint</span><span class=p>(</span><span class=k>struct</span> <span class=n>wordinfo</span> <span class=n>list</span><span class=p>[])</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>wordCount</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%4d %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>list</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>count</span><span class=p>,</span> <span class=n>list</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>word</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 交换两个元素
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>swap</span><span class=p>(</span><span class=k>struct</span> <span class=n>wordinfo</span> <span class=n>list</span><span class=p>[],</span> <span class=kt>int</span> <span class=n>i</span><span class=p>,</span> <span class=kt>int</span> <span class=n>j</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=n>wordinfo</span> <span class=n>temp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>temp</span> <span class=o>=</span> <span class=n>list</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>list</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>list</span><span class=p>[</span><span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>list</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>temp</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 根据单词出现的频率来进行快速排序
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>mqsort</span><span class=p>(</span><span class=k>struct</span> <span class=n>wordinfo</span> <span class=n>list</span><span class=p>[],</span> <span class=kt>int</span> <span class=n>left</span><span class=p>,</span> <span class=kt>int</span> <span class=n>right</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span><span class=p>,</span> <span class=n>last</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>left</span> <span class=o>&gt;=</span> <span class=n>right</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>swap</span><span class=p>(</span><span class=n>list</span><span class=p>,</span> <span class=n>left</span><span class=p>,</span> <span class=p>(</span><span class=n>left</span> <span class=o>+</span> <span class=n>right</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>last</span> <span class=o>=</span> <span class=n>left</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=n>left</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>right</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>list</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>count</span> <span class=o>&gt;</span> <span class=n>list</span><span class=p>[</span><span class=n>left</span><span class=p>].</span><span class=n>count</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nf>swap</span><span class=p>(</span><span class=n>list</span><span class=p>,</span> <span class=o>++</span><span class=n>last</span><span class=p>,</span> <span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>swap</span><span class=p>(</span><span class=n>list</span><span class=p>,</span> <span class=n>left</span><span class=p>,</span> <span class=n>last</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>mqsort</span><span class=p>(</span><span class=n>list</span><span class=p>,</span> <span class=n>left</span><span class=p>,</span> <span class=n>last</span> <span class=o>-</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>mqsort</span><span class=p>(</span><span class=n>list</span><span class=p>,</span> <span class=n>last</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>right</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=n>tnode</span> <span class=o>*</span><span class=n>root</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>word</span><span class=p>[</span><span class=n>MAXWORD</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>root</span> <span class=o>=</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=nf>getword</span><span class=p>(</span><span class=n>word</span><span class=p>,</span> <span class=n>MAXWORD</span><span class=p>)</span> <span class=o>!=</span> <span class=n>EOF</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nf>isalpha</span><span class=p>(</span><span class=n>word</span><span class=p>[</span><span class=mi>0</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>            <span class=n>root</span> <span class=o>=</span> <span class=nf>addtree</span><span class=p>(</span><span class=n>root</span><span class=p>,</span> <span class=n>word</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Count of words is %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>wordCount</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=n>wordinfo</span> <span class=n>list</span><span class=p>[</span><span class=n>wordCount</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nf>treeToList</span><span class=p>(</span><span class=n>root</span><span class=p>,</span> <span class=n>list</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>mqsort</span><span class=p>(</span><span class=n>list</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>wordCount</span> <span class=o>-</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>listprint</span><span class=p>(</span><span class=n>list</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span><span class=lnt>94
</span><span class=lnt>95
</span><span class=lnt>96
</span><span class=lnt>97
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>➜  ch06 git:<span class=o>(</span>main<span class=o>)</span> ./Exercise6-4 &lt; test.txt
</span></span><span class=line><span class=cl>Count of words is <span class=m>95</span>
</span></span><span class=line><span class=cl>  <span class=m>12</span> the
</span></span><span class=line><span class=cl>   <span class=m>6</span> of
</span></span><span class=line><span class=cl>   <span class=m>6</span> is
</span></span><span class=line><span class=cl>   <span class=m>4</span> number
</span></span><span class=line><span class=cl>   <span class=m>3</span> queried
</span></span><span class=line><span class=cl>   <span class=m>3</span> rows
</span></span><span class=line><span class=cl>   <span class=m>3</span> are
</span></span><span class=line><span class=cl>   <span class=m>3</span> node
</span></span><span class=line><span class=cl>   <span class=m>3</span> to
</span></span><span class=line><span class=cl>   <span class=m>3</span> when
</span></span><span class=line><span class=cl>   <span class=m>3</span> use
</span></span><span class=line><span class=cl>   <span class=m>2</span> index
</span></span><span class=line><span class=cl>   <span class=m>2</span> found
</span></span><span class=line><span class=cl>   <span class=m>2</span> have
</span></span><span class=line><span class=cl>   <span class=m>2</span> Cassandra
</span></span><span class=line><span class=cl>   <span class=m>2</span> looks
</span></span><span class=line><span class=cl>   <span class=m>2</span> cardinality
</span></span><span class=line><span class=cl>   <span class=m>2</span> nodes
</span></span><span class=line><span class=cl>   <span class=m>2</span> even
</span></span><span class=line><span class=cl>   <span class=m>2</span> not
</span></span><span class=line><span class=cl>   <span class=m>2</span> <span class=k>for</span>
</span></span><span class=line><span class=cl>   <span class=m>2</span> partition
</span></span><span class=line><span class=cl>   <span class=m>2</span> best
</span></span><span class=line><span class=cl>   <span class=m>2</span> requested
</span></span><span class=line><span class=cl>   <span class=m>2</span> every
</span></span><span class=line><span class=cl>   <span class=m>2</span> s
</span></span><span class=line><span class=cl>   <span class=m>2</span> <span class=k>case</span>
</span></span><span class=line><span class=cl>   <span class=m>2</span> that
</span></span><span class=line><span class=cl>   <span class=m>2</span> a
</span></span><span class=line><span class=cl>   <span class=m>2</span> up
</span></span><span class=line><span class=cl>   <span class=m>1</span> leads
</span></span><span class=line><span class=cl>   <span class=m>1</span> So
</span></span><span class=line><span class=cl>   <span class=m>1</span> This
</span></span><span class=line><span class=cl>   <span class=m>1</span> e
</span></span><span class=line><span class=cl>   <span class=m>1</span> or
</span></span><span class=line><span class=cl>   <span class=m>1</span> enough
</span></span><span class=line><span class=cl>   <span class=m>1</span> other
</span></span><span class=line><span class=cl>   <span class=m>1</span> and
</span></span><span class=line><span class=cl>   <span class=m>1</span> p
</span></span><span class=line><span class=cl>   <span class=m>1</span> expected
</span></span><span class=line><span class=cl>   <span class=m>1</span> calls
</span></span><span class=line><span class=cl>   <span class=m>1</span> finer
</span></span><span class=line><span class=cl>   <span class=m>1</span> partitions
</span></span><span class=line><span class=cl>   <span class=m>1</span> been
</span></span><span class=line><span class=cl>   <span class=m>1</span> perform
</span></span><span class=line><span class=cl>   <span class=m>1</span> accounts
</span></span><span class=line><span class=cl>   <span class=m>1</span> To
</span></span><span class=line><span class=cl>   <span class=m>1</span> importance
</span></span><span class=line><span class=cl>   <span class=m>1</span> quite
</span></span><span class=line><span class=cl>   <span class=m>1</span> indexed
</span></span><span class=line><span class=cl>   <span class=m>1</span> all
</span></span><span class=line><span class=cl>   <span class=m>1</span> into
</span></span><span class=line><span class=cl>   <span class=m>1</span> resulting
</span></span><span class=line><span class=cl>   <span class=m>1</span> it
</span></span><span class=line><span class=cl>   <span class=m>1</span> UK
</span></span><span class=line><span class=cl>   <span class=m>1</span> better
</span></span><span class=line><span class=cl>   <span class=m>1</span> always
</span></span><span class=line><span class=cl>   <span class=m>1</span> low
</span></span><span class=line><span class=cl>   <span class=m>1</span> secondary
</span></span><span class=line><span class=cl>   <span class=m>1</span> narrow
</span></span><span class=line><span class=cl>   <span class=m>1</span> seconday
</span></span><span class=line><span class=cl>   <span class=m>1</span> but
</span></span><span class=line><span class=cl>   <span class=m>1</span> sets
</span></span><span class=line><span class=cl>   <span class=m>1</span> country
</span></span><span class=line><span class=cl>   <span class=m>1</span> stop
</span></span><span class=line><span class=cl>   <span class=m>1</span> equal
</span></span><span class=line><span class=cl>   <span class=m>1</span> summary
</span></span><span class=line><span class=cl>   <span class=m>1</span> fine
</span></span><span class=line><span class=cl>   <span class=m>1</span> taking
</span></span><span class=line><span class=cl>   <span class=m>1</span> good
</span></span><span class=line><span class=cl>   <span class=m>1</span> cases
</span></span><span class=line><span class=cl>   <span class=m>1</span> AFAIK
</span></span><span class=line><span class=cl>   <span class=m>1</span> Well
</span></span><span class=line><span class=cl>   <span class=m>1</span> Hopefully
</span></span><span class=line><span class=cl>   <span class=m>1</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>   <span class=m>1</span> lookup
</span></span><span class=line><span class=cl>   <span class=m>1</span> there
</span></span><span class=line><span class=cl>   <span class=m>1</span> It
</span></span><span class=line><span class=cl>   <span class=m>1</span> What
</span></span><span class=line><span class=cl>   <span class=m>1</span> each
</span></span><span class=line><span class=cl>   <span class=m>1</span> client
</span></span><span class=line><span class=cl>   <span class=m>1</span> account
</span></span><span class=line><span class=cl>   <span class=m>1</span> conclusion
</span></span><span class=line><span class=cl>   <span class=m>1</span> indexes
</span></span><span class=line><span class=cl>   <span class=m>1</span> user
</span></span><span class=line><span class=cl>   <span class=m>1</span> n
</span></span><span class=line><span class=cl>   <span class=m>1</span> values
</span></span><span class=line><span class=cl>   <span class=m>1</span> approximately
</span></span><span class=line><span class=cl>   <span class=m>1</span> vs
</span></span><span class=line><span class=cl>   <span class=m>1</span> according
</span></span><span class=line><span class=cl>   <span class=m>1</span> about
</span></span><span class=line><span class=cl>   <span class=m>1</span> i
</span></span><span class=line><span class=cl>   <span class=m>1</span> where
</span></span><span class=line><span class=cl>   <span class=m>1</span> by
</span></span><span class=line><span class=cl>   <span class=m>1</span> would
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise6-5>exercise6-5<a hidden class=anchor aria-hidden=true href=#exercise6-5>#</a></h2><blockquote><p>编写函数 undef，它将从由 lookup 和 install 维护的表中删除一个变量及其定义。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cm>/* undef: remove a name and its definition from the hashtab */</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>undef</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=n>nlist</span> <span class=o>*</span><span class=n>np</span><span class=p>,</span> <span class=o>*</span><span class=n>prev</span> <span class=o>=</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>unsigned</span> <span class=n>hashval</span> <span class=o>=</span> <span class=nf>hash</span><span class=p>(</span><span class=n>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>np</span> <span class=o>=</span> <span class=n>hashtab</span><span class=p>[</span><span class=n>hashval</span><span class=p>];</span> <span class=n>np</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>;</span> <span class=n>prev</span> <span class=o>=</span> <span class=n>np</span><span class=p>,</span> <span class=n>np</span> <span class=o>=</span> <span class=n>np</span><span class=o>-&gt;</span><span class=n>next</span><span class=p>)</span>   <span class=c1>// 遍历链表
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nf>strcmp</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>np</span><span class=o>-&gt;</span><span class=n>name</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>    
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>prev</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>hashtab</span><span class=p>[</span><span class=n>hashval</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>-&gt;</span><span class=n>next</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span>
</span></span><span class=line><span class=cl>                <span class=n>prev</span><span class=o>-&gt;</span><span class=n>next</span> <span class=o>=</span> <span class=n>np</span><span class=o>-&gt;</span><span class=n>next</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nf>free</span><span class=p>(</span><span class=n>np</span><span class=o>-&gt;</span><span class=n>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>free</span><span class=p>(</span><span class=n>np</span><span class=o>-&gt;</span><span class=n>defn</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>free</span><span class=p>(</span><span class=n>np</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=n>nlist</span> <span class=o>*</span><span class=n>np</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;test install </span><span class=se>\&#34;</span><span class=s>MAXLINE</span><span class=se>\&#34;</span><span class=s>  </span><span class=se>\&#34;</span><span class=s>BUFSIZE</span><span class=se>\&#34;</span><span class=s>:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>install</span><span class=p>(</span><span class=s>&#34;MAXLINE&#34;</span><span class=p>,</span> <span class=s>&#34;1000&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>install</span><span class=p>(</span><span class=s>&#34;BUFSIZE&#34;</span><span class=p>,</span> <span class=s>&#34;100&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>np</span> <span class=o>=</span> <span class=nf>lookup</span><span class=p>(</span><span class=s>&#34;MAXLINE&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>np</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;install failed</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> 
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;defination of </span><span class=se>\&#34;</span><span class=s>MAXLINE</span><span class=se>\&#34;</span><span class=s> is: %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>np</span><span class=o>-&gt;</span><span class=n>defn</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;install success</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\n</span><span class=s>test undef </span><span class=se>\&#34;</span><span class=s>BUFSIZE</span><span class=se>\&#34;</span><span class=s>:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>undef</span><span class=p>(</span><span class=s>&#34;BUFSIZE&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>np</span> <span class=o>=</span> <span class=nf>lookup</span><span class=p>(</span><span class=s>&#34;BUFSIZE&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>np</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;can not find defination of </span><span class=se>\&#34;</span><span class=s>BUFSIZE</span><span class=se>\&#34;\n</span><span class=s>undef success</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>➜  ch06 git:<span class=o>(</span>main<span class=o>)</span> ✗ ./Exercise6-5   
</span></span><span class=line><span class=cl><span class=nb>test</span> install <span class=s2>&#34;MAXLINE&#34;</span>  <span class=s2>&#34;BUFSIZE&#34;</span>:
</span></span><span class=line><span class=cl>defination of <span class=s2>&#34;MAXLINE&#34;</span> is: <span class=m>1000</span>
</span></span><span class=line><span class=cl>install success
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>test</span> undef <span class=s2>&#34;BUFSIZE&#34;</span>:
</span></span><span class=line><span class=cl>can not find defination of <span class=s2>&#34;BUFSIZE&#34;</span>
</span></span><span class=line><span class=cl>undef success
</span></span></code></pre></td></tr></table></div></div><h2 id=exercise6-6>exercise6-6<a hidden class=anchor aria-hidden=true href=#exercise6-6>#</a></h2><blockquote><p>以本节介绍的函数为基础，编写一个适合 C 语言程序使用的#define 处理器的简单版本（即无参数的情况）。你会发现 getch 和 ungetch 函数非常有用。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=nf>skipblanks</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>((</span><span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>())</span> <span class=o>==</span> <span class=sc>&#39; &#39;</span> <span class=o>||</span> <span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;\t&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>ungetch</span><span class=p>(</span><span class=n>c</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>getdef</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>c</span><span class=p>,</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>def</span><span class=p>[</span><span class=n>BUFSIZE</span><span class=p>],</span> <span class=n>name</span><span class=p>[</span><span class=n>BUFSIZE</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>skipblanks</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nf>isalpha</span><span class=p>(</span><span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;getdef: invalid macro name</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nf>isalnum</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=o>||</span> <span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;_&#39;</span><span class=p>;</span> <span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=n>name</span><span class=p>[</span><span class=n>i</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>skipblanks</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>!=</span> <span class=sc>&#39; &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;getdef: missing space after macro name</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=p>(</span><span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>())</span> <span class=o>!=</span> <span class=n>EOF</span> <span class=o>&amp;&amp;</span> <span class=n>c</span> <span class=o>!=</span> <span class=sc>&#39;\n&#39;</span><span class=p>;)</span>
</span></span><span class=line><span class=cl>        <span class=n>def</span><span class=p>[</span><span class=n>i</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>def</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>i</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nf>install</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>def</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>procdef</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>((</span><span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>())</span> <span class=o>!=</span> <span class=n>EOF</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=sc>&#39;#&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>char</span> <span class=n>keyword</span><span class=p>[</span><span class=mi>7</span><span class=p>];</span>
</span></span><span class=line><span class=cl>            <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>6</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>c</span> <span class=o>=</span> <span class=nf>getch</span><span class=p>())</span> <span class=o>!=</span> <span class=n>EOF</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>keyword</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>keyword</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nf>strcmp</span><span class=p>(</span><span class=n>keyword</span><span class=p>,</span> <span class=s>&#34;define&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>getdef</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>procdef</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;name            defination</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>HASHSIZE</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>struct</span> <span class=n>nlist</span> <span class=o>*</span><span class=n>np</span> <span class=o>=</span> <span class=n>hashtab</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=p>(</span><span class=n>np</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%-16s%s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>np</span><span class=o>-&gt;</span><span class=n>name</span><span class=p>,</span> <span class=n>np</span><span class=o>-&gt;</span><span class=n>defn</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>np</span> <span class=o>=</span> <span class=n>np</span><span class=o>-&gt;</span><span class=n>next</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>对于<code>test.c</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#define  LISTENQ    1024
</span></span></span><span class=line><span class=cl><span class=cp>#define  MAXLINE    4096
</span></span></span><span class=line><span class=cl><span class=cp>#define  BUFFSIZE  8192
</span></span></span><span class=line><span class=cl><span class=cp>#define  SERV_PORT     9877
</span></span></span><span class=line><span class=cl><span class=cp>#define  AI_PASSIVE     1
</span></span></span><span class=line><span class=cl><span class=cp>#define  AI_CANONNAME   2
</span></span></span><span class=line><span class=cl><span class=cp>#define  NI_MAXHOST    1025
</span></span></span><span class=line><span class=cl><span class=cp>#define  NI_MAXSERV      32
</span></span></span><span class=line><span class=cl><span class=cp>#define  NI_NOFQDN       1
</span></span></span><span class=line><span class=cl><span class=cp>#define  NI_NUMERICHOST   2
</span></span></span><span class=line><span class=cl><span class=cp>#define  NI_NAMEREQD       4
</span></span></span><span class=line><span class=cl><span class=cp>#define  NI_NUMERICSERV   8
</span></span></span><span class=line><span class=cl><span class=cp>#define  NI_DGRAM      16
</span></span></span><span class=line><span class=cl><span class=cp>#define  EAI_ADDRFAMILY   1
</span></span></span><span class=line><span class=cl><span class=cp>#define  EAI_AGAIN     2
</span></span></span><span class=line><span class=cl><span class=cp>#define  EAI_BADFLAGS   3
</span></span></span><span class=line><span class=cl><span class=cp>#define  EAI_FAIL     4
</span></span></span><span class=line><span class=cl><span class=cp>#define  EAI_FAMILY     5
</span></span></span><span class=line><span class=cl><span class=cp>#define  EAI_MEMORY     6
</span></span></span><span class=line><span class=cl><span class=cp>#define  EAI_NODATA     7
</span></span></span><span class=line><span class=cl><span class=cp>#define  EAI_NONAME     8
</span></span></span><span class=line><span class=cl><span class=cp>#define  EAI_SERVICE     9
</span></span></span><span class=line><span class=cl><span class=cp>#define  EAI_SOCKTYPE  10
</span></span></span><span class=line><span class=cl><span class=cp>#define  EAI_SYSTEM    11
</span></span></span></code></pre></td></tr></table></div></div><p>运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>➜  ch06 git:<span class=o>(</span>main<span class=o>)</span> ✗ ./Exercise6-6 &lt; test.c
</span></span><span class=line><span class=cl>name            defination
</span></span><span class=line><span class=cl>AI_CANONNAME    <span class=m>2</span>
</span></span><span class=line><span class=cl>NI_NUMERICHOST  <span class=m>2</span>
</span></span><span class=line><span class=cl>EAI_NONAME      <span class=m>8</span>
</span></span><span class=line><span class=cl>EAI_ADDRFAMILY  <span class=m>1</span>
</span></span><span class=line><span class=cl>NI_NUMERICSERV  <span class=m>8</span>
</span></span><span class=line><span class=cl>AI_PASSIVE      <span class=m>1</span>
</span></span><span class=line><span class=cl>EAI_SERVICE     <span class=m>9</span>
</span></span><span class=line><span class=cl>SERV_PORT       <span class=m>9877</span>
</span></span><span class=line><span class=cl>EAI_SOCKTYPE    <span class=m>10</span>
</span></span><span class=line><span class=cl>EAI_MEMORY      <span class=m>6</span>
</span></span><span class=line><span class=cl>EAI_AGAIN       <span class=m>2</span>
</span></span><span class=line><span class=cl>EAI_BADFLAGS    <span class=m>3</span>
</span></span><span class=line><span class=cl>NI_MAXHOST      <span class=m>1025</span>
</span></span><span class=line><span class=cl>EAI_FAIL        <span class=m>4</span>
</span></span><span class=line><span class=cl>NI_NAMEREQD     <span class=m>4</span>
</span></span><span class=line><span class=cl>EAI_NODATA      <span class=m>7</span>
</span></span><span class=line><span class=cl>MAXLINE         <span class=m>4096</span>
</span></span><span class=line><span class=cl>NI_MAXSERV      <span class=m>32</span>
</span></span><span class=line><span class=cl>EAI_SYSTEM      <span class=m>11</span>
</span></span><span class=line><span class=cl>BUFFSIZE        <span class=m>8192</span>
</span></span><span class=line><span class=cl>NI_DGRAM        <span class=m>16</span>
</span></span><span class=line><span class=cl>NI_NOFQDN       <span class=m>1</span>
</span></span><span class=line><span class=cl>EAI_FAMILY      <span class=m>5</span>
</span></span><span class=line><span class=cl>LISTENQ         <span class=m>1024</span>
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://fireflyyh.top/tags/tcpl/>TCPL</a></li></ul><nav class=paginav><a class=prev href=https://fireflyyh.top/posts/tcpl/ch07/><span class=title>« Prev</span><br><span>C语言程序设计第二版课后习题--第七章</span>
</a><a class=next href=https://fireflyyh.top/posts/tcpl/ch05/><span class=title>Next »</span><br><span>C语言程序设计第二版课后习题--第五章</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://fireflyyh.top/>Jagger's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function i(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),i();return}const n=document.createRange();n.selectNodeContents(e);const s=window.getSelection();s.removeAllRanges(),s.addRange(n);try{document.execCommand("copy"),i()}catch{}s.removeRange(n)});let l=e.className.replaceAll("language-",""),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),c=document.createElement("div"),o=document.createElement("div");o.innerText=l,n.setAttribute("class","mac-tool"),a.setAttribute("class","mac bb1"),r.setAttribute("class","mac bb2"),c.setAttribute("class","mac bb3"),o.setAttribute("class","language-type"),n.appendChild(a),n.appendChild(r),n.appendChild(c),n.appendChild(o),s.classList.contains("highlight")?(s.appendChild(n),s.appendChild(t)):s.parentNode.firstChild==s||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?(s.appendChild(n),e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t)):(s.appendChild(n),e.parentNode.appendChild(t)))})</script></body></html>